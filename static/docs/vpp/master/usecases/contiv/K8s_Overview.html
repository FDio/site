<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contiv/VPP Kubernetes Network Plugin &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Security" href="SECURITY.html" />
    <link rel="prev" title="VPP in kubernetes (Contiv/Deprecated)" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">VPP in kubernetes (Contiv/Deprecated)</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Contiv/VPP Kubernetes Network Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#architecture">Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contiv-ksr">Contiv KSR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contiv-etcd">Contiv ETCD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contiv-vswitch">Contiv vSwitch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contiv-cni">Contiv CNI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#contiv-stn-daemon">Contiv STN Daemon</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SECURITY.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="Vagrant.html">Contiv-VPP Vagrant Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="MANUAL_INSTALL.html">Manual Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="VPP_CONFIG.html">Creating VPP Startup Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMWARE_FUSION_HOST.html">Preparing a VmWare Fusion Host</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMWARE_FUSION_HOST.html#the-loopback-network-interface">The loopback network interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="VMWARE_FUSION_HOST.html#the-primary-network-interface">The primary network interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="NETWORKING.html">Contiv/VPP Network Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="SINGLE_NIC_SETUP.html">Setting up a Node with a Single NIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="MULTI_NIC_SETUP.html">Setting Up a Node with Multiple NICs</a></li>
<li class="toctree-l2"><a class="reference internal" href="CUSTOM_MGMT_NETWORK.html">Setting Up a Custom Management Network on Multi-Homed Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="Prometheus.html">Prometheus Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="VPP_PACKET_TRACING_K8S.html">How to do VPP Packet Tracing in Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="VPPTRACE.html">Using vpptrace.sh for VPP Packet Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="CORE_FILES.html">Capturing VPP core dumps</a></li>
<li class="toctree-l2"><a class="reference internal" href="BUG_REPORTS.html">Debugging and Reporting Bugs in Contiv-VPP</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer/build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/corefeatures/index.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">VPP in kubernetes (Contiv/Deprecated)</a> &raquo;</li>
      <li>Contiv/VPP Kubernetes Network Plugin</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/usecases/contiv/K8s_Overview.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="contiv-vpp-kubernetes-network-plugin">
<h1>Contiv/VPP Kubernetes Network Plugin<a class="headerlink" href="#contiv-vpp-kubernetes-network-plugin" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Kubernetes is a container orchestration system that efficiently manages
Docker containers. The Docker containers and container platforms provide
many advantages over traditional virtualization. Container isolation is
done on the kernel level, which eliminates the need for a guest virtual
operating system, and therefore makes containers much more efficient,
faster, and lightweight. The containers in Contiv/VPP are referred to as
PODs.</p>
<p>Contiv/VPP is a Kubernetes network plugin that uses <a class="reference external" href="https://fd.io/">FD.io
VPP</a> to provide network connectivity between PODs in
a k8s cluster (k8s is an abbreviated reference for kubernetes). It
deploys itself as a set of system PODs in the <code class="docutils literal notranslate"><span class="pre">kube-system</span></code> namespace,
some of them (<code class="docutils literal notranslate"><span class="pre">contiv-ksr</span></code>, <code class="docutils literal notranslate"><span class="pre">contiv-etcd</span></code>) on the master node, and
some of them (<code class="docutils literal notranslate"><span class="pre">contiv-cni</span></code>, <code class="docutils literal notranslate"><span class="pre">contiv-vswitch</span></code>, <code class="docutils literal notranslate"><span class="pre">contiv-stn</span></code>) on
each node in the cluster.</p>
<p>Contiv/VPP is fully integrated with k8s via its components, and it
automatically reprograms itself upon each change in the cluster via k8s
API.</p>
<p>The main component of the <a class="reference external" href="https://fd.io/technology/#vpp">VPP</a>
solution, which runs within the <code class="docutils literal notranslate"><span class="pre">contiv-vswitch</span></code> POD on each node in
the cluster. The VPP solution also provides POD-to-POD connectivity
across the nodes in the cluster, as well as host-to-POD and
outside-to-POD connectivity. This solution also leverages VPP’s fast
data processing that runs completely in userspace, and uses
<a class="reference external" href="https://dpdk.org/">DPDK</a> for fast access to the network IO layer.</p>
<p>Kubernetes services and policies are also a part of the VPP
configuration, which means they are fully supported on VPP, without the
need of forwarding packets into the Linux network stack (Kube Proxy),
which makes them very effective and scalable.</p>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline"></a></h2>
<p>Contiv/VPP consists of several components, each of them packed and
shipped as a Docker container. Two of them deploy on Kubernetes master
node only:</p>
<ul class="simple">
<li><p><a class="reference external" href="#contiv-ksr">Contiv KSR</a></p></li>
<li><p><a class="reference external" href="#contiv-etcd">Contiv ETCD</a></p></li>
</ul>
<p>The rest of them deploy on all nodes within the k8s cluster (including
the master node):</p>
<ul class="simple">
<li><p><a class="reference external" href="#contiv-vswitch">Contiv vSwitch</a></p></li>
<li><p><a class="reference external" href="#contiv-cni">Contiv CNI</a></p></li>
<li><p><a class="reference external" href="#contiv-stn-daemon">Contiv STN</a></p></li>
</ul>
<p>The following section briefly describes the individual Contiv
components, which are displayed as orange boxes on the picture below:</p>
<figure class="align-default" id="id1">
<img alt="Contiv/VPP Architecture" src="../../_images/contiv-arch.png" />
<figcaption>
<p><span class="caption-text">Contiv/VPP Architecture</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="contiv-ksr">
<h3>Contiv KSR<a class="headerlink" href="#contiv-ksr" title="Permalink to this headline"></a></h3>
<p>Contiv KSR (Kubernetes State Reflector) is an agent that subscribes to
k8s control plane, watches k8s resources and propagates all relevant
cluster-related information into the Contiv ETCD data store. Other
Contiv components do not access the k8s API directly, they subscribe to
Contiv ETCD instead. For more information on KSR, read the <a class="reference external" href="https://github.com/contiv/vpp/blob/master/cmd/contiv-ksr/README.md">KSR
Readme</a>.</p>
</section>
<section id="contiv-etcd">
<h3>Contiv ETCD<a class="headerlink" href="#contiv-etcd" title="Permalink to this headline"></a></h3>
<p>Contiv/VPP uses its own instance of the ETCD database for storage of k8s
cluster-related data reflected by KSR, which are then accessed by Contiv
vSwitch Agents running on individual nodes. Apart from the data
reflected by KSR, ETCD also stores persisted VPP configuration of
individual vswitches (mainly used to restore the operation after
restarts), as well as some more internal metadata.</p>
</section>
<section id="contiv-vswitch">
<h3>Contiv vSwitch<a class="headerlink" href="#contiv-vswitch" title="Permalink to this headline"></a></h3>
<p>vSwitch is the main networking component that provides the connectivity
to PODs. It deploys on each node in the cluster, and consists of two
main components packed into a single Docker container: VPP and Contiv
VPP Agent.</p>
<p><strong>VPP</strong> is the data plane software that provides the connectivity
between PODs, host Linux network stack, and data-plane NIC interface
controlled by VPP:</p>
<ul class="simple">
<li><p>PODs are connected to VPP using TAP interfaces wired between VPP, and
each POD network namespace.</p></li>
<li><p>host network stack is connected to VPP using another TAP interface
connected to the main (default) network namespace.</p></li>
<li><p>data-plane NIC is controlled directly by VPP using DPDK. Note, this
means that this interface is not visible to the host Linux network
stack, and the node either needs another management interface for k8s
control plane communication, or [STN (Steal The
NIC)](SINGLE_NIC_SETUP.html) deployment must be applied.</p></li>
</ul>
<p><strong>Contiv VPP Agent</strong> is the control plane part of the vSwitch container.
It is responsible for configuring the VPP according to the information
gained from ETCD, and requests from Contiv STN. It is based on the
<a class="reference external" href="https://github.com/ligato/vpp-agent">Ligato VPP Agent</a> code with
extensions that are related to k8s.</p>
<p>For communication with VPP, it uses VPP binary API messages sent via
shared memory using <a class="reference external" href="https://wiki.fd.io/view/GoVPP">GoVPP</a>. For
connection with Contiv STN, the agent acts as a GRPC server serving CNI
requests forwarded from the Contiv CNI.</p>
</section>
<section id="contiv-cni">
<h3>Contiv CNI<a class="headerlink" href="#contiv-cni" title="Permalink to this headline"></a></h3>
<p>Contiv CNI (Container Network Interface) is a simple binary that
implements the <a class="reference external" href="https://github.com/containernetworking/cni">Container Network
Interface</a> API and is
being executed by Kubelet upon POD creation and deletion. The CNI binary
just packs the request into a GRPC request and forwards it to the Contiv
VPP Agent running on the same node, which then processes it
(wires/unwires the container) and replies with a response, which is then
forwarded back to Kubelet.</p>
</section>
<section id="contiv-stn-daemon">
<h3>Contiv STN Daemon<a class="headerlink" href="#contiv-stn-daemon" title="Permalink to this headline"></a></h3>
<p>This section discusses how the Contiv [STN (Steal The
NIC)](SINGLE_NIC_SETUP.html) daemon operation works. As already
mentioned, the default setup of Contiv/VPP requires two network
interfaces per node: one controlled by VPP for data facing PODs, and one
controlled by the host network stack for k8s control plane
communication. In case that your k8s nodes do not provide two network
interfaces, Contiv/VPP can work in the single NIC setup, when the
interface will be “stolen” from the host network stack just before
starting the VPP and configured with the same IP address on VPP, as well
as on the host-VPP interconnect TAP interface, as it had in the host
before it. For more information on STN setup, read the [Single NIC Setup
README](./SINGLE_NIC_SETUP.html)</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="VPP in kubernetes (Contiv/Deprecated)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="SECURITY.html" class="btn btn-neutral float-right" title="Security" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>