<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SRv6 dynamic proxy &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="SRv6 masquerading" href="am_plugin_doc.html" />
    <link rel="prev" title="SRv6 per-flow dynamic proxy" href="ad_flow_plugin_doc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../corefeatures/index.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugins</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../quic.html">QUIC HostStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cnat.html">Cloud NAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lcp.html">Linux Control Plane Integration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">SRv6 Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ad_flow_plugin_doc.html">SRv6 per-flow dynamic proxy</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SRv6 dynamic proxy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#srv6-endpoint-to-sr-unaware-appliance-via-dynamic-proxy-end-ad">SRv6 endpoint to SR-unaware appliance via dynamic proxy (End.AD)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="am_plugin_doc.html">SRv6 masquerading</a></li>
<li class="toctree-l3"><a class="reference internal" href="as_plugin_doc.html">SRv6 static proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="mobile_plugin_doc.html">SRv6 Mobile User Plane</a></li>
<li class="toctree-l3"><a class="reference internal" href="runner_doc.html">SRv6 Mobile Runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="srv6_sample_localsid_doc.html">Sample SRv6 LocalSID documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../marvell.html">Marvell device plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lldp.html">LLDP Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nat64.html">Stateful NAT64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nat44_ei_ha.html">Active-Passive NAT HA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pnat.html">PNAT 1:1 match &amp; rewrite NAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lb.html">Load Balancer plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lacp.html">LACP Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flowprobe.html">IPFIX flow record plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../map_lw4o6.html">MAP and Lw4o6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mdata.html">Buffer metadata change tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dhcp6_pd.html">DHCPv6 prefix delegation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ioam.html">Inband OAM (iOAM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wireguard.html">Wireguard vpp-plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../srtp.html">SRTP Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acl_multicore.html">Multicore support for ACL plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acl_hash_lookup.html">ACL plugin constant-time lookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acl_lookup_context.html">ACL Lookup contexts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bufmon_doc.html">Buffers monitoring plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Plugins</a> &raquo;</li>
          <li><a href="index.html">SRv6 Plugins</a> &raquo;</li>
      <li>SRv6 dynamic proxy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/developer/plugins/srv6/ad_plugin_doc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="srv6-dynamic-proxy">
<span id="srv6-ad-plugin-doc"></span><h1>SRv6 dynamic proxy<a class="headerlink" href="#srv6-dynamic-proxy" title="Permalink to this headline"></a></h1>
<section id="srv6-endpoint-to-sr-unaware-appliance-via-dynamic-proxy-end-ad">
<h2>SRv6 endpoint to SR-unaware appliance via dynamic proxy (End.AD)<a class="headerlink" href="#srv6-endpoint-to-sr-unaware-appliance-via-dynamic-proxy-end-ad" title="Permalink to this headline"></a></h2>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h3>
<p>The dynamic proxy is an improvement over the static proxy (&#64;ref
srv6_as_plugin_doc) that dynamically learns the SR information before
removing it from the incoming traffic. The same information can then be
re-attached to the traffic returning from the SF. As opposed to the
static SR proxy, no CACHE information needs to be configured. Instead,
the dynamic SR proxy relies on a local caching mechanism on the node
instantiating this segment. Therefore, a dynamic proxy segment cannot be
the last segment in an SR SC policy. A different SR behavior should thus
be used if the SF is meant to be the final destination of an SR SC
policy.</p>
<p>Upon receiving a packet whose active segment matches a dynamic SR proxy
function, the proxy node pops the top MPLS label or applies the SRv6 End
behavior, then compares the updated SR information with the cache entry
for the current segment. If the cache is empty or different, it is
updated with the new SR information. The SR information is then removed
and the inner packet is sent towards the SF.</p>
<p>The cache entry is not mapped to any particular packet, but instead to
an SR SC policy identified by the receiving interface (IFACE-IN). Any
non-link-local IP packet or non-local Ethernet frame received on that
interface will be re-encapsulated with the cached headers as described
in &#64;ref srv6_as_plugin_doc. The SF may thus drop, modify or generate new
packets without affecting the proxy.</p>
<p>For more information, please see
<a class="reference external" href="https://datatracker.ietf.org/doc/draft-xuclad-spring-sr-service-chaining/">draft-xuclad-spring-sr-service-chaining</a>.</p>
</section>
<section id="cli-configuration">
<h3>CLI configuration<a class="headerlink" href="#cli-configuration" title="Permalink to this headline"></a></h3>
<p>The following command instantiates a new End.AD segment that sends the
inner packets on interface <code class="docutils literal notranslate"><span class="pre">IFACE-OUT</span></code> towards an appliance at address
<code class="docutils literal notranslate"><span class="pre">S-ADDR</span></code> and restores the encapsulation headers of the packets coming
back on interface <code class="docutils literal notranslate"><span class="pre">IFACE-IN</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">address</span> <span class="n">SID</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">ad</span> <span class="n">nh</span> <span class="n">S</span><span class="o">-</span><span class="n">ADDR</span> <span class="n">oif</span> <span class="n">IFACE</span><span class="o">-</span><span class="n">OUT</span> <span class="n">iif</span> <span class="n">IFACE</span><span class="o">-</span><span class="n">IN</span>
</pre></div>
</div>
<p>For example, the below command configures the SID <code class="docutils literal notranslate"><span class="pre">1::A1</span></code> with an
End.AD function for sending traffic on interface
<code class="docutils literal notranslate"><span class="pre">GigabitEthernet0/8/0</span></code> to the appliance at address <code class="docutils literal notranslate"><span class="pre">A1::</span></code>, and
receiving it back on interface <code class="docutils literal notranslate"><span class="pre">GigabitEthernet0/9/0</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">address</span> <span class="mi">1</span><span class="p">::</span><span class="n">A1</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">ad</span> <span class="n">nh</span> <span class="n">A1</span><span class="p">::</span> <span class="n">oif</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">8</span><span class="o">/</span><span class="mi">0</span> <span class="n">iif</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">9</span><span class="o">/</span><span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="pseudocode">
<h3>Pseudocode<a class="headerlink" href="#pseudocode" title="Permalink to this headline"></a></h3>
<p>The dynamic proxy SRv6 pseudocode is obtained by inserting the following
instructions between lines 1 and 2 of the static proxy SRv6 pseudocode.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IF</span> <span class="n">NH</span><span class="o">=</span><span class="n">SRH</span> <span class="o">&amp;</span> <span class="n">SL</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="n">THEN</span>
    <span class="n">Decrement</span> <span class="n">SL</span> <span class="ow">and</span> <span class="n">update</span> <span class="n">the</span> <span class="n">IPv6</span> <span class="n">DA</span> <span class="k">with</span> <span class="n">SRH</span><span class="p">[</span><span class="n">SL</span><span class="p">]</span>
    <span class="n">IF</span> <span class="n">C</span><span class="p">(</span><span class="n">IFACE</span><span class="o">-</span><span class="n">IN</span><span class="p">)</span> <span class="n">different</span> <span class="kn">from</span> <span class="nn">IPv6</span> <span class="n">encaps</span> <span class="n">THEN</span>              <span class="p">;;</span> <span class="n">Ref1</span>
        <span class="n">Copy</span> <span class="n">the</span> <span class="n">IPv6</span> <span class="n">encaps</span> <span class="n">into</span> <span class="n">C</span><span class="p">(</span><span class="n">IFACE</span><span class="o">-</span><span class="n">IN</span><span class="p">)</span>                   <span class="p">;;</span> <span class="n">Ref2</span>
<span class="n">ELSE</span>
    <span class="n">Drop</span> <span class="n">the</span> <span class="n">packet</span>
</pre></div>
</div>
<p><strong>Ref1:</strong> “IPv6 encaps” represents the IPv6 header and any attached
extension header.</p>
<p><strong>Ref2:</strong> C(IFACE-IN) represents the cache entry associated to the
dynamic SR proxy segment. It is identified with IFACE-IN in order to
efficiently retrieve the right SR information when a packet arrives on
this interface.</p>
<p>In addition, the inbound policy should check that C(IFACE-IN) has been
defined before attempting to restore the IPv6 encapsulation, and drop
the packet otherwise.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ad_flow_plugin_doc.html" class="btn btn-neutral float-left" title="SRv6 per-flow dynamic proxy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="am_plugin_doc.html" class="btn btn-neutral float-right" title="SRv6 masquerading" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>