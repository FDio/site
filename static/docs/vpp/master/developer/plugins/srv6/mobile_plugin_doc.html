<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SRv6 Mobile User Plane &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="SRv6 Mobile Runner" href="runner_doc.html" />
    <link rel="prev" title="SRv6 static proxy" href="as_plugin_doc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../corefeatures/index.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugins</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../quic.html">QUIC HostStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cnat.html">Cloud NAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lcp.html">Linux Control Plane Integration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">SRv6 Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ad_flow_plugin_doc.html">SRv6 per-flow dynamic proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="ad_plugin_doc.html">SRv6 dynamic proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="am_plugin_doc.html">SRv6 masquerading</a></li>
<li class="toctree-l3"><a class="reference internal" href="as_plugin_doc.html">SRv6 static proxy</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SRv6 Mobile User Plane</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation">Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configurations">Configurations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="runner_doc.html">SRv6 Mobile Runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="srv6_sample_localsid_doc.html">Sample SRv6 LocalSID documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../marvell.html">Marvell device plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lldp.html">LLDP Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nat64.html">Stateful NAT64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nat44_ei_ha.html">Active-Passive NAT HA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pnat.html">PNAT 1:1 match &amp; rewrite NAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lb.html">Load Balancer plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lacp.html">LACP Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flowprobe.html">IPFIX flow record plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../map_lw4o6.html">MAP and Lw4o6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mdata.html">Buffer metadata change tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dhcp6_pd.html">DHCPv6 prefix delegation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ioam.html">Inband OAM (iOAM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wireguard.html">Wireguard vpp-plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../srtp.html">SRTP Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acl_multicore.html">Multicore support for ACL plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acl_hash_lookup.html">ACL plugin constant-time lookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acl_lookup_context.html">ACL Lookup contexts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bufmon_doc.html">Buffers monitoring plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Plugins</a> &raquo;</li>
          <li><a href="index.html">SRv6 Plugins</a> &raquo;</li>
      <li>SRv6 Mobile User Plane</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/developer/plugins/srv6/mobile_plugin_doc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="srv6-mobile-user-plane">
<span id="srv6-mobile-plugin-doc"></span><h1>SRv6 Mobile User Plane<a class="headerlink" href="#srv6-mobile-user-plane" title="Permalink to this headline"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>This plugin module can provide the stateless mobile user plane protocols
translation between GTP-U and SRv6. The plugin also provides FIB table
lookup for an IPv4/IPv6 packet encapsulated in GTP-U. These plugin
functions take advantage of SRv6 network programmability.</p>
<p><a class="reference external" href="https://tools.ietf.org/html/draft-ietf-dmm-srv6-mobile-uplane">SRv6 Mobile User
Plane</a>
defines the user plane protocol using SRv6 including following stateless
translation functions:</p>
<ul class="simple">
<li><p><strong>T.M.GTP4.D:</strong> GTP-U over UDP/IPv4 -&gt; SRv6</p></li>
<li><p><strong>End.M.GTP4.E:</strong> SRv6 -&gt; GTP-U over UDP/IPv4</p></li>
<li><p><strong>End.M.GTP6.D:</strong> GTP-U over UDP/IPv6 -&gt; SRv6</p></li>
<li><p><strong>End.M.GTP6.E:</strong> SRv6 -&gt; GTP-U over UDP/IPv6</p></li>
</ul>
<p>These functions benefit user plane(overlay) to be able to utilize data
plane(underlay) networks properly. And also it benefits data plane to be
able to handle user plane in routing paradigm.</p>
<p>In addition to the above functions, the plugin supports following
functions:</p>
<ul class="simple">
<li><p><strong>T.M.GTP4.DT{4|6|46}:</strong> FIB table lookup for IPv4/IP6 encapsulated
in GTP-U over UDP/IPv4</p></li>
<li><p><strong>End.M.GTP6.DT{4|6|46}:</strong> FIB table lookup for IPv4/IP6 encapsulated
in GTP-U over UDP/IPv6</p></li>
</ul>
<p>Noted that the prefix of function names follow naming convention of SRv6
network programming. “T” means transit function, “End” means end
function, “M” means Mobility specific function. The suffix “D” and “E”
mean that “decapsulation” and “encapsulation” respectively.</p>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline"></a></h2>
<p>All SRv6 mobile functions are implemented as VPP plugin modules. The
plugin modules leverage the sr_policy and sr_localsid mechanisms.</p>
</section>
<section id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this headline"></a></h2>
<section id="gtp-u-to-srv6">
<h3>GTP-U to SRv6<a class="headerlink" href="#gtp-u-to-srv6" title="Permalink to this headline"></a></h3>
<p>The GTP-U tunnel and flow identifiers of a receiving packet are mapped
to a Segment Identifier(SID) of sending SRv6 packets.</p>
<section id="ipv4-infrastructure-case">
<h4>IPv4 infrastructure case<a class="headerlink" href="#ipv4-infrastructure-case" title="Permalink to this headline"></a></h4>
<p>In case that <strong>IPv4</strong> networks are the infrastructure of GTP-U,
T.M.GTP4.D function translates the receiving GTP-U packets to SRv6
packets.</p>
<p>A T.M.GTP4.D function is associated with the following mandatory
parameters:</p>
<ul class="simple">
<li><p>SID: A SRv6 SID to represents the function</p></li>
<li><p>DST-PREFIX: Prefix of remote SRv6 segment. The destination address or
last SID of out packets consists of the prefix followed by dst IPv4
address, QFI and TEID of the receiving packets.</p></li>
<li><p>SRC-PREFIX: Prefix for src address of sending packets. The src IPv6
address consists of the prefix followed by the src IPv4 address of
the receiving packets.</p></li>
</ul>
<p>The following command instantiates a new T.M.GTP4.D function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">policy</span> <span class="n">add</span> <span class="n">bsid</span> <span class="n">SID</span> <span class="n">behavior</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">d</span> <span class="n">DST</span><span class="o">-</span><span class="n">PREFIX</span> <span class="n">v6src_prefix</span> <span class="n">SRC</span><span class="o">-</span><span class="n">PREFIX</span> <span class="p">[</span><span class="n">nhtype</span> <span class="p">{</span><span class="n">ipv4</span><span class="o">|</span><span class="n">ipv6</span><span class="o">|</span><span class="n">non</span><span class="o">-</span><span class="n">ip</span><span class="p">}]</span>
</pre></div>
</div>
<p>For example, the below command configures the SID 2001:db8::1 with
<code class="docutils literal notranslate"><span class="pre">t.m.gtp4.d</span></code> behavior for translating receiving GTP-U over IPv4
packets to SRv6 packets with next-header type is IPv4.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">policy</span> <span class="n">add</span> <span class="n">bsid</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="mi">1</span> <span class="n">behavior</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">d</span> <span class="n">D1</span><span class="p">::</span><span class="o">/</span><span class="mi">32</span> <span class="n">v6src_prefix</span> <span class="n">A1</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span> <span class="n">nhtype</span> <span class="n">ipv4</span>
</pre></div>
</div>
<p>It should be interesting how a SRv6 BSID works to decapsulate the
receiving GTP-U packets over IPv4 header. To utilize <code class="docutils literal notranslate"><span class="pre">t.m.gtp4.d</span></code>
function, you need to configure some SR steering policy like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">steer</span> <span class="n">l3</span> <span class="mf">172.20.0.1</span><span class="o">/</span><span class="mi">32</span> <span class="n">via</span> <span class="n">bsid</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="mi">1</span>
</pre></div>
</div>
<p>The above steering policy with the BSID of <code class="docutils literal notranslate"><span class="pre">t.m.gtp4.d</span></code> would work
properly for the GTP-U packets destined to 172.20.0.1.</p>
<p>If you have a SID(s) list of SR policy which the configured gtp4.d
function to be applied, the SR Policy can be configured as following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">policy</span> <span class="n">add</span> <span class="n">bsid</span> <span class="n">D1</span><span class="p">::</span> <span class="nb">next</span> <span class="n">A1</span><span class="p">::</span> <span class="nb">next</span> <span class="n">B1</span><span class="p">::</span> <span class="nb">next</span> <span class="n">C1</span><span class="p">::</span>
</pre></div>
</div>
</section>
<section id="ipv6-infrastructure-case">
<h4>IPv6 infrastructure case<a class="headerlink" href="#ipv6-infrastructure-case" title="Permalink to this headline"></a></h4>
<p>In case that GTP-U is deployed over <strong>IPv6</strong> infrastructure, you don’t
need to configure T.M.GTP4.D function and associated SR steering policy.
Instead of that, you just need to configure a localsid of End.M.GTP6.D
segment.</p>
<p>An End.M.GTP6.D segment is associated with the following mandatory
parameters:</p>
<ul class="simple">
<li><p>SID-PREFIX: SRv6 SID prefix to represent the function. In this
function, it should be the dst address of receiving GTP-U packets.</p></li>
<li><p>DST-PREFIX: Prefix of remote SRv6 Segment. The destination address or
last SID of output packets consists of the prefix followed by QFI and
TEID of the receiving packets.</p></li>
</ul>
<p>The following command instantiates a new End.M.GTP6.D function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">prefix</span> <span class="n">SID</span><span class="o">-</span><span class="n">PREFIX</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp6</span><span class="o">.</span><span class="n">d</span> <span class="n">DST</span><span class="o">-</span><span class="n">PREFIX</span> <span class="p">[</span><span class="n">nhtype</span> <span class="p">{</span><span class="n">ipv4</span><span class="o">|</span><span class="n">ipv6</span><span class="o">|</span><span class="n">non</span><span class="o">-</span><span class="n">ip</span><span class="p">}]</span>
</pre></div>
</div>
<p>For example, the below command configures the SID prefix 2001:db8::/64
with <code class="docutils literal notranslate"><span class="pre">end.m.gtp6.d</span></code> behavior for translating receiving GTP-U over IPv6
packets which have IPv6 destination addresses within 2001:db8::/64 to
SRv6 packets. The dst IPv6 address of the outgoing packets consists of
D4::/64 followed by QFI and TEID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">prefix</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp6</span><span class="o">.</span><span class="n">d</span> <span class="n">D4</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span>
</pre></div>
</div>
<p>In another case, the translated packets from GTP-U over IPv6 to SRv6
will be re-translated back to GTP-U, which is so called ‘Drop-In’ mode.</p>
<p>In Drop-In mode, an additional IPv6 specific end segment is required,
named End.M.GTP6.D.Di. It is because that unlike <code class="docutils literal notranslate"><span class="pre">end.m.gtp6.d</span></code>, it
needs to preserve original IPv6 dst address as the last SID in the SRH.</p>
<p>Regardless of that difference exists, the required configuration
parameters are same as <code class="docutils literal notranslate"><span class="pre">end.m.gtp6.d</span></code>.</p>
<p>The following command instantiates a new End.M.GTP6.D.Di function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">prefix</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp6</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">di</span> <span class="n">D4</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span>
</pre></div>
</div>
</section>
</section>
<section id="srv6-to-gtp-u">
<h3>SRv6 to GTP-U<a class="headerlink" href="#srv6-to-gtp-u" title="Permalink to this headline"></a></h3>
<p>The SRv6 Mobile functions on SRv6 to GTP-U direction are End.M.GTP4.E
and End.M.GTP6.D.</p>
<p>In this direction with GTP-U over IPv4 infrastructure, an End.M.GTP4.E
segment is associated with the following mandatory parameters:</p>
<ul class="simple">
<li><p>SID-PREFIX: SRv6 SID prefix to represent the function.</p></li>
<li><p>V4SRC-ADDR-POSITION: Integer number indicates bit position where IPv4
src address embedded.</p></li>
</ul>
<p>The following command instantiates a new End.M.GTP4.E function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">prefix</span> <span class="n">SID</span><span class="o">-</span><span class="n">PREFIX</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">e</span> <span class="n">v4src_position</span> <span class="n">V4SRC</span><span class="o">-</span><span class="n">ADDR</span><span class="o">-</span><span class="n">POSITION</span>
</pre></div>
</div>
<p>For example, the below command configures the SID prefix 2001:db8::/32
with <code class="docutils literal notranslate"><span class="pre">end.m.gtp4.e</span></code> behavior for translating the receiving SRv6
packets to GTP-U packets encapsulated with UDP/IPv4 header. All the
GTP-U tunnel and flow identifiers are extracted from the active SID in
the receiving packets. The src IPv4 address of sending GTP-U packets is
extracted from the configured bit position in the src IPv6 address.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">prefix</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="o">/</span><span class="mi">32</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">e</span> <span class="n">v4src_position</span> <span class="mi">64</span>
</pre></div>
</div>
<p>In IPv6 infrastructure case, an End.M.GTP6.E segment is associated with
the following mandatory parameters:</p>
<ul class="simple">
<li><p>SID-PREFIX: SRv6 SID prefix to represent the function.</p></li>
</ul>
<p>The following command instantiates a new End.M.GTP6.E function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">prefix</span> <span class="n">SID</span><span class="o">-</span><span class="n">PREFIX</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp6</span><span class="o">.</span><span class="n">e</span>
</pre></div>
</div>
<p>For example, the below command configures the SID prefix 2001:db8::/64
with <code class="docutils literal notranslate"><span class="pre">end.m.gtp6.e</span></code> behavior for translating the receiving SRv6
packets to GTP-U packets encapsulated with UDP/IPv6 header. While the
last SID indicates GTP-U dst IPv6 address, 32-bits GTP-U TEID and 6-bits
QFI are extracted from the active SID in the receiving packets.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">prefix</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp6</span><span class="o">.</span><span class="n">e</span>
</pre></div>
</div>
</section>
<section id="fib-table-lookup-for-inner-ipv4-ipv6-packet">
<h3>FIB Table Lookup for Inner IPv4/IPv6 packet<a class="headerlink" href="#fib-table-lookup-for-inner-ipv4-ipv6-packet" title="Permalink to this headline"></a></h3>
<p>SRv6 Mobile functions of <code class="docutils literal notranslate"><span class="pre">t.m.gtp4.dt*</span></code> and <code class="docutils literal notranslate"><span class="pre">end.m.gtp6.dt*</span></code> support
decapsulating outer IP/UDP/GTP-U headers and forwarding inner IP packet
based on specific fib table.</p>
<p>In case of the both outer and inner IP address families are IPv4,
<code class="docutils literal notranslate"><span class="pre">t.m.gtp4.dt4</span></code> function supports GTP-U decapsulation and fib lookup
for inner IPv4 with an associated steering policy and the following
parameters:</p>
<ul class="simple">
<li><p>SID: A SRv6 SID to represents the function</p></li>
<li><p>FIB: fib-table number for inner IPv4 packet lookup and forwarding</p></li>
</ul>
<p>The following command instantiates a new T.M.GTP4.DT4 function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">policy</span> <span class="n">add</span> <span class="n">bsid</span> <span class="n">SID</span> <span class="n">behavior</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">dt4</span> <span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="n">FIB</span>
</pre></div>
</div>
<p>For example, the below commands configure D5:: as the SID instantiates
<code class="docutils literal notranslate"><span class="pre">t.m.gtp4.dt4</span></code> function. A steering policy for packets destine to
172.20.0.1 binds to the SID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">steer</span> <span class="n">l3</span> <span class="mf">172.20.0.1</span><span class="o">/</span><span class="mi">32</span> <span class="n">via</span> <span class="n">bsid</span> <span class="n">D5</span><span class="p">::</span>
<span class="n">sr</span> <span class="n">policy</span> <span class="n">add</span> <span class="n">bsid</span> <span class="n">D5</span><span class="p">::</span> <span class="n">behavior</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">dt4</span> <span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="mi">0</span>
</pre></div>
</div>
<p>In addition, inner IPv6, or mix of IPv4 and IPv6 inner packet cases
require the function to be configured with local-fib table.</p>
<ul class="simple">
<li><p>LOCAL-FIB: fib-table number for lookup and forward GTP-U packet based
on outer IP destination address</p></li>
</ul>
<p>This is inner IPv6 case specific. The reason is that GTP-U encapsulates
link local IPv6 packet for NDP (Neighbor Discovery Protocol). Outer
GTP-U header should be kept until the packets reach to the node
responsible for NDP handling. It is typically UPF(User Plane Function)
node.</p>
<p>The following command instantiate a new T.M.GTP4.DT6 function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">policy</span> <span class="n">add</span> <span class="n">bsid</span> <span class="n">D5</span><span class="p">::</span> <span class="n">behavior</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">dt6</span> <span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="mi">0</span> <span class="n">local</span><span class="o">-</span><span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="n">LOCAL</span><span class="o">-</span><span class="n">FIB</span>
</pre></div>
</div>
<p>Following example configures fib 0 for inner packet and fib 1 for outer
GTP-U packet forwarding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">policy</span> <span class="n">add</span> <span class="n">bsid</span> <span class="n">D5</span><span class="p">::</span> <span class="n">behavior</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">dt6</span> <span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="mi">0</span> <span class="n">local</span><span class="o">-</span><span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="mi">1</span>
</pre></div>
</div>
<p>If you need to support both IPv4 and IPv6 inner packet lookup with just
one SID, you can configure <code class="docutils literal notranslate"><span class="pre">t.m.gtp4.dt46</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">policy</span> <span class="n">add</span> <span class="n">bsid</span> <span class="n">D5</span><span class="p">::</span> <span class="n">behavior</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp4</span><span class="o">.</span><span class="n">dt46</span> <span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="mi">0</span> <span class="n">local</span><span class="o">-</span><span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="mi">1</span>
</pre></div>
</div>
<p>In case of GTP-U over IPv6 case, <code class="docutils literal notranslate"><span class="pre">end.m.gtp6.dt4</span></code>, <code class="docutils literal notranslate"><span class="pre">end.m.gtp6.dt6</span></code>
and <code class="docutils literal notranslate"><span class="pre">end.m.gtp6.dt46</span></code> functions support inner IPv4, IPv6 and IPv4/IPv6
lookup and forwarding respectively. Specifying fib table for inner IP
packet forwarding is required as same as GTP-U over IPv4 case, and
local-fib table for inner IPv6 and IPv4/IPv6 cases as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr</span> <span class="n">localsid</span> <span class="n">prefix</span> <span class="n">D</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span> <span class="n">behavior</span> <span class="n">end</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">gtp6</span><span class="o">.</span><span class="n">dt46</span> <span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="mi">0</span> <span class="n">local</span><span class="o">-</span><span class="n">fib</span><span class="o">-</span><span class="n">table</span> <span class="mi">0</span>
</pre></div>
</div>
<p>To run some demo setup please refer to: <a class="reference internal" href="runner_doc.html#srv6-mobile-runner-doc"><span class="std std-ref">SRv6 Mobile Runner</span></a></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="as_plugin_doc.html" class="btn btn-neutral float-left" title="SRv6 static proxy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="runner_doc.html" class="btn btn-neutral float-right" title="SRv6 Mobile Runner" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>