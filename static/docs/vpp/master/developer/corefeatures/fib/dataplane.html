<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Data Plane &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Tunnels" href="tunnels.html" />
    <link rel="prev" title="Mark and Sweep" href="marknsweep.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Core Features</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">The FIB</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="thedatamodel.html">The Data Model</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="controlplane.html">The Control Plane</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">The Data Plane</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tunnels.html">Tunnels</a></li>
<li class="toctree-l3"><a class="reference internal" href="mplsfib.html">MPLS FIB</a></li>
<li class="toctree-l3"><a class="reference internal" href="multicast.html">IP Multicast FIB</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="fastconvergence.html">Fast Convergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="scale.html">Scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="barnacles.html">Barnacles</a></li>
<li class="toctree-l3"><a class="reference internal" href="hacking.html">Get Hacking</a></li>
<li class="toctree-l3"><a class="reference internal" href="missing.html">Missing Functionality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sr/index.html">Segment routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../punt.html">Punting Packets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipsec.html">IPSec (IP Security)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bfd_doc.html">BFD module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipfix_doc.html">IPFIX support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../span_doc.html">Switched Port Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtu.html">MTU in VPP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sylog_doc.html">Syslog protocol support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../eventviewer.html">Event-logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stats.html">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../selinux_doc.html">SELinux - VPP Custom SELinux Policy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Core Features</a> &raquo;</li>
          <li><a href="index.html">The FIB</a> &raquo;</li>
          <li><a href="thedatamodel.html">The Data Model</a> &raquo;</li>
      <li>The Data Plane</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/developer/corefeatures/fib/dataplane.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-data-plane">
<span id="dataplane"></span><h1>The Data Plane<a class="headerlink" href="#the-data-plane" title="Permalink to this headline"></a></h1>
<p>The data-plane data model is a directed, acyclic <a class="footnote-reference brackets" href="#f16" id="id1">1</a> graph of heterogeneous objects.
A packet will forward walk the graph as it is switched. Each object describes
the actions to perform on the packet. Each object type has an associated VLIB
graph node. For a packet to forward walk the graph is therefore to move from one
VLIB node to the next, with each performing the required actions. This is the
heart of the VPP model.</p>
<p>The data-plane graph is composed of generic data-path objects (DPOs). A parent
DPO is identified by the tuple:{type,index,next_node}. The <em>next_node</em> parameter
is the index of the VLIB node to which the packets should be sent next, this is
present to maximise performance - it is important to ensure that the parent does
not need to be read <a class="footnote-reference brackets" href="#f17" id="id2">2</a> whilst processing the child. Specialisations <a class="footnote-reference brackets" href="#f18" id="id3">3</a> of the DPO
perform distinct actions. The most common DPOs and briefly what they represent are:</p>
<ul class="simple">
<li><p>Load-balance: a choice in an ECMP set.</p></li>
<li><p>Adjacency:  apply a rewrite and forward through an interface</p></li>
<li><p>MPLS-label: impose an MPLS label.</p></li>
<li><p>Lookup: perform another lookup in a different table.</p></li>
</ul>
<p>The data-plane graph is derived from the control-plane graph by the objects
therein ‘contributing’ a DPO to the data-plane graph. Objects in the data-plane
contain only the information needed to switch a packet, they are therefore
simpler, and in memory terms smaller, with the aim to fit one DPO on a single
cache-line. The derivation from the control plane means that the data-plane
graph contains only object whose current state can forward packets. For example,
the difference between a <em>fib_path_list_t</em> and a <em>load_balance_t</em> is that the former
expresses the control-plane’s desired state, the latter the data-plane available
state. If some paths in the path-list are unresolved or down, then the
load-balance will not include them in the forwarding choice.</p>
<figure class="align-default">
<img alt="../../../_images/fib20fig8.png" src="../../../_images/fib20fig8.png" />
</figure>
<p>Figure 8: DPO contributions for a non-recursive route</p>
<p>Figure 8 shows a simplified view of the control-plane graph indicating those
objects that contribute DPOs. Also shown are the VLIB node graphs at which the DPO is used.</p>
<p>Each <em>fib_entry_t</em> contributes it own <em>load_balance_t</em>, for three reasons;</p>
<ul class="simple">
<li><p>The result of a lookup in a IPv[46] table is a single 32 bit unsigned integer. This is an index into a memory pool. Consequently the object type must be the same for each result. Some routes will need a load-balance and some will not, but to insert another object in the graph to represent this choice is a waste of cycles, so the load-balance object is always the result. If the route does not have ECMP, then the load-balance has only one choice.</p></li>
<li><p>In order to collect per-route counters, the lookup result must in some way uniquely identify the <em>fib_entry_t</em>. A shared load-balance (contributed by the path-list) would not allow this.</p></li>
<li><p>In the case the <em>fib_entry_t</em> has MPLS out labels, and hence a <em>fib_path_ext_t</em>, then the load-balance must be per-prefix, since the MPLS labels that are its parents are themselves per-fib_entry_t.</p></li>
</ul>
<figure class="align-default">
<img alt="../../../_images/fib20fig9.png" src="../../../_images/fib20fig9.png" />
</figure>
<p>Figure 9: DPO contribution for a recursive route.</p>
<p>Figure 9 shows the load-balance objects contributed for a recursive route.</p>
<figure class="align-default">
<img alt="../../../_images/fib20fig10.png" src="../../../_images/fib20fig10.png" />
</figure>
<p>Figure 10: DPO Contributions from labelled recursive routes.</p>
<p>Figure 10 shows the derived data-plane graph for a labelled recursive route.
There can be as many MPLS-label DPO instances as there are routes multiplied by
the number of paths per-route. For this reason the mpls-label DPO should be as
small as possible <a class="footnote-reference brackets" href="#f19" id="id4">4</a>.</p>
<p>The data-plane graph is constructed by ‘stacking’ one
instance of a DPO on another to form the child-parent relationship. When this
stacking occurs, the necessary VLIB graph arcs are automatically constructed
from the respected DPO type’s registered graph nodes.</p>
<p>The diagrams above show that for any given route the full data-plane graph is
known before any packet arrives. If that graph is composed of n objects, then the
packet will visit n nodes and thus incur a forwarding cost of approximately n
times the graph node cost. This could be reduced if the graph were <em>collapsed</em>
into fewer DPOs and nodes. There are two ways we might consider doing
this:</p>
<ul class="simple">
<li><p>write custom DPOs/nodes for combined functions, e.g. pop MPLS label
and lookup in v4 table. This has the disadvantage that the number of
such nodes would be, well, combinatorial, and resolving a path via
a combined DPO would be more difficult as it would involve a
forward walk of the graph to determine what the combination
is. However, VPP power users might consider this option for a
limited set of their use cases where performance is truly king.</p></li>
<li><p>collapse multiple levels of load-balancing into one. For example,
if there were two levels of load-balancing each with two choices,
this could equally be represented by one level with 4 choices.</p></li>
</ul>
<p>In either case a disadvantage to collapsing the graph is that it
removes the indirection objects that provide fast convergence (see
section Fast Convergence). To collapse is then a trade-off between
faster forwarding and fast convergence; VPP favours the latter.</p>
<p class="rubric">Footnotes:</p>
<dl class="footnote brackets">
<dt class="label" id="f16"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Directed implies it cannot be back-walked. It is acyclic even in the presence of a recursion loop.</p>
</dd>
<dt class="label" id="f17"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Loaded into cache, and hence potentially incurring a d-cache miss.</p>
</dd>
<dt class="label" id="f18"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>The engaged reader is directed to vnet/vnet/dpo/*</p>
</dd>
<dt class="label" id="f19"><span class="brackets"><a class="fn-backref" href="#id4">4</a></span></dt>
<dd><p>i.e. we should not re-use the adjacency structure.</p>
</dd>
</dl>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="marknsweep.html" class="btn btn-neutral float-left" title="Mark and Sweep" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tunnels.html" class="btn btn-neutral float-right" title="Tunnels" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>