<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SELinux - VPP Custom SELinux Policy &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Adding a new plugin or feature" href="../plugindoc/index.html" />
    <link rel="prev" title="Statistics" href="stats.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Core Features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fib/index.html">The FIB</a></li>
<li class="toctree-l2"><a class="reference internal" href="sr/index.html">Segment routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="punt.html">Punting Packets</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec.html">IPSec (IP Security)</a></li>
<li class="toctree-l2"><a class="reference internal" href="bfd_doc.html">BFD module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipfix_doc.html">IPFIX support</a></li>
<li class="toctree-l2"><a class="reference internal" href="span_doc.html">Switched Port Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="mtu.html">MTU in VPP</a></li>
<li class="toctree-l2"><a class="reference internal" href="sylog_doc.html">Syslog protocol support</a></li>
<li class="toctree-l2"><a class="reference internal" href="eventviewer.html">Event-logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats.html">Statistics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SELinux - VPP Custom SELinux Policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fresh-install-of-vpp">Fresh Install of VPP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fix-selinux-labels-for-vpp">Fix SELinux Labels for VPP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vpp-files">VPP Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#recommended-default-file-directories">Recommended Default File Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-of-non-default-file-directories">Use of Non-default File Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vpp-selinux-types">VPP SELinux Types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debug-selinux-issues">Debug SELinux Issues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#additional-selinux-packages-and-setup">Additional SELinux Packages and Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Core Features</a> &raquo;</li>
      <li>SELinux - VPP Custom SELinux Policy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/developer/corefeatures/selinux_doc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="selinux-vpp-custom-selinux-policy">
<span id="selinux-doc"></span><h1>SELinux - VPP Custom SELinux Policy<a class="headerlink" href="#selinux-vpp-custom-selinux-policy" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Security-enhanced Linux (SELinux) is a security feature in the Linux
kernel. At a very high level, SELinux implements mandatory access
controls (MAC), as opposed to discretionary access control (DAC)
implemented in standard Linux. MAC defines how processes can interact
with other system components (Files, Directories, Other Processes,
Pipes, Sockets, Network Ports). Each system component is assigned a
label, and then the SELinux Policy defines which labels and which
actions on each label a process is able to perform. The VPP Custom
SELinux Policy defines the actions VPP is allowed to perform on which
labels.</p>
<p>The VPP Custom SELinux Policy is intended to be installed on RPM based
platforms (tested on CentOS 7 and RHEL 7). Though SELinux can run on
Debian platforms, it typically is not and therefore is not currently
being built for Debian.</p>
<p>The VPP Custom SELinux Policy does not enable or disable SELinux, only
allows VPP to run when SELinux is enabled. A fresh install of either
Fedora, CentOS or RHEL will have SELinux enabled by default. To
determine if SELinux is enabled on a given system and enable it if
needed, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ getenforce
Permissive

$ sudo setenforce 1

$ getenforce
Enforcing
</pre></div>
</div>
<p>To make the change persistent, modify the following file to set
<code class="docutils literal notranslate"><span class="pre">SELINUX=enforcing</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo vi /etc/selinux/config
:
# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=enforcing
:
</pre></div>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline"></a></h2>
<p>To install VPP, see the installation instructions on the VPP Wiki
(<a class="reference external" href="https://wiki.fd.io/view/VPP/Installing_VPP_binaries_from_packages">https://wiki.fd.io/view/VPP/Installing_VPP_binaries_from_packages</a>). The
VPP Custom SELinux Policy is packaged in its own RPM starting in 18.04,
<code class="docutils literal notranslate"><span class="pre">vpp-selinux-policy-&lt;VERSION&gt;-&lt;RELEASE&gt;.rpm</span></code>. It is packaged and
installed along with the other VPP RPMs.</p>
<section id="fresh-install-of-vpp">
<h3>Fresh Install of VPP<a class="headerlink" href="#fresh-install-of-vpp" title="Permalink to this headline"></a></h3>
<p>If VPP has never been installed on a system, then starting in 18.04, the
VPP Custom SELinux Policy will be installed with the other RPMs and all
the system components managed by VPP will be labeled properly.</p>
</section>
<section id="fix-selinux-labels-for-vpp">
<h3>Fix SELinux Labels for VPP<a class="headerlink" href="#fix-selinux-labels-for-vpp" title="Permalink to this headline"></a></h3>
<p>In the case where the VPP Custom Policy is being installed for the first
time, either because VPP has been upgraded or packages were removed and
then reinstalled, several directories and files will not not be properly
labeled. The labels on these files will need to be fixed for VPP to run
properly with SELinux enabled. After the VPP Custom SELinux Policy is
installed, run the following commands to fix the labels. If VPP is
already running, make sure to restart VPP after the labels are fixed.
This change is persistent for the life of the file. Once the VPP Custom
Policy is installed on the system, subsequent files created by VPP will
be labeled properly. This is only to fix files created by VPP prior to
the VPP Custom Policy being installed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo restorecon -Rv /etc/vpp/
$ sudo restorecon -Rv /usr/lib/vpp_api_test_plugins/
$ sudo restorecon -Rv /usr/lib/vpp_plugins/
$ sudo restorecon -Rv /usr/share/vpp/
$ sudo restorecon -Rv /var/run/vpp/

$ sudo chcon -t vpp_tmp_t /tmp/vpp_*
$ sudo chcon -t vpp_var_run_t /var/run/.vpp_*
</pre></div>
</div>
<p><strong>NOTE:</strong> Because the VPP APIs allow custom filenames in certain
scenarios, the above commands may not handle all files. Inspect your
system and correct any files that are mislabeled. For example, to verify
all VPP files in <code class="docutils literal notranslate"><span class="pre">/tmp/</span></code> are labeled properly, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo ls -alZ /tmp/
</pre></div>
</div>
<p>Any files not properly labeled with <code class="docutils literal notranslate"><span class="pre">vpp_tmp_t</span></code>, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo chcon -t vpp_tmp_t /tmp/&lt;filename&gt;
</pre></div>
</div>
</section>
</section>
<section id="vpp-files">
<h2>VPP Files<a class="headerlink" href="#vpp-files" title="Permalink to this headline"></a></h2>
<section id="recommended-default-file-directories">
<h3>Recommended Default File Directories<a class="headerlink" href="#recommended-default-file-directories" title="Permalink to this headline"></a></h3>
<p>Documentation in the VPP Wiki (<a class="reference external" href="https://wiki.fd.io/view/VPP/">https://wiki.fd.io/view/VPP/</a>) and doxygen
generated documentation have examples with files located in certain
directories. Some of the recommend file locations have been moved to
satisfy SELinux. Most of the documentation has been updated, but links
to older documentation still exist and there may have been instances
that were missed. Use the file locations described below to allow
SELinux to properly label the given files.</p>
<p>File locations that have changed: * VPP Debug CLI Script Files * vHost
Sockets * VPP Log Files</p>
<section id="vpp-debug-cli-script-files">
<h4>VPP Debug CLI Script Files<a class="headerlink" href="#vpp-debug-cli-script-files" title="Permalink to this headline"></a></h4>
<p>The VPP Debug CLI, <code class="docutils literal notranslate"><span class="pre">vppctl</span></code>, allows a sequence of CLI commands to be
read from a file and executed. To avoid from having to grant VPP access
to all of <code class="docutils literal notranslate"><span class="pre">/tmp/</span></code> and possibly <code class="docutils literal notranslate"><span class="pre">/home/</span></code> sub-directories, it is
recommended that any VPP Debug CLI script files be placed in a common
directory such as <code class="docutils literal notranslate"><span class="pre">/usr/share/vpp/</span></code>.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat /usr/share/vpp/scripts/gigup.txt
set interface state GigabitEthernet0/8/0 up
set interface state GigabitEthernet0/9/0 up
</pre></div>
</div>
<p>To execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vppctl exec /usr/share/vpp/scripts/gigup.txt
</pre></div>
</div>
<p>Or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vppctl
    _______    _        _   _____  ___
 __/ __/ _ \  (_)__    | | / / _ \/ _ \
 _/ _// // / / / _ \   | |/ / ___/ ___/
 /_/ /____(_)_/\___/   |___/_/  /_/

vpp# exec /usr/share/vpp/scripts/gigup.txt
vpp# quit
</pre></div>
</div>
<p>If the file is not labeled properly, you will see something similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vppctl exec /home/&lt;user&gt;/dev/vpp/scripts/vppctl/gigup.txt
exec: failed to open `/home/&lt;user&gt;/dev/vpp/scripts/vppctl/gigup.txt&#39;: Permission denied

$ ls -alZ
drwxrwxr-x. &lt;user&gt; &lt;user&gt; unconfined_u:object_r:user_home_t:s0 .
drwxrwxr-x. &lt;user&gt; &lt;user&gt; unconfined_u:object_r:user_home_t:s0 ..
-rw-r--r--. &lt;user&gt; &lt;user&gt; unconfined_u:object_r:user_home_t:s0 gigup.txt
</pre></div>
</div>
<section id="original-documentation">
<h5>Original Documentation<a class="headerlink" href="#original-documentation" title="Permalink to this headline"></a></h5>
<p>Some of the original documentation showed script files being executed
out of <code class="docutils literal notranslate"><span class="pre">/tmp/</span></code>. Convenience also may lead to script files being placed
in <code class="docutils literal notranslate"><span class="pre">/home/&lt;user&gt;/</span></code> subdirectories. If a file is generated by the VPP
process in <code class="docutils literal notranslate"><span class="pre">/tmp/</span></code>, for example a trace file or pcap file, it will get
properly labeled with the SELinux label <code class="docutils literal notranslate"><span class="pre">vpp_tmp_t</span></code>. When a file is
created, unless a rule is in place for the process that created it, the
file will inherit the SELinux label of the parent directory. So if a
user creates a file themselves in <code class="docutils literal notranslate"><span class="pre">/tmp/</span></code>, it will get the SELinux
label <code class="docutils literal notranslate"><span class="pre">tmp_t</span></code>, which VPP does not have permission to access. Therefore
it is recommended that script files are located as described above.</p>
</section>
</section>
<section id="vhost-sockets">
<h4>vHost Sockets<a class="headerlink" href="#vhost-sockets" title="Permalink to this headline"></a></h4>
<p>vHost sockets are created from VPP perspective in either Server or
Client mode. In Server mode, the socket name is provided to VPP and VPP
creates the socket. In Client mode, the socket name is provided to VPP
and the hypervisor creates the socket. In order for VPP and hypervisor
to share the socket resource with SELinux enabled, a rule in the VPP
Custom SELinux Policy has been added. This rules allows processes with
the <code class="docutils literal notranslate"><span class="pre">svirt_t</span></code> label (the hypervisor) to access sockets with the
<code class="docutils literal notranslate"><span class="pre">vpp_var_run_t</span></code> label. As such, when SELinux is enabled, vHost sockets
should be created in the directory <code class="docutils literal notranslate"><span class="pre">/var/run/vpp/</span></code>.</p>
<section id="original-documentation-1">
<span id="id1"></span><h5>Original Documentation<a class="headerlink" href="#original-documentation-1" title="Permalink to this headline"></a></h5>
<p>Some of the original documentation showed vHost sockets being created in
the directory <code class="docutils literal notranslate"><span class="pre">/tmp/</span></code>. To work properly with SELinux enabled, vHost
sockets should be created as described above.</p>
</section>
</section>
<section id="vpp-log-files">
<h4>VPP Log Files<a class="headerlink" href="#vpp-log-files" title="Permalink to this headline"></a></h4>
<p>The VPP log file location is set by updating the
<code class="docutils literal notranslate"><span class="pre">/etc/vpp/startup.conf</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">startup</span><span class="o">.</span><span class="n">conf</span>
<span class="n">unix</span> <span class="p">{</span>
<span class="p">:</span>
  <span class="n">log</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">vpp</span><span class="o">.</span><span class="n">log</span>
<span class="p">:</span>
<span class="p">}</span>
</pre></div>
</div>
<p>By moving the log file to <code class="docutils literal notranslate"><span class="pre">/var/log/vpp/</span></code>, it will get the label
<code class="docutils literal notranslate"><span class="pre">vpp_log_t</span></code>, which indicates that the files are log files so they
benefit from the associated rules (for example granting rights to
logrotate so that it can manipulate them).</p>
<section id="original-documentation-2">
<span id="id2"></span><h5>Original Documentation<a class="headerlink" href="#original-documentation-2" title="Permalink to this headline"></a></h5>
<p>The default <code class="docutils literal notranslate"><span class="pre">startup.conf</span></code> file creates the VPP log file in
<code class="docutils literal notranslate"><span class="pre">/tmp/vpp.log</span></code>. By leaving the log file in <code class="docutils literal notranslate"><span class="pre">/tmp/</span></code>, it will get the
label <code class="docutils literal notranslate"><span class="pre">vpp_tmp_t</span></code>. Moving it to <code class="docutils literal notranslate"><span class="pre">/var/log/vpp/</span></code>, it will get the
label <code class="docutils literal notranslate"><span class="pre">vpp_log_t</span></code>.</p>
</section>
</section>
</section>
<section id="use-of-non-default-file-directories">
<h3>Use of Non-default File Directories<a class="headerlink" href="#use-of-non-default-file-directories" title="Permalink to this headline"></a></h3>
<p>VPP installs multiple files on the system. Some files have fixed
directory and file names: - /etc/bash_completion.d/vppctl_completion -
/etc/sysctl.d/80-vpp.conf - /usr/lib/systemd/system/vpp.service</p>
<p>Others files have default directory and file names but the default can
be overwritten: - /etc/vpp/startup.conf - Can be changed via the
<code class="docutils literal notranslate"><span class="pre">/usr/lib/systemd/system/vpp.service</span></code> file by changing the -c option
on the VPP command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">vpp</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">startup</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<ul class="simple">
<li><p>/run/vpp/cli.sock</p>
<ul>
<li><p>Can be changed via the <code class="docutils literal notranslate"><span class="pre">/etc/vpp/startup.conf</span></code> file by changing
the cli-listen setting:</p></li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unix</span> <span class="p">{</span>
<span class="p">:</span>
  <span class="n">cli</span><span class="o">-</span><span class="n">listen</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">cli</span><span class="o">.</span><span class="n">sock</span>
<span class="p">:</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>/var/log/vpp/vpp.log</p>
<ul>
<li><p>Can be changed via the <code class="docutils literal notranslate"><span class="pre">/etc/vpp/startup.conf</span></code> file by changing
the log setting:</p></li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unix</span> <span class="p">{</span>
  <span class="p">:</span>
  <span class="n">log</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span><span class="n">vpp</span><span class="o">.</span><span class="n">log</span>
  <span class="p">:</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the directory of any VPP installed files is changed from the default,
ensure that the proper SELiunx label is applied. The SELinux label can
be determined by passing the -Z option to many common Linux commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">-</span><span class="n">alZ</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">vpp</span><span class="o">/</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span> <span class="n">root</span> <span class="n">vpp</span>  <span class="n">system_u</span><span class="p">:</span><span class="n">object_r</span><span class="p">:</span><span class="n">vpp_var_run_t</span><span class="p">:</span><span class="n">s0</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span> <span class="n">root</span> <span class="n">root</span> <span class="n">system_u</span><span class="p">:</span><span class="n">object_r</span><span class="p">:</span><span class="n">var_run_t</span><span class="p">:</span><span class="n">s0</span>     <span class="o">..</span>
<span class="n">srwxrwxr</span><span class="o">-</span><span class="n">x</span><span class="o">.</span> <span class="n">root</span> <span class="n">vpp</span>  <span class="n">system_u</span><span class="p">:</span><span class="n">object_r</span><span class="p">:</span><span class="n">vpp_var_run_t</span><span class="p">:</span><span class="n">s0</span> <span class="n">cli</span><span class="o">.</span><span class="n">sock</span>
</pre></div>
</div>
</section>
<section id="vpp-selinux-types">
<h3>VPP SELinux Types<a class="headerlink" href="#vpp-selinux-types" title="Permalink to this headline"></a></h3>
<p>The following SELinux types are created by the VPP Custom SELinux
Policy: - <code class="docutils literal notranslate"><span class="pre">vpp_t</span></code> - Applied to: - VPP process and spawned threads.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vpp_config_rw_t</span></code> - Applied to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/vpp/*</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpp_tmp_t</span></code> - Applied to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/*</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpp_exec_t</span></code> - Applied to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/bin/*</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpp_lib_t</span></code> - Applied to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/lib/vpp_api_test_plugins/*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/lib/vpp_plugins/*</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpp_unit_file_t</span></code> - Applied to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/lib/systemd/system/vpp.*</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpp_log_t</span></code> - Applied to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/vpp/*</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vpp_var_run_t</span></code> - Applied to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/run/vpp/*</span></code></p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="debug-selinux-issues">
<h2>Debug SELinux Issues<a class="headerlink" href="#debug-selinux-issues" title="Permalink to this headline"></a></h2>
<p>If SELinux issues are suspected, there are a few steps that can be taken
to debug the issue. This section provides a few pointers on on those
steps. Any SELinux JIRAs will need this information to properly address
the issue.</p>
<section id="additional-selinux-packages-and-setup">
<h3>Additional SELinux Packages and Setup<a class="headerlink" href="#additional-selinux-packages-and-setup" title="Permalink to this headline"></a></h3>
<p>First, install the SELinux troubleshooting packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo yum -y install setroubleshoot setroubleshoot-server setools-console
-- OR --
$ sudo dnf -y install setroubleshoot setroubleshoot-server setools-console
</pre></div>
</div>
<p>To enable proper logging, restart auditd:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo service auditd restart
</pre></div>
</div>
<p>While debugging issues, it is best to set SELinux to <code class="docutils literal notranslate"><span class="pre">Permissive</span></code>
mode. In <code class="docutils literal notranslate"><span class="pre">Permissive</span></code> mode, SELinux will still detect and flag errors,
but will allow processes to continue normal operation. This allows
multiple errors to be collected at once as opposed to breaking on each
individual error. To set SELinux to <code class="docutils literal notranslate"><span class="pre">Permissive</span></code> mode (until next
reboot or it is set back), use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo setenforce 0

$ getenforce
Permissive
</pre></div>
</div>
<p>After debugging, to set SELinux back to <code class="docutils literal notranslate"><span class="pre">Enforcing</span></code> mode, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo setenforce 1

$ getenforce
Enforcing
</pre></div>
</div>
</section>
<section id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline"></a></h3>
<p>Once the SELinux troubleshooting packages are installed, perform the
actions that are suspected to be blocked by SELinux. Either <code class="docutils literal notranslate"><span class="pre">tail</span></code> the
log during these actions or <code class="docutils literal notranslate"><span class="pre">grep</span></code> the log for additional SELinux
logs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">messages</span>
<span class="o">--</span> <span class="n">OR</span> <span class="o">--</span>
<span class="n">sudo</span> <span class="n">journalctl</span> <span class="o">-</span><span class="n">f</span>
</pre></div>
</div>
<p>Below are some examples of SELinux logs that are generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">May</span> <span class="mi">14</span> <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">34</span> <span class="n">svr</span><span class="o">-</span><span class="mi">22</span> <span class="n">setroubleshoot</span><span class="p">:</span> <span class="n">SELinux</span> <span class="ow">is</span> <span class="n">preventing</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">vpp</span> <span class="kn">from</span> <span class="nn">read</span> <span class="n">access</span> <span class="n">on</span> <span class="n">the</span> <span class="n">file</span> <span class="n">hostCreate</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span> <span class="n">For</span> <span class="n">complete</span> <span class="n">SELinux</span> <span class="n">messages</span> <span class="n">run</span><span class="p">:</span> <span class="n">sealert</span> <span class="o">-</span><span class="n">l</span> <span class="n">a418f869</span><span class="o">-</span><span class="n">f470</span><span class="o">-</span><span class="mi">4</span><span class="n">c8a</span><span class="o">-</span><span class="n">b8e9</span><span class="o">-</span><span class="n">bdd41f2dd60b</span>
<span class="n">May</span> <span class="mi">14</span> <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">34</span> <span class="n">svr</span><span class="o">-</span><span class="mi">22</span> <span class="n">python</span><span class="p">:</span> <span class="n">SELinux</span> <span class="ow">is</span> <span class="n">preventing</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">vpp</span> <span class="kn">from</span> <span class="nn">read</span> <span class="n">access</span> <span class="n">on</span> <span class="n">the</span> <span class="n">file</span> <span class="n">hostCreate</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="c1">#012#012*****  Plugin catchall (100. confidence) suggests   **************************#012#012If you believe that vpp should be allowed read access on the hostCreate.txt file by default.#012Then you should report this as a bug.#012You can generate a local policy module to allow this access.#012Do#012allow this access for now by executing:#012# ausearch -c &#39;vpp_main&#39; --raw | audit2allow -M my-vppmain#012# semodule -i my-vppmain.pp#012</span>
<span class="n">May</span> <span class="mi">14</span> <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">34</span> <span class="n">svr</span><span class="o">-</span><span class="mi">22</span> <span class="n">setroubleshoot</span><span class="p">:</span> <span class="n">SELinux</span> <span class="ow">is</span> <span class="n">preventing</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">vpp</span> <span class="kn">from</span> <span class="nn">read</span> <span class="n">access</span> <span class="n">on</span> <span class="n">the</span> <span class="n">file</span> <span class="n">hostCreate</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span> <span class="n">For</span> <span class="n">complete</span> <span class="n">SELinux</span> <span class="n">messages</span> <span class="n">run</span><span class="p">:</span> <span class="n">sealert</span> <span class="o">-</span><span class="n">l</span> <span class="n">a418f869</span><span class="o">-</span><span class="n">f470</span><span class="o">-</span><span class="mi">4</span><span class="n">c8a</span><span class="o">-</span><span class="n">b8e9</span><span class="o">-</span><span class="n">bdd41f2dd60b</span>
<span class="n">May</span> <span class="mi">14</span> <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">34</span> <span class="n">svr</span><span class="o">-</span><span class="mi">22</span> <span class="n">python</span><span class="p">:</span> <span class="n">SELinux</span> <span class="ow">is</span> <span class="n">preventing</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">vpp</span> <span class="kn">from</span> <span class="nn">read</span> <span class="n">access</span> <span class="n">on</span> <span class="n">the</span> <span class="n">file</span> <span class="n">hostCreate</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="c1">#012#012*****  Plugin catchall (100. confidence) suggests   **************************#012#012If you believe that vpp should be allowed read access on the hostCreate.txt file by default.#012Then you should report this as a bug.#012You can generate a local policy module to allow this access.#012Do#012allow this access for now by executing:#012# ausearch -c &#39;vpp_main&#39; --raw | audit2allow -M my-vppmain#012# semodule -i my-vppmain.pp#012</span>
<span class="n">May</span> <span class="mi">14</span> <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">37</span> <span class="n">svr</span><span class="o">-</span><span class="mi">22</span> <span class="n">setroubleshoot</span><span class="p">:</span> <span class="n">SELinux</span> <span class="ow">is</span> <span class="n">preventing</span> <span class="n">vpp_main</span> <span class="kn">from</span> <span class="nn">map</span> <span class="n">access</span> <span class="n">on</span> <span class="n">the</span> <span class="n">packet_socket</span> <span class="n">packet_socket</span><span class="o">.</span> <span class="n">For</span> <span class="n">complete</span> <span class="n">SELinux</span> <span class="n">messages</span> <span class="n">run</span><span class="p">:</span> <span class="n">sealert</span> <span class="o">-</span><span class="n">l</span> <span class="n">ab6667d9</span><span class="o">-</span><span class="mi">3</span><span class="n">f14</span><span class="o">-</span><span class="mi">4</span><span class="n">dbd</span><span class="o">-</span><span class="mi">96</span><span class="n">a0</span><span class="o">-</span><span class="mi">7</span><span class="n">a655f7b4eb1</span>
<span class="n">May</span> <span class="mi">14</span> <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">37</span> <span class="n">svr</span><span class="o">-</span><span class="mi">22</span> <span class="n">python</span><span class="p">:</span> <span class="n">SELinux</span> <span class="ow">is</span> <span class="n">preventing</span> <span class="n">vpp_main</span> <span class="kn">from</span> <span class="nn">map</span> <span class="n">access</span> <span class="n">on</span> <span class="n">the</span> <span class="n">packet_socket</span> <span class="n">packet_socket</span><span class="o">.</span><span class="c1">#012#012*****  Plugin catchall (100. confidence) suggests   **************************#012#012If you believe that vpp_main should be allowed map access on the packet_socket packet_socket by default.#012Then you should report this as a bug.#012You can generate a local policy module to allow this access.#012Do#012allow this access for now by executing:#012# ausearch -c &#39;vpp_main&#39; --raw | audit2allow -M my-vppmain#012# semodule -i my-vppmain.pp#012</span>
<span class="n">May</span> <span class="mi">14</span> <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">51</span> <span class="n">svr</span><span class="o">-</span><span class="mi">22</span> <span class="n">setroubleshoot</span><span class="p">:</span> <span class="n">SELinux</span> <span class="ow">is</span> <span class="n">preventing</span> <span class="n">vpp_main</span> <span class="kn">from</span> <span class="nn">map</span> <span class="n">access</span> <span class="n">on</span> <span class="n">the</span> <span class="n">packet_socket</span> <span class="n">packet_socket</span><span class="o">.</span> <span class="n">For</span> <span class="n">complete</span> <span class="n">SELinux</span> <span class="n">messages</span> <span class="n">run</span><span class="p">:</span> <span class="n">sealert</span> <span class="o">-</span><span class="n">l</span> <span class="n">ab6667d9</span><span class="o">-</span><span class="mi">3</span><span class="n">f14</span><span class="o">-</span><span class="mi">4</span><span class="n">dbd</span><span class="o">-</span><span class="mi">96</span><span class="n">a0</span><span class="o">-</span><span class="mi">7</span><span class="n">a655f7b4eb1</span>
<span class="n">May</span> <span class="mi">14</span> <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">51</span> <span class="n">svr</span><span class="o">-</span><span class="mi">22</span> <span class="n">python</span><span class="p">:</span> <span class="n">SELinux</span> <span class="ow">is</span> <span class="n">preventing</span> <span class="n">vpp_main</span> <span class="kn">from</span> <span class="nn">map</span> <span class="n">access</span> <span class="n">on</span> <span class="n">the</span> <span class="n">packet_socket</span> <span class="n">packet_socket</span><span class="o">.</span><span class="c1">#012#012*****  Plugin catchall (100. confidence) suggests   **************************#012#012If you believe that vpp_main should be allowed map access on the packet_socket packet_socket by default.#012Then you should report this as a bug.#012You can generate a local policy module to allow this access.#012Do#012allow this access for now by executing:#012# ausearch -c &#39;vpp_main&#39; --raw | audit2allow -M my-vppmain#012# semodule -i my-vppmain.pp#012</span>
</pre></div>
</div>
<p>From the logs above, there are two sets of commands that are recommended
to be run. The first is to run the <code class="docutils literal notranslate"><span class="pre">sealert</span></code> command. The second is to
run the <code class="docutils literal notranslate"><span class="pre">ausearch</span> <span class="pre">|</span> <span class="pre">audit2allow</span></code> commands and the <code class="docutils literal notranslate"><span class="pre">semodule</span></code>
command.</p>
<section id="sealert-command">
<h4>sealert Command<a class="headerlink" href="#sealert-command" title="Permalink to this headline"></a></h4>
<p>This <code class="docutils literal notranslate"><span class="pre">sealert</span></code> command provides a more detailed output for the given
issue detected.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sealert -l a418f869-f470-4c8a-b8e9-bdd41f2dd60b
SELinux is preventing /usr/bin/vpp from &#39;read, write&#39; accesses on the chr_file noiommu-0.

*****  Plugin device (91.4 confidence) suggests   ****************************

If you want to allow vpp to have read write access on the noiommu-0 chr_file
Then you need to change the label on noiommu-0 to a type of a similar device.
Do
# semanage fcontext -a -t SIMILAR_TYPE &#39;noiommu-0&#39;
# restorecon -v &#39;noiommu-0&#39;

*****  Plugin catchall (9.59 confidence) suggests   **************************

If you believe that vpp should be allowed read write access on the noiommu-0 chr_file by default.
Then you should report this as a bug.
You can generate a local policy module to allow this access.
Do
allow this access for now by executing:
# ausearch -c &#39;vpp&#39; --raw | audit2allow -M my-vpp
# semodule -i my-vpp.pp


Additional Information:
Source Context                system_u:system_r:vpp_t:s0
Target Context                system_u:object_r:device_t:s0
Target Objects                noiommu-0 [ chr_file ]
Source                        vpp
Source Path                   /usr/bin/vpp
Port                          &lt;Unknown&gt;
Host                          vpp_centos7_selinux
Source RPM Packages           vpp-19.01.2-rc0~17_gcfd3086.x86_64
Target RPM Packages
Policy RPM                    selinux-policy-3.13.1-229.el7_6.12.noarch
Selinux Enabled               True
Policy Type                   targeted
Enforcing Mode                Permissive
Host Name                     vpp_centos7_selinux
Platform                      Linux vpp_centos7_selinux
                              3.10.0-957.12.1.el7.x86_64 #1 SMP Mon Apr 29
                              14:59:59 UTC 2019 x86_64 x86_64
Alert Count                   1
First Seen                    2019-05-13 18:10:50 EDT
Last Seen                     2019-05-13 18:10:50 EDT
Local ID                      a418f869-f470-4c8a-b8e9-bdd41f2dd60b

Raw Audit Messages
type=AVC msg=audit(1557785450.964:257): avc:  denied  { read write } for  pid=5273 comm=&quot;vpp&quot; name=&quot;noiommu-0&quot; dev=&quot;devtmpfs&quot; ino=36022 scontext=system_u:system_r:vpp_t:s0 tcontext=system_u:object_r:device_t:s0 tclass=chr_file permissive=1


type=AVC msg=audit(1557785450.964:257): avc:  denied  { open } for  pid=5273 comm=&quot;vpp&quot; path=&quot;/dev/vfio/noiommu-0&quot; dev=&quot;devtmpfs&quot; ino=36022 scontext=system_u:system_r:vpp_t:s0 tcontext=system_u:object_r:device_t:s0 tclass=chr_file permissive=1


type=SYSCALL msg=audit(1557785450.964:257): arch=x86_64 syscall=open success=yes exit=ENOTBLK a0=7fb395ffd7f0 a1=2 a2=7fb395ffd803 a3=7fb395ffe2a0 items=0 ppid=1 pid=5273 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=993 sgid=0 fsgid=993 tty=(none) ses=4294967295 comm=vpp exe=/usr/bin/vpp subj=system_u:system_r:vpp_t:s0 key=(null)

Hash: vpp,vpp_t,device_t,chr_file,read,write
</pre></div>
</div>
<p>In general, this command pumps out too much info and is only needed for
additional debugging for tougher issues. Also note that once the process
being tested is restarted, this command loses it’s context and will not
provide any information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sealert -l a418f869-f470-4c8a-b8e9-bdd41f2dd60b
Error
query_alerts error (1003): id (a418f869-f470-4c8a-b8e9-bdd41f2dd60b) not found
</pre></div>
</div>
</section>
<section id="ausearch-audit2allow-and-semodule-commands">
<h4>ausearch | audit2allow and semodule Commands<a class="headerlink" href="#ausearch-audit2allow-and-semodule-commands" title="Permalink to this headline"></a></h4>
<p>These set of commands are more useful for basic debugging. The
<code class="docutils literal notranslate"><span class="pre">ausearch</span> <span class="pre">|</span> <span class="pre">audit2allow</span></code> commands generate a set files. It may be
worthwhile to run the commands in a temporary subdirectory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir test-01/; cd test-01/

$ sudo ausearch -c &#39;vpp_main&#39; --raw | audit2allow -M my-vppmain

$ ls
my-vpp.pp  my-vpp.te

$ cat my-vpp.te
module my-vpp 1.0;

require {
        type user_home_t;
        type vpp_t;
        class packet_socket map;
        class file { open read };
}

#============= vpp_t ==============
allow vpp_t self:packet_socket map;
allow vpp_t user_home_t:file { open read };
</pre></div>
</div>
<p>As shown above, the file <code class="docutils literal notranslate"><span class="pre">my-vpp.te</span></code> has been generated. This file
shows possible changes to the SELinux policy that may fix the issue. If
an SELinux policy was being created from scratch, this policy could be
applied using the <code class="docutils literal notranslate"><span class="pre">semodule</span> <span class="pre">-i</span> <span class="pre">my-vpp.pp</span></code> command. HOWEVER, VPP
already has a policy in place. So these changes need to be incorporated
into the existing policy. The VPP SELinux policy is located in the
following files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls extras/selinux/
selinux_doc.md  vpp-custom.fc  vpp-custom.if  vpp-custom.te
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">map</span></code> needs to be added to the <code class="docutils literal notranslate"><span class="pre">packet_socket</span></code>
class. If the <code class="docutils literal notranslate"><span class="pre">vpp-custom.te</span></code> is examined (prior to this fix), then
one would see that the <code class="docutils literal notranslate"><span class="pre">packet_socket</span></code> class is already defined and
just needs to be updated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vi extras/selinux/vpp-custom.te
:
allow vpp_t self:process { execmem execstack setsched signal }; # too benevolent
allow vpp_t self:packet_socket { bind create setopt ioctl };  &lt;---
allow vpp_t self:tun_socket { create relabelto relabelfrom };
:
</pre></div>
</div>
<p>Before blindly applying the changes proposed by the
<code class="docutils literal notranslate"><span class="pre">ausearch</span> <span class="pre">|</span> <span class="pre">audit2allow</span></code> commands, try to determine what is being
allowed by the policy and determine if this is desired, or if the code
can be reworked to no longer require the suggested permission. In the
<code class="docutils literal notranslate"><span class="pre">my-vpp.te</span></code> file from above, it is suggested to allow <code class="docutils literal notranslate"><span class="pre">vpp_t</span></code>
(i.e. the VPP process) access to all files in the home directory
(<code class="docutils literal notranslate"><span class="pre">allow</span> <span class="pre">vpp_t</span> <span class="pre">user_home_t:file</span> <span class="pre">{</span> <span class="pre">open</span> <span class="pre">read</span> <span class="pre">};</span></code>). This was because a
<code class="docutils literal notranslate"><span class="pre">vppctl</span> <span class="pre">exec</span></code> command was executed calling a script located in the
<code class="docutils literal notranslate"><span class="pre">/home/&lt;user&gt;/</span></code> directory. Once this script was run from the
<code class="docutils literal notranslate"><span class="pre">/usr/share/vpp/</span></code> directory as described in a section above, these
permissions were no longer needed.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="stats.html" class="btn btn-neutral float-left" title="Statistics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../plugindoc/index.html" class="btn btn-neutral float-right" title="Adding a new plugin or feature" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>