

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Neighbours &mdash; The Vector Packet Processor master documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/rules.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Routes" href="routes.html" />
    <link rel="prev" title="The Control Plane" href="controlplane.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Vector Packet Processor
          

          
            
            <img src="../../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../whatisvpp/index.html">The Vector Packet Processor (VPP)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">For Users</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">For Developers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../building.html">Building VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../running_vpp.html">Running VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../testing_vpp.html">Testing VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gdb_examples.html">GDB Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add_plugin.html">Adding a plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add_plugin_goapi.html">Add a pluginâ€™s GO API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../softwarearchitecture.html">Software Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infrastructure.html">VPPINFRA (Infrastructure)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html">VLIB (Vector Processing Library)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html#packet-generator-input-script">Packet generator input script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html#start-vpp-with-2-worker-threads">Start vpp with 2 worker threads</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html#enable-tracing-and-start-the-packet-generator">Enable tracing, and start the packet generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html#sample-run">Sample Run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vnet.html">VNET (VPP Network Stack)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../featurearcs.html">Feature Arcs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../metadata.html">Buffer Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../metadata.html#buffer-metadata-extensions">Buffer Metadata Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multiarch/index.html">Multi-architecture support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bihash.html">Bounded-index Extensible Hashing (bihash)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vpp_api_module.html">VPP API module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../binary_api_support.html">Binary API Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../buildsystem/index.html">Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eventviewer.html">Event-logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eventviewer.html#g2-graphical-event-viewer">G2 graphical event viewer</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">FIB 2.0 Hierarchical, Protocol, Independent</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="thedatamodel.html">The Data Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="tunnels.html">Tunnels</a></li>
<li class="toctree-l4"><a class="reference internal" href="mplsfib.html">MPLS FIB</a></li>
<li class="toctree-l4"><a class="reference internal" href="multicast.html">IP Multicast FIB</a></li>
<li class="toctree-l4"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="fastconvergence.html">Fast Convergence</a></li>
<li class="toctree-l4"><a class="reference internal" href="scale.html">Scale</a></li>
<li class="toctree-l4"><a class="reference internal" href="barnacles.html">Barnacles</a></li>
<li class="toctree-l4"><a class="reference internal" href="hacking.html">Get Hacking</a></li>
<li class="toctree-l4"><a class="reference internal" href="missing.html">Missing Functionality</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../buildwireshark.html">How to build a vpp dispatch trace aware Wireshark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../punt.html">Punting Packets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quic_plugin.html">QUIC HostStack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cross_compile_macos.html">Cross compilation on MacOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cnat.html">Cloud NAT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../VPPAPI.html">VPP API Language    {#api_lang_doc}</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../writingdocs/index.html">Writing Documents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../links/index.html">VPP Wiki, Doxygen and Other Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../relatedprojects/index.html">Related FD.IO Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Vector Packet Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Getting Started</a> &raquo;</li>
        
          <li><a href="../index.html">For Developers</a> &raquo;</li>
        
          <li><a href="index.html">FIB 2.0 Hierarchical, Protocol, Independent</a> &raquo;</li>
        
          <li><a href="thedatamodel.html">The Data Model</a> &raquo;</li>
        
          <li><a href="controlplane.html">The Control Plane</a> &raquo;</li>
        
      <li>Neighbours</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/gettingstarted/developers/fib20/neighbors.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="neighbours">
<span id="neighbors"></span><h1>Neighbours<a class="headerlink" href="#neighbours" title="Permalink to this headline">Â¶</a></h1>
<div class="figure align-default">
<img alt="../../../_images/ip-neighbor.png" src="../../../_images/ip-neighbor.png" />
</div>
<p>Figure 1: Neighbour data model</p>
<p>Figure 1 shows the data model for IP neighbours. An IP neighbour contains the mapping
between a peer, identified by an IPv4 or IPv6 address, and its MAC address on a given
interface. An IP-table (VRF) is not part of the neighbourâ€™s
data/identity. This is because the virtualisation of a router into
different tables (VRFs) is performed at the interface level, i.e. an
IP-table is bound to a particular interface. A neighbour, which is
attached to an interface, is thus implicitly in that table, and
only in that table. It is also worth noting that IP neighbours
contribute forwarding for the egress direction, whereas an IP-table
is an ingress only function.</p>
<p>The <em>ip_neighbor_t</em> represents the control-plane addition of the
neighbour. The <em>ip_adjacency_t</em> contains the data derived from the <em>ip_neighbor_t</em> that is needed to
forward packets to the peer. The additional data in the adjacency are the <em>rewrite</em>
and the <em>link_type</em>. The <em>link_type</em> is a description of the protocol of the packets
that will be forwarded with this adjacency; e.g. IPv4, IPv6 or MPLS. The <em>link_type</em>
maps directly to the ether-type in an Ethernet header, or the protocol filed in a
GRE header. The rewrite is a byte string representation of the header that will be
prepended to the packet when it is sent to that peer. For Ethernet interfaces this
is be the src,dst MAC and the ether-type. For LISP tunnels, the IP src,dst pair
and the LISP header.</p>
<p>The <em>ip_neighbor_t</em> for an IPv4 peer (learned e.g. over ARP) will
install a <em>link_type=IPv4</em> when the entry is created and a
link_type=MPLS on demand (i.e. when a route with output labels resolves via the peer).</p>
<div class="section" id="adjacency">
<h2>Adjacency<a class="headerlink" href="#adjacency" title="Permalink to this headline">Â¶</a></h2>
<p>There are three sub-types of adjacencies. Purists would argue that some
of these sub-types are not really adjacencies but are instead other
forms of DPOs, and it would be hard to argue against that, but
historically (not just in VPP, but in the FIB implementations from
which VPP draws on for some of its concepts), these have been modelled
as adjacency types, the one thing they have in common is that they
have an associated interface and are terminal. The [sub] sub-types are:</p>
<ul class="simple">
<li><p>A Neighbour Adjacency (key={interface, next-hop, link-type}). A
representation of a peer on a link (as described above). A neighbour adjacency itself has
two sub-types; terminal and mid-chain. When one speak of â€˜an
adjacencyâ€™ one is usually referring to a terminal neighbour
sub-type. A mid-chain adjacency represents a neighbor on a virtual
interface which relies on the FIB to perform further forwarding. This
adjacency is thus not terminal for the FIB object graph but instead
appears in the â€˜middleâ€™ (the term chain is a synonym for graph in
some contexts).
A neighbour adjacency can be in one of two states; complete and
incomplete. A complete adjacency knows the rewrite string that
should be used to reach the peer, an incomplete adjacency does
not. If the adjacency was added as a result of the addition of an
<em>ip_neighbor_t</em> then the adjacency will be complete (because the
<em>ip_neighbor_t</em> knows the peerâ€™s MAC address). An incomplete
adjacency is created on demand by the FIB when a routeâ€™s path
requires to resolve through such an adjacency. It is thus created in
order to resolve the missing dependency, it will become complete
once the <em>ip_neighbor_t</em> is discovered.
In the forwarding path a complete adjacency will prepend the rewrite
string and transmit on the egress interface, an incomplete adjacency
will construct a ARP/ND request to resolve the peerâ€™s IP address.</p></li>
<li><p>A Glean Adjacency (key={interface}). This is a representation of the need to discover
a peer on the given interface. It is used when it is known that the
packet is destined to an undiscoverd peer on that interface. The
difference between the glean adjacency and an
incomplete neighbour adjacency is that in the forwarding path the
glean adjacency will construct an ARP/ND request for the peer as
determined from the packetâ€™s destination address. The glean
adjacency is used to resolve connected prefixes on multi-access
interfaces.</p></li>
<li><p>A Multicast Adjacency (key={interface}). This represents the need to send an IP
multicast packet out of the adjacencyâ€™s associated interface. Since
IP multicast constructs the destination MAC address from the IP
packetâ€™s destination/group address, the rewrite is always known and
hence the adjacency is always complete.</p></li>
</ul>
<p>All adjacency types can be shared between routes, hence each type is
stored in a DB whose key is appropriate for the type.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="routes.html" class="btn btn-neutral float-right" title="Routes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="controlplane.html" class="btn btn-neutral float-left" title="The Control Plane" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2021, Linux Foundation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>