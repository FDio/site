<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RDMA (ibverb) device driver &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="VMWARE vmxnet3 device driver" href="vmxnet3.html" />
    <link rel="prev" title="Intel AVF device driver" href="avf.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../corefeatures/index.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Device drivers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="avf.html">Intel AVF device driver</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">RDMA (ibverb) device driver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#maturity-level">Maturity level</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supported-hardware">Supported Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#security-considerations">Security considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li class="toctree-l3"><a class="reference internal" href="#containers-support">Containers support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sr-iov-vfs-support">SR-IOV VFs support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#direct-verb-mode">Direct Verb mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="vmxnet3.html">VMWARE vmxnet3 device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="af_xdp.html">AF_XDP device driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Device drivers</a> &raquo;</li>
      <li>RDMA (ibverb) device driver</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/developer/devicedrivers/rdma.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rdma-ibverb-device-driver">
<h1>RDMA (ibverb) device driver<a class="headerlink" href="#rdma-ibverb-device-driver" title="Permalink to this headline"></a></h1>
<p>This driver relies on Linux rdma-core (libibverb) userspace poll-mode
driver to rx/tx Ethernet packets. Despite using the RDMA APIs, this is
<strong>not</strong> about RDMA (no Infiniband, no RoCE, no iWARP), just pure
traditional Ethernet packets.</p>
<section id="maturity-level">
<h2>Maturity level<a class="headerlink" href="#maturity-level" title="Permalink to this headline"></a></h2>
<p>Under development: it should work, but has not been thoroughly tested.</p>
</section>
<section id="supported-hardware">
<h2>Supported Hardware<a class="headerlink" href="#supported-hardware" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Mellanox ConnectX-4</p></li>
<li><p>Mellanox ConnectX-5</p></li>
</ul>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>bifurcation: MAC based flow steering for transparent sharing of a
single physical port between multiple virtual interfaces including
Linux netdev</p></li>
<li><p>multiqueue</p></li>
</ul>
</section>
<section id="security-considerations">
<h2>Security considerations<a class="headerlink" href="#security-considerations" title="Permalink to this headline"></a></h2>
<p>When creating a rdma interface, it will receive all packets to the MAC
address attributed to the interface plus a copy of all broadcast and
multicast traffic. The MAC address is under the control of VPP: <strong>the
user controlling VPP can divert all traffic of any MAC address to the
VPP process, including the Linux netdev MAC address as long as it can
create a rdma interface</strong>. The rights to create a rdma interface are
controlled by the access rights of the
<code class="docutils literal notranslate"><span class="pre">/dev/infiniband/uverbs[0-9]+</span></code>device nodes.</p>
</section>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline"></a></h2>
<ol class="arabic simple">
<li><p>Make sure the <code class="docutils literal notranslate"><span class="pre">ib_uverbs</span></code> module is loaded:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~</span><span class="c1"># modprobe ib_uverbs</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>In VPP, create a new rdma virtual interface tied to the Linux netdev
of the physical port you want to use (<code class="docutils literal notranslate"><span class="pre">enp94s0f0</span></code> in this example):</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vpp</span><span class="c1"># create int rdma host-if enp94s0f0 name rdma-0</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Use the interface as usual, e.g.:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vpp</span><span class="c1"># set int ip addr rdma-0 1.1.1.1/24</span>
<span class="n">vpp</span><span class="c1"># set int st rdma-0 up</span>
<span class="n">vpp</span><span class="c1"># ping 1.1.1.100`</span>
</pre></div>
</div>
</section>
<section id="containers-support">
<h2>Containers support<a class="headerlink" href="#containers-support" title="Permalink to this headline"></a></h2>
<p>It should work in containers as long as: - the <code class="docutils literal notranslate"><span class="pre">ib_uverbs</span></code> module is
loaded - the device nodes <code class="docutils literal notranslate"><span class="pre">/dev/infiniband/uverbs[0-9]+</span></code> are usable
from the container (but see <a class="reference external" href="#Security%20considerations">security
considerations</a>)</p>
</section>
<section id="sr-iov-vfs-support">
<h2>SR-IOV VFs support<a class="headerlink" href="#sr-iov-vfs-support" title="Permalink to this headline"></a></h2>
<p>It should work on SR-IOV VFs the same way it does with PFs. Because of
VFs security containment features, make sure the MAC address of the rdma
VPP interface matches the MAC address assigned to the underlying VF. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">host</span><span class="c1"># echo 1 &gt; /sys/class/infiniband/mlx5_0/device/sriov_numvfs</span>
<span class="n">host</span><span class="c1"># ip l set dev enp94s0f0 vf 0 mac 92:5d:f5:df:b1:6f spoof on trust off</span>
<span class="n">host</span><span class="c1"># ip l set dev enp94s0f2 up</span>
<span class="n">vpp</span><span class="c1"># create int rdma host-if enp94s0f2 name rdma-0</span>
<span class="n">vpp</span><span class="c1"># set int mac address rdma-0 92:5d:f5:df:b1:6f</span>
</pre></div>
</div>
<p>If you plan to use L2 features such as switching, make sure the
underlying VF is configured in trusted mode and spoof-checking is
disabled (of course, be aware of the <a class="reference external" href="#Security%20considerations">security
considerations</a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">host</span><span class="c1"># ip l set dev enp94s0f0 vf 0 spoof off trust on</span>
</pre></div>
</div>
</section>
<section id="direct-verb-mode">
<h2>Direct Verb mode<a class="headerlink" href="#direct-verb-mode" title="Permalink to this headline"></a></h2>
<p>Direct Verb allows the driver to access the NIC HW RX/TX rings directly
instead of having to go through libibverb and suffering associated
overhead. It will be automatically selected if the adapter supports it.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="avf.html" class="btn btn-neutral float-left" title="Intel AVF device driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="vmxnet3.html" class="btn btn-neutral float-right" title="VMWARE vmxnet3 device driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>