<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction to build-root/Makefile &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="VPP mem preload" href="../mem.html" />
    <link rel="prev" title="Introduction to cmake and ninja" href="cmakeandninja.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Core Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../softwarearchitecture.html">Software Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infrastructure.html">VPPINFRA (Infrastructure)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vlib.html">VLIB (Vector Processing Library)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vnet.html">VNET (VPP Network Stack)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../featurearcs.html">Feature Arcs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buffer_metadata.html">Buffer Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multiarch/index.html">Multi-architecture support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bihash.html">Bounded-index Extensible Hashing (bihash)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Build System</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mainmakefile.html">Introduction to the top-level Makefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="cmakeandninja.html">Introduction to cmake and ninja</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction to build-root/Makefile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#repository-groups-and-source-paths">Repository Groups and Source Paths</a></li>
<li class="toctree-l4"><a class="reference internal" href="#single-pass-build-system-dependencies-and-components">Single pass build system, dependencies and components</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-root">…/build-root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-root-build-config-mk">…/build-root/build-config.mk</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vpp-build-root-makefile">…/vpp/build-root/Makefile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-platform-variable">The PLATFORM variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-platform-specific-mk-fragment">The platform-specific .mk fragment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-tag-variable">The TAG variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#important-targets-build-root-makefile">Important targets build-root/Makefile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-build-root-makefile-environment-variable-settings">Additional build-root/Makefile environment variable settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-root-config-site">…/build-root/config.site</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-data-platforms-mk">…/build-data/platforms.mk</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-data-packages-mk">…/build-data/packages/*.mk</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mem.html">VPP mem preload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multi_thread.html">Multi-threading in VPP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../corefeatures/index.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Core Architecture</a> &raquo;</li>
          <li><a href="index.html">Build System</a> &raquo;</li>
      <li>Introduction to build-root/Makefile</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/developer/corearchitecture/buildsystem/buildrootmakefile.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction-to-build-root-makefile">
<h1>Introduction to build-root/Makefile<a class="headerlink" href="#introduction-to-build-root-makefile" title="Permalink to this headline"></a></h1>
<p>The vpp build system consists of a top-level Makefile, a data-driven
build-root/Makefile, and a set of makefile fragments. The various parts
come together as the result of a set of well-thought-out conventions.</p>
<p>This section describes build-root/Makefile in some detail.</p>
<section id="repository-groups-and-source-paths">
<h2>Repository Groups and Source Paths<a class="headerlink" href="#repository-groups-and-source-paths" title="Permalink to this headline"></a></h2>
<p>Current vpp workspaces comprise a single repository group. The file
…/build-root/build-config.mk defines a key variable called
SOURCE_PATH. The SOURCE_PATH variable names the set of repository
groups. At the moment, there is only one repository group.</p>
</section>
<section id="single-pass-build-system-dependencies-and-components">
<h2>Single pass build system, dependencies and components<a class="headerlink" href="#single-pass-build-system-dependencies-and-components" title="Permalink to this headline"></a></h2>
<p>The vpp build system caters to components built with GNU autoconf /
automake. Adding such components is a simple process. Dealing with
components which use BSD-style raw Makefiles is a more difficult.
Dealing with toolchain components such as gcc, glibc, and binutils can
be considerably more complicated.</p>
<p>The vpp build system is a <strong>single-pass</strong> build system. A partial order
must exist for any set of components: the set of (a before b) tuples
must resolve to an ordered list. If you create a circular dependency of
the form; (a,b) (b,c) (c,a), gmake will try to build the target list,
but there’s a 0.0% chance that the results will be pleasant. Cut-n-paste
mistakes in …/build-data/packages/.mk can produce confusing failures.</p>
<p>In a single-pass build system, it’s best to separate libraries and
applications which instantiate them. For example, if vpp depends on
libfoo.a, and myapp depends on both vpp and libfoo.a, it’s best to place
libfoo.a and myapp in separate components. The build system will build
libfoo.a, vpp, and then (as a separate component) myapp. If you try to
build libfoo.a and myapp from the same component, it won’t work.</p>
<p>If you absolutely, positively insist on having myapp and libfoo.a in the
same source tree, you can create a pseudo-component in a separate .mk
file in the …/build-data/packages/ directory. Define the code
phoneycomponent_source = realcomponent, and provide manual
configure/build/install targets.</p>
<p>Separate components for myapp, libfoo.a, and vpp is the best and easiest
solution. However, the “mumble_source = realsource” degree of freedom
exists to solve intractable circular dependencies, such as: to build
gcc-bootstrap, followed by glibc, followed by “real” gcc/g++ [which
depends on glibc too].</p>
</section>
<section id="build-root">
<h2>…/build-root<a class="headerlink" href="#build-root" title="Permalink to this headline"></a></h2>
<p>The …/build-root directory contains the repository group specification
build-config.mk, the main Makefile, and the system-wide set of
autoconf/automake variable overrides in config.site. We’ll describe
these files in some detail. To be clear about expectations: the main
Makefile and config.site file are subtle and complex. It’s unlikely that
you’ll need or want to modify them. Poorly planned changes in either
place typically cause bugs that are difficult to solve.</p>
</section>
<section id="build-root-build-config-mk">
<h2>…/build-root/build-config.mk<a class="headerlink" href="#build-root-build-config-mk" title="Permalink to this headline"></a></h2>
<p>As described above, the build-config.mk file is straightforward: it sets
the make variable SOURCE_PATH to a list of repository group absolute
paths.</p>
<p>The SOURCE_PATH variable If you choose to move a workspace, make sure
to modify the paths defined by the SOURCE_PATH variable. Those paths
need to match changes you make in the workspace paths. For example, if
you place the vpp directory in the workspace of a user named jsmith, you
might change the SOURCE_PATH to:</p>
<p>SOURCE_PATH = /home/jsmithuser/workspace/vpp</p>
<p>The “out of the box” setting should work 99.5% of the time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SOURCE_PATH = $(CURDIR)/..
</pre></div>
</div>
</section>
<section id="vpp-build-root-makefile">
<h2>…/vpp/build-root/Makefile<a class="headerlink" href="#vpp-build-root-makefile" title="Permalink to this headline"></a></h2>
<p>The main Makefile is complex in a number of dimensions. If you think you
need to modify it, it’s a good idea to do some research, or ask for
advice before you change it.</p>
<p>The main Makefile was organized and designed to provide the following
characteristics: excellent performance, accurate dependency processing,
cache enablement, timestamp optimizations, git integration,
extensibility, builds with cross-compilation tool chains, and builds
with embedded Linux distributions.</p>
<p>If you really need to do so, you can build double-cross tools with it,
with a minimum amount of fuss. For example, you could: compile gdb on
x86_64, to run on PowerPC, to debug the Xtensa instruction set.</p>
</section>
<section id="the-platform-variable">
<h2>The PLATFORM variable<a class="headerlink" href="#the-platform-variable" title="Permalink to this headline"></a></h2>
<p>The PLATFORM make/environment variable controls a number of important
characteristics, primarily:</p>
<ul class="simple">
<li><p>CPU architecture</p></li>
<li><p>The list of images to build.</p></li>
</ul>
<p>With respect to …/build-root/Makefile, the list of images to build is
specified by the target. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">PLATFORM</span><span class="o">=</span><span class="n">vpp</span> <span class="n">TAG</span><span class="o">=</span><span class="n">vpp_debug</span> <span class="n">install</span><span class="o">-</span><span class="n">deb</span>
</pre></div>
</div>
<p>builds vpp debug Debian packages.</p>
<p>The main Makefile interprets $PLATFORM by attempting to “-include” the
file /build-data/platforms.mk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$(foreach d,$(FULL_SOURCE_PATH), \
  $(eval -include $(d)/platforms.mk))
</pre></div>
</div>
<p>By convention, we don’t define <strong>platforms</strong> in the
…//build-data/platforms.mk file.</p>
<p>In the vpp case, we search for platform definition makefile fragments in
…/vpp/build-data/platforms.mk, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$(foreach d,$(SOURCE_PATH_BUILD_DATA_DIRS), \
     $(eval -include $(d)/platforms/*.mk))
</pre></div>
</div>
<p>With vpp, which uses the “vpp” platform as discussed above, we end up
“-include”-ing …/vpp/build-data/platforms/vpp.mk.</p>
</section>
<section id="the-platform-specific-mk-fragment">
<h2>The platform-specific .mk fragment<a class="headerlink" href="#the-platform-specific-mk-fragment" title="Permalink to this headline"></a></h2>
<p>Here are the contents of …/build-data/platforms/vpp.mk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MACHINE=$(shell uname -m)

vpp_arch = native
ifeq ($(TARGET_PLATFORM),thunderx)
vpp_dpdk_target = arm64-thunderx-linuxapp-gcc
endif
vpp_native_tools = vppapigen

vpp_uses_dpdk = yes

# Uncomment to enable building unit tests
# vpp_enable_tests = yes

vpp_root_packages = vpp

# DPDK configuration parameters
# vpp_uses_dpdk_mlx4_pmd = yes
# vpp_uses_dpdk_mlx5_pmd = yes
# vpp_uses_external_dpdk = yes
# vpp_dpdk_inc_dir = /usr/include/dpdk
# vpp_dpdk_lib_dir = /usr/lib
# vpp_dpdk_shared_lib = yes

# Use &#39;--without-libnuma&#39; for non-numa aware architecture
# Use &#39;--enable-dlmalloc&#39; to use dlmalloc instead of mheap
vpp_configure_args_vpp = --enable-dlmalloc
sample-plugin_configure_args_vpp = --enable-dlmalloc

# load balancer plugin is not portable on 32 bit platform
ifeq ($(MACHINE),i686)
vpp_configure_args_vpp += --disable-lb-plugin
endif

vpp_debug_TAG_CFLAGS = -g -O0 -DCLIB_DEBUG \
    -fstack-protector-all -fPIC -Werror
vpp_debug_TAG_CXXFLAGS = -g -O0 -DCLIB_DEBUG \
    -fstack-protector-all -fPIC -Werror
vpp_debug_TAG_LDFLAGS = -g -O0 -DCLIB_DEBUG \
    -fstack-protector-all -fPIC -Werror

vpp_TAG_CFLAGS = -g -O2 -D_FORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror
vpp_TAG_CXXFLAGS = -g -O2 -D_FORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror
vpp_TAG_LDFLAGS = -g -O2 -D_FORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror -pie -Wl,-z,now

vpp_clang_TAG_CFLAGS = -g -O2 -D_FORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror
vpp_clang_TAG_LDFLAGS = -g -O2 -D_FORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror

vpp_gcov_TAG_CFLAGS = -g -O0 -DCLIB_DEBUG -fPIC -Werror -fprofile-arcs -ftest-coverage
vpp_gcov_TAG_LDFLAGS = -g -O0 -DCLIB_DEBUG -fPIC -Werror -coverage

vpp_coverity_TAG_CFLAGS = -g -O2 -fPIC -Werror -D__COVERITY__
vpp_coverity_TAG_LDFLAGS = -g -O2 -fPIC -Werror -D__COVERITY__
</pre></div>
</div>
<p>Note the following variable settings:</p>
<ul class="simple">
<li><p>The variable _arch sets the CPU architecture used to build the
per-platform cross-compilation toolchain. With the exception of the
“native” architecture - used in our example - the vpp build system
produces cross-compiled binaries.</p></li>
<li><p>The variable _native_tools lists the required set of self-compiled
build tools.</p></li>
<li><p>The variable _root_packages lists the set of images to build when
specifying the target: make PLATFORM= TAG= [install-deb |
install-rpm].</p></li>
</ul>
</section>
<section id="the-tag-variable">
<h2>The TAG variable<a class="headerlink" href="#the-tag-variable" title="Permalink to this headline"></a></h2>
<p>The TAG variable indirectly sets CFLAGS and LDFLAGS, as well as the
build and install directory names in the …/vpp/build-root directory.
See definitions above.</p>
</section>
<section id="important-targets-build-root-makefile">
<h2>Important targets build-root/Makefile<a class="headerlink" href="#important-targets-build-root-makefile" title="Permalink to this headline"></a></h2>
<p>The main Makefile and the various makefile fragments implement the
following user-visible targets:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 17%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Target</p></th>
<th class="head"><p>ENV Variable Settings</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>foo</p></td>
<td><p>bar</p></td>
<td><p>mumble</p></td>
</tr>
<tr class="row-odd"><td><p>bootstrap-tools</p></td>
<td><p>none</p></td>
<td><p>Builds the set of native tools needed by the vpp build system to
build images. Example: vppapigen. In a full cross compilation case might include
include “make”, “git”, “find”, and “tar</p></td>
</tr>
<tr class="row-even"><td><p>install-tools</p></td>
<td><p>PLATFORM</p></td>
<td><p>Builds the tool chain for the indicated &lt;platform&gt;. Not used in vpp builds</p></td>
</tr>
<tr class="row-odd"><td><p>distclean</p></td>
<td><p>none</p></td>
<td><p>Roto-rooters everything in sight: toolchains, images, and so forth.</p></td>
</tr>
<tr class="row-even"><td><p>install-deb</p></td>
<td><p>PLATFORM and TAG</p></td>
<td><p>Build Debian packages comprising components listed in &lt;platform&gt;_root_packages,
using compile / link options defined by TAG.</p></td>
</tr>
<tr class="row-odd"><td><p>install-rpm</p></td>
<td><p>PLATFORM and TAG</p></td>
<td><p>Build RPMs comprising components listed in &lt;platform&gt;_root_packages,
using compile / link options defined by TAG.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="additional-build-root-makefile-environment-variable-settings">
<h2>Additional build-root/Makefile environment variable settings<a class="headerlink" href="#additional-build-root-makefile-environment-variable-settings" title="Permalink to this headline"></a></h2>
<p>These variable settings may be of use:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ENV Variable</p></th>
<th class="head" colspan="2"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BUILD_DEBUG=vx</p></td>
<td colspan="2"><p>Directs Makefile et al. to make a good-faith effort to show what’s going on in excruciating detail.
Use it as follows: “make … BUILD_DEBUG=vx”. Fairly effective in Makefile debug situations.</p></td>
</tr>
<tr class="row-odd"><td><p>V=1</p></td>
<td colspan="2"><p>print detailed cc / ld command lines. Useful for discovering if -DFOO=11 is in the command line or not</p></td>
</tr>
<tr class="row-even"><td><p>CC=mygcc</p></td>
<td colspan="2"><p>Override the configured C-compiler</p></td>
</tr>
</tbody>
</table>
</section>
<section id="build-root-config-site">
<h2>…/build-root/config.site<a class="headerlink" href="#build-root-config-site" title="Permalink to this headline"></a></h2>
<p>The contents of …/build-root/config.site override individual autoconf /
automake default variable settings. Here are a few sample settings related to
building a full toolchain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># glibc needs these setting for cross compiling</span>
<span class="n">libc_cv_forced_unwind</span><span class="o">=</span><span class="n">yes</span>
<span class="n">libc_cv_c_cleanup</span><span class="o">=</span><span class="n">yes</span>
<span class="n">libc_cv_ssp</span><span class="o">=</span><span class="n">no</span>
</pre></div>
</div>
<p>Determining the set of variables which need to be overridden, and the
override values is a matter of trial and error. It should be
unnecessary to modify this file for use with fd.io vpp.</p>
</section>
<section id="build-data-platforms-mk">
<h2>…/build-data/platforms.mk<a class="headerlink" href="#build-data-platforms-mk" title="Permalink to this headline"></a></h2>
<p>Each repo group includes the platforms.mk file, which is included by
the main Makefile. The vpp/build-data/platforms.mk file is not terribly
complex. As of this writing, …/build-data/platforms.mk file accomplishes two
tasks.</p>
<p>First, it includes vpp/build-data/platforms/*.mk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Pick up per-platform makefile fragments
$(foreach d,$(SOURCE_PATH_BUILD_DATA_DIRS), \
  $(eval -include $(d)/platforms/*.mk))
</pre></div>
</div>
<p>This collects the set of platform definition makefile fragments, as discussed above.</p>
<p>Second, platforms.mk implements the user-visible “install-deb” target.</p>
</section>
<section id="build-data-packages-mk">
<h2>…/build-data/packages/*.mk<a class="headerlink" href="#build-data-packages-mk" title="Permalink to this headline"></a></h2>
<p>Each component needs a makefile fragment in order for the build system
to recognize it. The per-component makefile fragments vary
considerably in complexity. For a component built with GNU autoconf /
automake which does not depend on other components, the make fragment
can be empty. See …/build-data/packages/vpp.mk for an uncomplicated
but fully realistic example.</p>
<p>Here are some of the important variable settings in per-component makefile fragments:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head" colspan="2"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xxx_configure_depend</p></td>
<td colspan="2"><p>Lists the set of component build dependencies for the xxx component. In plain English: don’t try to
configure this component until you’ve successfully built the indicated targets. Almost always,
xxx_configure_depend will list a set of “yyy-install” targets. Note the pattern:
“variable names contain underscores, make target names contain hyphens”</p></td>
</tr>
<tr class="row-odd"><td><p>xxx_configure_args</p></td>
<td colspan="2"><p>(optional) Lists any additional arguments to pass to the xxx component “configure” script.
The main Makefile %-configure rule adds the required settings for –libdir, –prefix, and
–host (when cross-compiling)</p></td>
</tr>
<tr class="row-even"><td><p>xxx_CPPFLAGS</p></td>
<td colspan="2"><p>Adds -I stanzas to CPPFLAGS for components upon which xxx depends.
Almost invariably “xxx_CPPFLAGS = $(call installed_includes_fn, dep1 dep2 dep3)”, where dep1, dep2, and
dep3 are listed in xxx_configure_depend. It is bad practice to set “-g -O3” here. Those settings
belong in a TAG.</p></td>
</tr>
<tr class="row-odd"><td><p>xxx_LDFLAGS</p></td>
<td colspan="2"><p>Adds -Wl,-rpath -Wl,depN stanzas to LDFLAGS for components upon which xxx depends.
Almost invariably “xxx_LDFLAGS = $(call installed_lib_fn, dep1 dep2 dep3)”, where dep1, dep2, and
dep3 are listed in xxx_configure_depend. It is bad manners to set “-liberty-or-death” here.
Those settings belong in Makefile.am.</p></td>
</tr>
</tbody>
</table>
<p>When dealing with “irritating” components built with raw Makefiles
which only work when building in the source tree, we use a specific
strategy in the xxx.mk file.</p>
<p>The strategy is simple for those components: We copy the source tree
into …/vpp/build-root/build-xxx. This works, but completely defeats
dependency processing. This strategy is acceptable only for 3rd party
software which won’t need extensive (or preferably any) modifications.</p>
<p>Take a look at …/vpp/build-data/packages/dpdk.mk. When invoked, the
dpdk_configure variable copies source code into $(PACKAGE_BUILD_DIR),
and performs the BSD equivalent of “autoreconf -i -f” to configure the
build area. The rest of the file is similar: a bunch of hand-rolled
glue code which manages to make the dpdk act like a good vpp build
citizen even though it is not.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cmakeandninja.html" class="btn btn-neutral float-left" title="Introduction to cmake and ninja" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../mem.html" class="btn btn-neutral float-right" title="VPP mem preload" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>