

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction to build-root/Makefile &mdash; Vector Packet Processor 01 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/rules.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Event-logger" href="../eventviewer.html" />
    <link rel="prev" title="Introduction to cmake and ninja" href="cmakeandninja.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Vector Packet Processor
          

          
            
            <img src="../../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../overview/index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">For Users</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">For Developers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../building.html">Building VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../running_vpp.html">Running VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gdb_examples.html">GDB Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add_plugin.html">Adding a plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../softwarearchitecture.html">Software Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infrastructure.html">VPPINFRA (Infrastructure)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html">VLIB (Vector Processing Library)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vnet.html">VNET (VPP Network Stack)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../featurearcs.html">Feature Arcs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../metadata.html">Buffer Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../metadata.html#buffer-metadata-extensions">Buffer Metadata Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multiarch/index.html">Multi-architecture support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bihash.html">Bounded-index Extensible Hashing (bihash)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vpp_api_module.html">VPP API module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../binary_api_support.html">Binary API Support</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Build System</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="mainmakefile.html">Introduction to the top-level Makefile</a></li>
<li class="toctree-l4"><a class="reference internal" href="cmakeandninja.html">Introduction to cmake and ninja</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Introduction to build-root/Makefile</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../eventviewer.html">Event-logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eventviewer.html#g2-graphical-event-viewer">G2 graphical event viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fib20/index.html">FIB 2.0 Hierarchical, Protocol, Independent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../buildwireshark.html">How to build a vpp dispatch trace aware Wireshark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../punt.html">Punting Packets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quic_plugin.html">QUIC HostStack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cross_compile_macos.html">Cross compilation on MacOS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../writingdocs/index.html">Writing Documents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../links/index.html">VPP Wiki, Doxygen and Other Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../featuresbyrelease/index.html">Features by Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../events/index.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../relatedprojects/index.html">Related Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../archive/index.html">Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vector Packet Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Getting Started</a> &raquo;</li>
        
          <li><a href="../index.html">For Developers</a> &raquo;</li>
        
          <li><a href="index.html">Build System</a> &raquo;</li>
        
      <li>Introduction to build-root/Makefile</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/gettingstarted/developers/buildsystem/buildrootmakefile.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction-to-build-root-makefile">
<h1>Introduction to build-root/Makefile<a class="headerlink" href="#introduction-to-build-root-makefile" title="Permalink to this headline">¶</a></h1>
<p>The vpp build system consists of a top-level Makefile, a data-driven
build-root/Makefile, and a set of makefile fragments. The various parts
come together as the result of a set of well-thought-out conventions.</p>
<p>This section describes build-root/Makefile in some detail.</p>
<div class="section" id="repository-groups-and-source-paths">
<h2>Repository Groups and Source Paths<a class="headerlink" href="#repository-groups-and-source-paths" title="Permalink to this headline">¶</a></h2>
<p>Current vpp workspaces comprise a single repository group. The file
…/build-root/build-config.mk defines a key variable called
SOURCE_PATH. The SOURCE_PATH variable names the set of repository
groups. At the moment, there is only one repository group.</p>
</div>
<div class="section" id="single-pass-build-system-dependencies-and-components">
<h2>Single pass build system, dependencies and components<a class="headerlink" href="#single-pass-build-system-dependencies-and-components" title="Permalink to this headline">¶</a></h2>
<p>The vpp build system caters to components built with GNU autoconf /
automake. Adding such components is a simple process. Dealing with
components which use BSD-style raw Makefiles is a more difficult.
Dealing with toolchain components such as gcc, glibc, and binutils can
be considerably more complicated.</p>
<p>The vpp build system is a <strong>single-pass</strong> build system. A partial order
must exist for any set of components: the set of (a before b) tuples
must resolve to an ordered list. If you create a circular dependency of
the form; (a,b) (b,c) (c,a), gmake will try to build the target list,
but there’s a 0.0% chance that the results will be pleasant. Cut-n-paste
mistakes in …/build-data/packages/.mk can produce confusing failures.</p>
<p>In a single-pass build system, it’s best to separate libraries and
applications which instantiate them. For example, if vpp depends on
libfoo.a, and myapp depends on both vpp and libfoo.a, it’s best to place
libfoo.a and myapp in separate components. The build system will build
libfoo.a, vpp, and then (as a separate component) myapp. If you try to
build libfoo.a and myapp from the same component, it won’t work.</p>
<p>If you absolutely, positively insist on having myapp and libfoo.a in the
same source tree, you can create a pseudo-component in a separate .mk
file in the …/build-data/packages/ directory. Define the code
phoneycomponent_source = realcomponent, and provide manual
configure/build/install targets.</p>
<p>Separate components for myapp, libfoo.a, and vpp is the best and easiest
solution. However, the “mumble_source = realsource” degree of freedom
exists to solve intractable circular dependencies, such as: to build
gcc-bootstrap, followed by glibc, followed by “real” gcc/g++ [which
depends on glibc too].</p>
</div>
<div class="section" id="build-root">
<h2>…/build-root<a class="headerlink" href="#build-root" title="Permalink to this headline">¶</a></h2>
<p>The …/build-root directory contains the repository group specification
build-config.mk, the main Makefile, and the system-wide set of
autoconf/automake variable overrides in config.site. We’ll describe
these files in some detail. To be clear about expectations: the main
Makefile and config.site file are subtle and complex. It’s unlikely that
you’ll need or want to modify them. Poorly planned changes in either
place typically cause bugs that are difficult to solve.</p>
</div>
<div class="section" id="build-root-build-config-mk">
<h2>…/build-root/build-config.mk<a class="headerlink" href="#build-root-build-config-mk" title="Permalink to this headline">¶</a></h2>
<p>As described above, the build-config.mk file is straightforward: it sets
the make variable SOURCE_PATH to a list of repository group absolute
paths.</p>
<p>The SOURCE_PATH variable If you choose to move a workspace, make sure
to modify the paths defined by the SOURCE_PATH variable. Those paths
need to match changes you make in the workspace paths. For example, if
you place the vpp directory in the workspace of a user named jsmith, you
might change the SOURCE_PATH to:</p>
<p>SOURCE_PATH = /home/jsmithuser/workspace/vpp</p>
<p>The “out of the box” setting should work 99.5% of the time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SOURCE_PATH = $(CURDIR)/..
</pre></div>
</div>
</div>
<div class="section" id="vpp-build-root-makefile">
<h2>…/vpp/build-root/Makefile<a class="headerlink" href="#vpp-build-root-makefile" title="Permalink to this headline">¶</a></h2>
<p>The main Makefile is complex in a number of dimensions. If you think you
need to modify it, it’s a good idea to do some research, or ask for
advice before you change it.</p>
<p>The main Makefile was organized and designed to provide the following
characteristics: excellent performance, accurate dependency processing,
cache enablement, timestamp optimizations, git integration,
extensibility, builds with cross-compilation tool chains, and builds
with embedded Linux distributions.</p>
<p>If you really need to do so, you can build double-cross tools with it,
with a minimum amount of fuss. For example, you could: compile gdb on
x86_64, to run on PowerPC, to debug the Xtensa instruction set.</p>
</div>
<div class="section" id="the-platform-variable">
<h2>The PLATFORM variable<a class="headerlink" href="#the-platform-variable" title="Permalink to this headline">¶</a></h2>
<p>The PLATFORM make/environment variable controls a number of important
characteristics, primarily:</p>
<ul class="simple">
<li><p>CPU architecture</p></li>
<li><p>The list of images to build.</p></li>
</ul>
<p>With respect to …/build-root/Makefile, the list of images to build is
specified by the target. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">PLATFORM</span><span class="o">=</span><span class="n">vpp</span> <span class="n">TAG</span><span class="o">=</span><span class="n">vpp_debug</span> <span class="n">install</span><span class="o">-</span><span class="n">deb</span>
</pre></div>
</div>
<p>builds vpp debug Debian packages.</p>
<p>The main Makefile interprets $PLATFORM by attempting to “-include” the
file /build-data/platforms.mk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$(foreach d,$(FULL_SOURCE_PATH), \
  $(eval -include $(d)/platforms.mk))
</pre></div>
</div>
<p>By convention, we don’t define <strong>platforms</strong> in the
…//build-data/platforms.mk file.</p>
<p>In the vpp case, we search for platform definition makefile fragments in
…/vpp/build-data/platforms.mk, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$(foreach d,$(SOURCE_PATH_BUILD_DATA_DIRS), \
     $(eval -include $(d)/platforms/*.mk))
</pre></div>
</div>
<p>With vpp, which uses the “vpp” platform as discussed above, we end up
“-include”-ing …/vpp/build-data/platforms/vpp.mk.</p>
</div>
<div class="section" id="the-platform-specific-mk-fragment">
<h2>The platform-specific .mk fragment<a class="headerlink" href="#the-platform-specific-mk-fragment" title="Permalink to this headline">¶</a></h2>
<p>Here are the contents of …/build-data/platforms/vpp.mk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MACHINE=$(shell uname -m)

vpp_arch = native
ifeq ($(TARGET_PLATFORM),thunderx)
vpp_dpdk_target = arm64-thunderx-linuxapp-gcc
endif
vpp_native_tools = vppapigen

vpp_uses_dpdk = yes

# Uncoment to enable building unit tests
# vpp_enable_tests = yes

vpp_root_packages = vpp vom

# DPDK configuration parameters
# vpp_uses_dpdk_mlx4_pmd = yes
# vpp_uses_dpdk_mlx5_pmd = yes
# vpp_uses_external_dpdk = yes
# vpp_dpdk_inc_dir = /usr/include/dpdk
# vpp_dpdk_lib_dir = /usr/lib
# vpp_dpdk_shared_lib = yes

# Use &#39;--without-libnuma&#39; for non-numa aware architecture
# Use &#39;--enable-dlmalloc&#39; to use dlmalloc instead of mheap
vpp_configure_args_vpp = --enable-dlmalloc
sample-plugin_configure_args_vpp = --enable-dlmalloc

# load balancer plugin is not portable on 32 bit platform
ifeq ($(MACHINE),i686)
vpp_configure_args_vpp += --disable-lb-plugin
endif

vpp_debug_TAG_CFLAGS = -g -O0 -DCLIB_DEBUG -DFORTIFY_SOURCE=2 \
    -fstack-protector-all -fPIC -Werror
vpp_debug_TAG_CXXFLAGS = -g -O0 -DCLIB_DEBUG -DFORTIFY_SOURCE=2 \
    -fstack-protector-all -fPIC -Werror
vpp_debug_TAG_LDFLAGS = -g -O0 -DCLIB_DEBUG -DFORTIFY_SOURCE=2 \
    -fstack-protector-all -fPIC -Werror

vpp_TAG_CFLAGS = -g -O2 -DFORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror
vpp_TAG_CXXFLAGS = -g -O2 -DFORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror
vpp_TAG_LDFLAGS = -g -O2 -DFORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror -pie -Wl,-z,now

vpp_clang_TAG_CFLAGS = -g -O2 -DFORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror
vpp_clang_TAG_LDFLAGS = -g -O2 -DFORTIFY_SOURCE=2 -fstack-protector -fPIC -Werror

vpp_gcov_TAG_CFLAGS = -g -O0 -DCLIB_DEBUG -fPIC -Werror -fprofile-arcs -ftest-coverage
vpp_gcov_TAG_LDFLAGS = -g -O0 -DCLIB_DEBUG -fPIC -Werror -coverage

vpp_coverity_TAG_CFLAGS = -g -O2 -fPIC -Werror -D__COVERITY__
vpp_coverity_TAG_LDFLAGS = -g -O2 -fPIC -Werror -D__COVERITY__
</pre></div>
</div>
<p>Note the following variable settings:</p>
<ul class="simple">
<li><p>The variable _arch sets the CPU architecture used to build the
per-platform cross-compilation toolchain. With the exception of the
“native” architecture - used in our example - the vpp build system
produces cross-compiled binaries.</p></li>
<li><p>The variable _native_tools lists the required set of self-compiled
build tools.</p></li>
<li><p>The variable _root_packages lists the set of images to build when
specifying the target: make PLATFORM= TAG= [install-deb |
install-rpm].</p></li>
</ul>
</div>
<div class="section" id="the-tag-variable">
<h2>The TAG variable<a class="headerlink" href="#the-tag-variable" title="Permalink to this headline">¶</a></h2>
<p>The TAG variable indirectly sets CFLAGS and LDFLAGS, as well as the
build and install directory names in the …/vpp/build-root directory.
See definitions above.</p>
</div>
<div class="section" id="important-targets-build-root-makefile">
<h2>Important targets build-root/Makefile<a class="headerlink" href="#important-targets-build-root-makefile" title="Permalink to this headline">¶</a></h2>
<p>The main Makefile and the various makefile fragments implement the
following user-visible targets:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 14%" />
<col style="width: 17%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Target</p></th>
<th class="head"><p>ENV Variable Settings</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>foo</p></td>
<td><p>bar</p></td>
<td><p>mumble</p></td>
</tr>
<tr class="row-odd"><td><p>bootstrap-tools</p></td>
<td><p>none</p></td>
<td><p>Builds the set of native tools needed by the vpp build system to
build images. Example: vppapigen. In a full cross compilation case might include
include “make”, “git”, “find”, and “tar</p></td>
</tr>
<tr class="row-even"><td><p>install-tools</p></td>
<td><p>PLATFORM</p></td>
<td><p>Builds the tool chain for the indicated &lt;platform&gt;. Not used in vpp builds</p></td>
</tr>
<tr class="row-odd"><td><p>distclean</p></td>
<td><p>none</p></td>
<td><p>Roto-rooters everything in sight: toolchains, images, and so forth.</p></td>
</tr>
<tr class="row-even"><td><p>install-deb</p></td>
<td><p>PLATFORM and TAG</p></td>
<td><p>Build Debian packages comprising components listed in &lt;platform&gt;_root_packages,
using compile / link options defined by TAG.</p></td>
</tr>
<tr class="row-odd"><td><p>install-rpm</p></td>
<td><p>PLATFORM and TAG</p></td>
<td><p>Build RPMs comprising components listed in &lt;platform&gt;_root_packages,
using compile / link options defined by TAG.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="additional-build-root-makefile-environment-variable-settings">
<h2>Additional build-root/Makefile environment variable settings<a class="headerlink" href="#additional-build-root-makefile-environment-variable-settings" title="Permalink to this headline">¶</a></h2>
<p>These variable settings may be of use:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ENV Variable</p></th>
<th class="head" colspan="2"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BUILD_DEBUG=vx</p></td>
<td colspan="2"><p>Directs Makefile et al. to make a good-faith effort to show what’s going on in excruciating detail.
Use it as follows: “make … BUILD_DEBUG=vx”. Fairly effective in Makefile debug situations.</p></td>
</tr>
<tr class="row-odd"><td><p>V=1</p></td>
<td colspan="2"><p>print detailed cc / ld command lines. Useful for discovering if -DFOO=11 is in the command line or not</p></td>
</tr>
<tr class="row-even"><td><p>CC=mygcc</p></td>
<td colspan="2"><p>Override the configured C-compiler</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-root-config-site">
<h2>…/build-root/config.site<a class="headerlink" href="#build-root-config-site" title="Permalink to this headline">¶</a></h2>
<p>The contents of …/build-root/config.site override individual autoconf /
automake default variable settings. Here are a few sample settings related to
building a full toolchain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># glibc needs these setting for cross compiling</span>
<span class="n">libc_cv_forced_unwind</span><span class="o">=</span><span class="n">yes</span>
<span class="n">libc_cv_c_cleanup</span><span class="o">=</span><span class="n">yes</span>
<span class="n">libc_cv_ssp</span><span class="o">=</span><span class="n">no</span>
</pre></div>
</div>
<p>Determining the set of variables which need to be overridden, and the
override values is a matter of trial and error. It should be
unnecessary to modify this file for use with fd.io vpp.</p>
</div>
<div class="section" id="build-data-platforms-mk">
<h2>…/build-data/platforms.mk<a class="headerlink" href="#build-data-platforms-mk" title="Permalink to this headline">¶</a></h2>
<p>Each repo group includes the platforms.mk file, which is included by
the main Makefile. The vpp/build-data/platforms.mk file is not terribly
complex. As of this writing, …/build-data/platforms.mk file accomplishes two
tasks.</p>
<p>First, it includes vpp/build-data/platforms/*.mk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Pick up per-platform makefile fragments
$(foreach d,$(SOURCE_PATH_BUILD_DATA_DIRS), \
  $(eval -include $(d)/platforms/*.mk))
</pre></div>
</div>
<p>This collects the set of platform definition makefile fragments, as discussed above.</p>
<p>Second, platforms.mk implements the user-visible “install-deb” target.</p>
</div>
<div class="section" id="build-data-packages-mk">
<h2>…/build-data/packages/*.mk<a class="headerlink" href="#build-data-packages-mk" title="Permalink to this headline">¶</a></h2>
<p>Each component needs a makefile fragment in order for the build system
to recognize it. The per-component makefile fragments vary
considerably in complexity. For a component built with GNU autoconf /
automake which does not depend on other components, the make fragment
can be empty. See …/build-data/packages/vpp.mk for an uncomplicated
but fully realistic example.</p>
<p>Here are some of the important variable settings in per-component makefile fragments:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head" colspan="2"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xxx_configure_depend</p></td>
<td colspan="2"><p>Lists the set of component build dependencies for the xxx component. In plain English: don’t try to
configure this component until you’ve successfully built the indicated targets. Almost always,
xxx_configure_depend will list a set of “yyy-install” targets. Note the pattern:
“variable names contain underscores, make target names contain hyphens”</p></td>
</tr>
<tr class="row-odd"><td><p>xxx_configure_args</p></td>
<td colspan="2"><p>(optional) Lists any additional arguments to pass to the xxx component “configure” script.
The main Makefile %-configure rule adds the required settings for –libdir, –prefix, and
–host (when cross-compiling)</p></td>
</tr>
<tr class="row-even"><td><p>xxx_CPPFLAGS</p></td>
<td colspan="2"><p>Adds -I stanzas to CPPFLAGS for components upon which xxx depends.
Almost invariably “xxx_CPPFLAGS = $(call installed_includes_fn, dep1 dep2 dep3)”, where dep1, dep2, and
dep3 are listed in xxx_configure_depend. It is bad practice to set “-g -O3” here. Those settings
belong in a TAG.</p></td>
</tr>
<tr class="row-odd"><td><p>xxx_LDFLAGS</p></td>
<td colspan="2"><p>Adds -Wl,-rpath -Wl,depN stanzas to LDFLAGS for components upon which xxx depends.
Almost invariably “xxx_LDFLAGS = $(call installed_lib_fn, dep1 dep2 dep3)”, where dep1, dep2, and
dep3 are listed in xxx_configure_depend. It is bad manners to set “-liberty-or-death” here.
Those settings belong in Makefile.am.</p></td>
</tr>
</tbody>
</table>
<p>When dealing with “irritating” components built with raw Makefiles
which only work when building in the source tree, we use a specific
strategy in the xxx.mk file.</p>
<p>The strategy is simple for those components: We copy the source tree
into …/vpp/build-root/build-xxx. This works, but completely defeats
dependency processing. This strategy is acceptable only for 3rd party
software which won’t need extensive (or preferably any) modifications.</p>
<p>Take a look at …/vpp/build-data/packages/dpdk.mk. When invoked, the
dpdk_configure variable copies source code into $(PACKAGE_BUILD_DIR),
and performs the BSD equivalent of “autoreconf -i -f” to configure the
build area. The rest of the file is similar: a bunch of hand-rolled
glue code which manages to make the dpdk act like a good vpp build
citizen even though it is not.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../eventviewer.html" class="btn btn-neutral float-right" title="Event-logger" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cmakeandninja.html" class="btn btn-neutral float-left" title="Introduction to cmake and ninja" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Linux Foundation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>