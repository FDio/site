

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Contiv/VPP Kubernetes Network Plugin &mdash; The Vector Packet Processor 20.01 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/rules.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Security" href="SECURITY.html" />
    <link rel="prev" title="Contiv/VPP" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Vector Packet Processor
          

          
            
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../whatisvpp/index.html">The Vector Packet Processor (VPP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links/index.html">VPP Wiki, Doxygen and Other Links</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Use Cases</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../containers.html">VPP with Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vhost/index.html">FD.io VPP with Virtual Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acls.html">Access Control Lists (ACLs) with FD.io VPP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vppcloud.html">VPP inside the Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homegateway.html">Using VPP as a Home Gateway</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Contiv/VPP</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Contiv/VPP Kubernetes Network Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#architecture">Architecture</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="SECURITY.html">Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="Vagrant.html">Contiv-VPP Vagrant Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="MANUAL_INSTALL.html">Manual Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPP_CONFIG.html">Creating VPP Startup Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="VMWARE_FUSION_HOST.html">Preparing a VmWare Fusion Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="NETWORKING.html">Contiv/VPP Network Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="SINGLE_NIC_SETUP.html">Setting up a Node with a Single NIC</a></li>
<li class="toctree-l3"><a class="reference internal" href="MULTI_NIC_SETUP.html">Setting Up a Node with Multiple NICs</a></li>
<li class="toctree-l3"><a class="reference internal" href="CUSTOM_MGMT_NETWORK.html">Setting Up a Custom Management Network on Multi-Homed Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="Prometheus.html">Prometheus Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPP_PACKET_TRACING_K8S.html">How to do VPP Packet Tracing in Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="VPPTRACE.html">Using vpptrace.sh for VPP Packet Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="CORE_FILES.html">Capturing VPP core dumps</a></li>
<li class="toctree-l3"><a class="reference internal" href="BUG_REPORTS.html">Debugging and Reporting Bugs in Contiv-VPP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../networksim.html">Network Simulator Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../webapp.html">Building VPP web applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../container_test.html">Container-based network simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../featuresbyrelease/index.html">Features by Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../events/index.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relatedprojects/index.html">Related Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/index.html">Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Vector Packet Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Use Cases</a> &raquo;</li>
        
          <li><a href="index.html">Contiv/VPP</a> &raquo;</li>
        
      <li>Contiv/VPP Kubernetes Network Plugin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/usecases/contiv/K8s_Overview.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="contiv-vpp-kubernetes-network-plugin">
<h1>Contiv/VPP Kubernetes Network Plugin<a class="headerlink" href="#contiv-vpp-kubernetes-network-plugin" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Kubernetes is a container orchestration system that efficiently manages Docker containers. The Docker containers and container platforms provide many advantages over traditional virtualization. Container isolation is done on the kernel level, which eliminates the need for a guest virtual operating system, and therefore makes containers much more efficient, faster, and lightweight. The containers in Contiv/VPP are referred to as PODs.</p>
<p>Contiv/VPP is a Kubernetes network plugin that uses <a class="reference external" href="https://fd.io/">FD.io VPP</a>
to provide network connectivity between PODs in a k8s cluster (k8s is an abbreviated reference for kubernetes).
It deploys itself as a set of system PODs in the <code class="docutils literal notranslate"><span class="pre">kube-system</span></code> namespace,
some of them (<code class="docutils literal notranslate"><span class="pre">contiv-ksr</span></code>, <code class="docutils literal notranslate"><span class="pre">contiv-etcd</span></code>) on the master node, and some
of them (<code class="docutils literal notranslate"><span class="pre">contiv-cni</span></code>, <code class="docutils literal notranslate"><span class="pre">contiv-vswitch</span></code>, <code class="docutils literal notranslate"><span class="pre">contiv-stn</span></code>) on each node in the cluster.</p>
<p>Contiv/VPP is fully integrated with k8s via its components,
and it automatically reprograms itself upon each change in the cluster
via k8s API.</p>
<p>The main component of the <a class="reference external" href="https://fd.io/technology/#vpp">VPP</a> solution, which
runs within the <code class="docutils literal notranslate"><span class="pre">contiv-vswitch</span></code> POD on each node in the cluster. The VPP solution also provides
POD-to-POD connectivity across the nodes in the cluster, as well as host-to-POD
and outside-to-POD connectivity. This solution also leverages
VPP’s fast data processing that runs completely in userspace, and uses
<a class="reference external" href="https://dpdk.org/">DPDK</a> for fast access to the network IO layer.</p>
<p>Kubernetes services and policies are also a part of the VPP configuration,
which means they are fully supported on VPP, without the need of forwarding
packets into the Linux network stack (Kube Proxy), which makes them very
effective and scalable.</p>
</div>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>Contiv/VPP consists of several components, each of them packed and shipped as
a Docker container. Two of them deploy on Kubernetes master node only:</p>
<ul class="simple">
<li><p><a class="reference external" href="#contiv-ksr">Contiv KSR</a></p></li>
<li><p><a class="reference external" href="#contiv-etcd">Contiv ETCD</a></p></li>
</ul>
<p>The rest of them deploy on all nodes within the k8s cluster (including the master node):</p>
<ul class="simple">
<li><p><a class="reference external" href="#contiv-vswitch">Contiv vSwitch</a></p></li>
<li><p><a class="reference external" href="#contiv-cni">Contiv CNI</a></p></li>
<li><p><a class="reference external" href="#contiv-stn-daemon">Contiv STN</a></p></li>
</ul>
<p>The following section briefly describes the individual Contiv components, which are displayed
as orange boxes on the picture below:</p>
<p><img alt="Contiv/VPP Architecture" src="../../_images/contiv-arch.png" /></p>
<div class="section" id="contiv-ksr">
<h3>Contiv KSR<a class="headerlink" href="#contiv-ksr" title="Permalink to this headline">¶</a></h3>
<p>Contiv KSR (Kubernetes State Reflector) is an agent that subscribes to k8s control plane, watches k8s resources and
propagates all relevant cluster-related information into the Contiv ETCD data store.
Other Contiv components do not access the k8s API directly, they subscribe to
Contiv ETCD instead. For more information on KSR, read the
<a class="reference external" href="https://github.com/contiv/vpp/blob/master/cmd/contiv-ksr/README">KSR Readme</a>.</p>
</div>
<div class="section" id="contiv-etcd">
<h3>Contiv ETCD<a class="headerlink" href="#contiv-etcd" title="Permalink to this headline">¶</a></h3>
<p>Contiv/VPP uses its own instance of the ETCD database for storage of k8s cluster-related data
reflected by KSR, which are then accessed by Contiv vSwitch Agents running on
individual nodes. Apart from the data reflected by KSR, ETCD also stores persisted VPP
configuration of individual vswitches (mainly used to restore the operation after restarts),
as well as some more internal metadata.</p>
</div>
<div class="section" id="contiv-vswitch">
<h3>Contiv vSwitch<a class="headerlink" href="#contiv-vswitch" title="Permalink to this headline">¶</a></h3>
<p>vSwitch is the main networking component that provides the connectivity to PODs.
It deploys on each node in the cluster, and consists of two main components packed
into a single Docker container: VPP and Contiv VPP Agent.</p>
<p><strong>VPP</strong> is the data plane software that provides the connectivity between PODs, host Linux
network stack, and data-plane NIC interface controlled by VPP:</p>
<ul class="simple">
<li><p>PODs are connected to VPP using TAP interfaces wired between VPP, and each POD network namespace.</p></li>
<li><p>host network stack is connected to VPP using another TAP interface connected
to the main (default) network namespace.</p></li>
<li><p>data-plane NIC is controlled directly by VPP using DPDK. Note, this means that
this interface is not visible to the host Linux network stack, and the node either needs another
management interface for k8s control plane communication, or
[STN (Steal The NIC)](SINGLE_NIC_SETUP.html) deployment must be applied.</p></li>
</ul>
<p><strong>Contiv VPP Agent</strong> is the control plane part of the vSwitch container. It is responsible
for configuring the VPP according to the information gained from ETCD, and requests
from Contiv STN. It is based on the  <a class="reference external" href="https://github.com/ligato/vpp-agent">Ligato VPP Agent</a> code with extensions that are related to k8s.</p>
<p>For communication with VPP, it uses VPP binary API messages sent via shared memory using
<a class="reference external" href="https://wiki.fd.io/view/GoVPP">GoVPP</a>.
For connection with Contiv STN, the agent acts as a GRPC server serving CNI requests
forwarded from the Contiv CNI.</p>
</div>
<div class="section" id="contiv-cni">
<h3>Contiv CNI<a class="headerlink" href="#contiv-cni" title="Permalink to this headline">¶</a></h3>
<p>Contiv CNI  (Container Network Interface) is a simple binary that implements the
<a class="reference external" href="https://github.com/containernetworking/cni">Container Network Interface</a>
API and is being executed by Kubelet upon POD creation and deletion. The CNI binary
just packs the request into a GRPC request and forwards it to the Contiv VPP Agent
running on the same node, which then processes it (wires/unwires the container)
and replies with a response, which is then forwarded back to Kubelet.</p>
</div>
<div class="section" id="contiv-stn-daemon">
<h3>Contiv STN Daemon<a class="headerlink" href="#contiv-stn-daemon" title="Permalink to this headline">¶</a></h3>
<p>This section discusses how the Contiv [STN (Steal The NIC)](SINGLE_NIC_SETUP.html) daemon operation works. As already mentioned, the default setup of Contiv/VPP requires two network interfaces
per node: one controlled by VPP for data facing PODs, and one controlled by the host
network stack for k8s control plane communication. In case that your k8s nodes
do not provide two network interfaces, Contiv/VPP can work in the single NIC setup,
when the interface will be “stolen” from the host network stack just before starting
the VPP and configured with the same IP address on VPP, as well as
on the host-VPP interconnect TAP interface, as it had in the host before it.
For more information on STN setup, read the [Single NIC Setup README](./SINGLE_NIC_SETUP.html)</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="SECURITY.html" class="btn btn-neutral float-right" title="Security" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Contiv/VPP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2020, Linux Foundation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>