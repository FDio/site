<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MTU in VPP &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Syslog protocol support" href="sylog_doc.html" />
    <link rel="prev" title="Switched Port Analyzer" href="span_doc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Core Features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fib/index.html">The FIB</a></li>
<li class="toctree-l2"><a class="reference internal" href="sr/index.html">Segment routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="punt.html">Punting Packets</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec.html">IPSec (IP Security)</a></li>
<li class="toctree-l2"><a class="reference internal" href="bfd_doc.html">BFD module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipfix_doc.html">IPFIX support</a></li>
<li class="toctree-l2"><a class="reference internal" href="span_doc.html">Switched Port Analyzer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">MTU in VPP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-structures">Data structures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mtu-api">MTU API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#set-physical-mtu">Set physical MTU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-the-l2-payload-mtu">Set the L2 payload MTU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-interface-mtu">Get interface MTU</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mtu-cli">MTU CLI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sylog_doc.html">Syslog protocol support</a></li>
<li class="toctree-l2"><a class="reference internal" href="eventviewer.html">Event-logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats.html">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="selinux_doc.html">SELinux - VPP Custom SELinux Policy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Core Features</a> &raquo;</li>
      <li>MTU in VPP</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/developer/corefeatures/mtu.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mtu-in-vpp">
<span id="mtu-doc"></span><h1>MTU in VPP<a class="headerlink" href="#mtu-in-vpp" title="Permalink to this headline"></a></h1>
<p>Maximum Transmission Unit is a term used to describe the maximum sized
“thingy” that can be sent out an interface. It can refer to the maximum
frame size that a NIC can send. On Ethernet that would include the
Ethernet header but typically not the IGF. It can refer to the maximum
packet size, that is, on Ethernet an MTU of 1500, would allow an IPv4
packet of 1500 bytes, that would result in an Ethernet frame of 1518
bytes.</p>
<p>VPP allows setting of the physical payload MTU. I.e. not including L2
overhead. Setting the hardware MTU will program the NIC. This MTU will
be inherited by all software interfaces.</p>
<p>VPP also allows setting of the payload MTU for software interfaces.
Independently of the MTU set on the hardware. If the software payload
MTU is set higher than the capability of the NIC, the packet will be
dropped.</p>
<p>In addition VPP supports setting the MTU of individual network layer
protocols. IPv4, IPv6 or MPLS. For example an IPv4 MTU of 1500 (includes
the IPv4 header) will fit in a hardware payload MTU of 1500.</p>
<p><em>Note we might consider changing the hardware payload MTU to hardware
MTU</em>. That is, the MTU includes all L2 framing. Then the payload MTU can
be calculated based on the interface’s configuration. E.g. 802.1q tags
etc.</p>
<p>There are currently no checks or warnings if e.g. the user configures a
per-protocol MTU larger than the underlying payload MTU. If that happens
packets will be fragmented or dropped.</p>
<section id="data-structures">
<h2>Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline"></a></h2>
<p>The hardware payload MTU is stored in the max_packet_bytes variable in
the vnet_hw_interface_t structure.</p>
<p>The software MTU (previously max_l3_packet_bytes) is in
vnet_sw_interface_t-&gt;in mtu[VNET_N_MTU].</p>
<section id="mtu-api">
<h3>MTU API<a class="headerlink" href="#mtu-api" title="Permalink to this headline"></a></h3>
</section>
</section>
<section id="set-physical-mtu">
<h2>Set physical MTU<a class="headerlink" href="#set-physical-mtu" title="Permalink to this headline"></a></h2>
<p>This API message is used to set the physical MTU. It is currently
limited to Ethernet interfaces. Note, this programs the NIC.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">autoreply</span> <span class="n">define</span> <span class="n">hw_interface_set_mtu</span>
<span class="p">{</span>
 <span class="n">u32</span> <span class="n">client_index</span><span class="p">;</span>
 <span class="n">u32</span> <span class="n">context</span><span class="p">;</span>
 <span class="n">u32</span> <span class="n">sw_if_index</span><span class="p">;</span>
 <span class="n">u16</span> <span class="n">mtu</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="set-the-l2-payload-mtu">
<h2>Set the L2 payload MTU<a class="headerlink" href="#set-the-l2-payload-mtu" title="Permalink to this headline"></a></h2>
<dl class="simple">
<dt>:: note</dt><dd><p>(not including the L2 header) and per-protocol MTUs</p>
</dd>
</dl>
<p>This API message sets the L3 payload MTU. E.g. on Ethernet it is the
maximum size of the Ethernet payload. If a value is left as 0, then the
default is picked from VNET_MTU_L3.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>autoreply define sw_interface_set_mtu
{
 u32 client_index;
 u32 context;
 u32 sw_if_index;
 /* $$$$ Replace with enum */
 u32 mtu[4]; /* 0 - L3, 1 - IP4, 2 - IP6, 3 - MPLS */
};
</pre></div>
</div>
</section>
<section id="get-interface-mtu">
<h2>Get interface MTU<a class="headerlink" href="#get-interface-mtu" title="Permalink to this headline"></a></h2>
<p>The various MTUs on an interface can be queried with the
sw_interface_dump/sw_interface_details calls.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">define</span> <span class="n">sw_interface_details</span>
<span class="p">{</span>
  <span class="o">/*</span> <span class="n">MTU</span> <span class="o">*/</span>
  <span class="n">u16</span> <span class="n">link_mtu</span><span class="p">;</span>

  <span class="o">/*</span> <span class="n">Per</span> <span class="n">protocol</span> <span class="n">MTUs</span> <span class="o">*/</span>
  <span class="n">u32</span> <span class="n">mtu</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="o">/*</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">L3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">IP4</span><span class="p">,</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">IP6</span><span class="p">,</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">MPLS</span> <span class="o">*/</span>
<span class="p">};</span>
</pre></div>
</div>
<section id="mtu-cli">
<h3>MTU CLI<a class="headerlink" href="#mtu-cli" title="Permalink to this headline"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">interface</span> <span class="n">mtu</span> <span class="p">[</span><span class="n">packet</span><span class="o">|</span><span class="n">ip4</span><span class="o">|</span><span class="n">ip6</span><span class="o">|</span><span class="n">mpls</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">interface</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="span_doc.html" class="btn btn-neutral float-left" title="Switched Port Analyzer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sylog_doc.html" class="btn btn-neutral float-right" title="Syslog protocol support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>