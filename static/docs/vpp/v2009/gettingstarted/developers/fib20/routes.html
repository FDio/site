

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Routes &mdash; The Vector Packet Processor 20.01 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/rules.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Attached Export" href="attachedexport.html" />
    <link rel="prev" title="ARP Entries" href="arpentries.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> The Vector Packet Processor
          

          
            
            <img src="../../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../whatisvpp/index.html">The Vector Packet Processor (VPP)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../users/index.html">For Users</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">For Developers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../building.html">Building VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../running_vpp.html">Running VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gdb_examples.html">GDB Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add_plugin.html">Adding a plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add_plugin_goapi.html">Add a plugin’s GO API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../softwarearchitecture.html">Software Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infrastructure.html">VPPINFRA (Infrastructure)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html">VLIB (Vector Processing Library)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html#packet-generator-input-script">Packet generator input script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html#start-vpp-with-2-worker-threads">Start vpp with 2 worker threads</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html#enable-tracing-and-start-the-packet-generator">Enable tracing, and start the packet generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vlib.html#sample-run">Sample Run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vnet.html">VNET (VPP Network Stack)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../featurearcs.html">Feature Arcs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../metadata.html">Buffer Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../metadata.html#buffer-metadata-extensions">Buffer Metadata Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multiarch/index.html">Multi-architecture support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bihash.html">Bounded-index Extensible Hashing (bihash)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vpp_api_module.html">VPP API module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../binary_api_support.html">Binary API Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../buildsystem/index.html">Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eventviewer.html">Event-logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../eventviewer.html#g2-graphical-event-viewer">G2 graphical event viewer</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">FIB 2.0 Hierarchical, Protocol, Independent</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="thedatamodel.html">The Data Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="tunnels.html">Tunnels</a></li>
<li class="toctree-l4"><a class="reference internal" href="mplsfib.html">MPLS FIB</a></li>
<li class="toctree-l4"><a class="reference internal" href="multicast.html">IP Multicast FIB</a></li>
<li class="toctree-l4"><a class="reference internal" href="fastconvergence.html">Fast Convergence</a></li>
<li class="toctree-l4"><a class="reference internal" href="scale.html">Scale</a></li>
<li class="toctree-l4"><a class="reference internal" href="scale.html#ip4-heap">IP4 Heap</a></li>
<li class="toctree-l4"><a class="reference internal" href="scale.html#ip6-heap">IP6 Heap</a></li>
<li class="toctree-l4"><a class="reference internal" href="scale.html#main-heap">Main Heap</a></li>
<li class="toctree-l4"><a class="reference internal" href="scale.html#stats-heap">Stats Heap</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../buildwireshark.html">How to build a vpp dispatch trace aware Wireshark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../punt.html">Punting Packets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quic_plugin.html">QUIC HostStack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cross_compile_macos.html">Cross compilation on MacOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cnat.html">Cloud NAT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../VPPAPI.html">VPP API Language    {#api_lang_doc}</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../writingdocs/index.html">Writing Documents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../links/index.html">VPP Wiki, Doxygen and Other Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../featuresbyrelease/index.html">Features by Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../events/index.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../relatedprojects/index.html">Related Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../archive/index.html">Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Vector Packet Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Getting Started</a> &raquo;</li>
        
          <li><a href="../index.html">For Developers</a> &raquo;</li>
        
          <li><a href="index.html">FIB 2.0 Hierarchical, Protocol, Independent</a> &raquo;</li>
        
          <li><a href="thedatamodel.html">The Data Model</a> &raquo;</li>
        
          <li><a href="controlplane.html">The Control Plane</a> &raquo;</li>
        
      <li>Routes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/gettingstarted/developers/fib20/routes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="routes">
<span id="id1"></span><h1>Routes<a class="headerlink" href="#routes" title="Permalink to this headline">¶</a></h1>
<p>The control plane will install a route in a table for a prefix via a list of paths.
The prime function of the FIB is to <em>resolve</em> that route. To resolve a route is to
construct an object graph that fully describes all elements of the route. In Figure 3
the route is resolved as the graph is complete from <em>fib_entry_t</em> to <em>ip_adjacency_t</em>.</p>
<p>In some routing models a VRF will consist of a set of tables for IPv4 and IPv6, and
unicast and multicast. In VPP there is no such grouping. Each table is distinct from
each other. A table is identified by its numerical ID. The ID range is separate for
each address family.</p>
<p>A table is comprised of two route data-bases; forwarding and non-forwarding. The
forwarding data-base contains routes against which a packet will perform a longest
prefix match (LPM) in the data-plane. The non-forwarding DB contains all the routes
with which VPP has been programmed some of these routes may be unresolved for reasons
that prevent their insertion into the forwarding DB
(see section: Adjacency source FIB entries).</p>
<p>The route data is decomposed into three parts; entry, path-list and paths;</p>
<ul>
<li><p>The <em>fib_entry_t</em>, which contains the routes prefix, is representation of that prefix’s entry in the FIB table.</p></li>
<li><p>The <em>fib_path_t</em> is a description of where to send the packets destined to the route’s prefix. There are several types of path.</p>
<blockquote>
<div><ul class="simple">
<li><p>Attached next-hop: the path is described with an interface and a next-hop. The next-hop is in the same sub-net as the router’s own address on that interface, hence the peer is considered to be <em>attached</em></p></li>
<li><p>Attached: the path is described only by an interface. All address covered by the prefix are on the same L2 segment to which that router’s interface is attached. This means it is possible to ARP for any address covered by the prefix which is usually not the case (hence the proxy ARP debacle in IOS). An attached path is only appropriate for a point-to-point (P2P) interface where ARP is not required, i.e. a GRE tunnel.</p></li>
<li><p>Recursive: The path is described only via the next-hop and table-id.</p></li>
<li><p>De-aggregate: The path is described only via the special all zeros address and a table-id. This implies a subsequent lookup in the table should be performed.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The <em>fib_path_list_t</em> represents the list of paths from which to choose one when forwarding. The path-list is a shared object, i.e. it is the parent to multiple fib_entry_t children. In order to share any object type it is necessary for a child to search for an existing object matching its requirements. For this there must be a data-base. The key to the path-list data-base is a combined description of all of the paths it contains <a class="footnote-reference brackets" href="#f2" id="id2">1</a>.  Searching the path-list database is required with each route addition, so it is populated only with path-lists for which sharing will bring convergence benefits (see Section: <a class="reference internal" href="fastconvergence.html#fastconvergence"><span class="std std-ref">Fast Convergence</span></a>).</p></li>
</ul>
<div class="figure align-default">
<img alt="../../../_images/fib20fig2.png" src="../../../_images/fib20fig2.png" />
</div>
<p>Figure 2: Route data model class diagram</p>
<p>Figure 2 shows an example of a route with two attached-next-hop paths. Each of these
paths will <em>resolve</em> by finding the adjacency that matches the paths attributes, which
are the same as the key for the adjacency data-base <a class="footnote-reference brackets" href="#f3" id="id3">2</a>. The <em>forwarding information (FI)</em>
is the set of adjacencies that are available for load-balancing the traffic in the
data-plane. A path <em>contributes</em> an adjacency to the route’s forwarding information, the
path-list contributes the full forwarding information for IP packets.</p>
<div class="figure align-default">
<img alt="../../../_images/fib20fig3.png" src="../../../_images/fib20fig3.png" />
</div>
<p>Figure 3: Route object diagram</p>
<p>Figure 3 shows the object instances and their relationships created in order to resolve
the routes also shown. The graph nature of these relationships is evident; children
are displayed at the top of the diagram, their parents below them. Forward walks are
thus from top to bottom, back walks bottom to top. The diagram shows the objects
that are shared, the path-list and adjacency. Sharing objects is critical to fast
convergence (see section <a class="reference internal" href="fastconvergence.html#fastconvergence"><span class="std std-ref">Fast Convergence</span></a>).</p>
<div class="section" id="fib-sources">
<h2>FIB sources<a class="headerlink" href="#fib-sources" title="Permalink to this headline">¶</a></h2>
<p>There are various entities in the system that can add routes to the FIB tables.
Each of these entities is termed a <em>source</em> When the same prefix is added by different
sources the FIB must arbitrate between them to determine which source will contribute
the forwarding information. Since each source determines the forwarding information
using different best path and loop prevention algorithms, it is not correct for the
forwarding information of multiple sources to be combined. Instead the FIB must choose
to use the forwarding information from only one source. This choice is based on a static
priority assignment <a class="footnote-reference brackets" href="#f4" id="id4">3</a>. The FIB must maintain the information each source has added
so it can be restored should that source become the best source. VPP has two
<em>control-plane</em> sources; the API and the CLI the API has the higher priority.
Each <em>source</em> data is represented by a <em>fib_entry_src_t</em> object of which a
<em>fib_entry_t</em> maintains a sorted vector.n A prefix is <em>connected</em> when it is
applied to a routers interface.</p>
<p>The following configuration:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">set</span> interface address <span class="m">192</span>.168.1.1/24 GigabitEthernet0/8/0
</pre></div>
</div>
<p>results in the addition of two FIB entries; 192.168.1.0/24 which is connected and
attached, and 192.168.1.1/32 which is connected and local (a.k.a receive or for-us).
Both prefixes are <em>interface</em> sourced. The interface source has a high priority, so
the accidental or nefarious addition of identical prefixes does not prevent the
router from correctly forwarding. Packets matching a connected prefix will
generate an ARP request for the packets destination address, this process is known
as a <em>glean</em>.</p>
<p>An <em>attached</em> prefix also results in a glean, but the router does not have its own
address in that sub-net. The following configuration will result in an attached
route, which resolves via an attached path;</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ip route add table X <span class="m">10</span>.10.10.0/24 via gre0
</pre></div>
</div>
<p>as mentioned before, these are only appropriate for point-to-point links. An
attached-host prefix is covered by either an attached prefix (note that connected
prefixes are also attached). If table X is not the table to which gre0 is bound,
then this is the case of an attached export (see the section <a class="reference internal" href="attachedexport.html#attachedexport"><span class="std std-ref">Attached Export</span></a>).</p>
</div>
<div class="section" id="adjacency-source-fib-entries">
<h2>Adjacency source FIB entries<a class="headerlink" href="#adjacency-source-fib-entries" title="Permalink to this headline">¶</a></h2>
<p>Whenever an ARP entry is created it will source a <em>fib_entry_t</em>. In this case the
route is of the form:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ip route add table X <span class="m">10</span>.0.0.1/32 via <span class="m">10</span>.0.0.1 GigabitEthernet0/8/0
</pre></div>
</div>
<p>It is a host prefix with a path whose next-hop address is the same. This route
highlights the distinction between the route’s prefix - a description of the traffic
to match - and the path - a description of where to send the matched traffic.
Table X is the same table to which the interface is bound. FIB entries that are
sourced by adjacencies are termed <em>adj-fibs</em>. The priority of the adjacency source
is lower than the API source, so the following configuration:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">set</span> interface address <span class="m">192</span>.168.1.1/24 GigabitEthernet0/8/0
<span class="gp">$</span> ip arp <span class="m">192</span>.168.1.2 GigabitEthernet0/8/0 dead.dead.dead
<span class="gp">$</span> ip route add <span class="m">192</span>.168.1.2 via <span class="m">10</span>.10.10.10 GigabitEthernet1/8/0
</pre></div>
</div>
<p>will forward traffic for 192.168.1.2 via GigabitEthernet1/8/0. That is the route added by the control
plane is favoured over the adjacency discovered by ARP. The control plane, with its
associated authentication, is considered the authoritative source. To counter the
nefarious addition of adj-fibs, through the nefarious injection of adjacencies, the
FIB is also required to ensure that only adj-fibs whose less specific covering prefix
is attached are installed in forwarding. This requires the use of <em>cover tracking</em>,
where a route maintains a dependency relationship with the route that is its less
specific cover. When this cover changes (i.e. there is a new covering route) or the
forwarding information of the cover is updated, then the covered route is notified.
Adj-fibs that fail this cover check are not installed in the fib_table_t’s forwarding
table, there are only present in the non-forwarding table.</p>
<p>Overlapping sub-nets are not supported, so no adj-fib has multiple paths. The control
plane is expected to remove a prefix configured for an interface before the interface
changes RF.</p>
<p>So while the following configuration is accepted:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">set</span> interface address <span class="m">192</span>.168.1.1/32 GigabitEthernet0/8/0
<span class="gp">$</span> ip arp <span class="m">192</span>.168.1.2 GigabitEthernet0/8/0 dead.dead.dead
<span class="gp">$</span> <span class="nb">set</span> interface ip table GigabitEthernet0/8/0 <span class="m">2</span>
</pre></div>
</div>
<p>it does not result in the desired behaviour, where the adj-fib and connected adjacencies are
moved to table 2.</p>
</div>
<div class="section" id="recursive-routes">
<h2>Recursive Routes<a class="headerlink" href="#recursive-routes" title="Permalink to this headline">¶</a></h2>
<p>Figure 4 shows the data structures used to describe a recursive route. The
representation is almost identical to attached next-hop paths. The difference
being that the <em>fib_path_t</em> has a parent that is another <em>fib_entry_t</em>, termed the
<em>via-entry</em></p>
<div class="figure align-default">
<img alt="../../../_images/fib20fig4.png" src="../../../_images/fib20fig4.png" />
</div>
<p>Figure 4: Recursive route class diagram.</p>
<p>In order to forward traffic to 64.10.128.0/20 the FIB must first determine how to forward
traffic to 1.1.1.1/32. This is recursive resolution. Recursive resolution, which is
essentially a cache of the data-plane result, emulates a longest prefix match for the
<em>via-address” 1.1.1.1 in the *via-table</em> table 0 <a class="footnote-reference brackets" href="#f5" id="id5">4</a>.</p>
<p>Recursive resolution (RR) will source a host-prefix entry in the via-table for the
via-address. The RR source is a low priority source. In the unlikely <a class="footnote-reference brackets" href="#f6" id="id6">5</a> event that the
RR source is the best source, then it must derive forwarding information from its
covering prefix.</p>
<p>There are two cases to consider:</p>
<ul class="simple">
<li><p>The cover is connected <a class="footnote-reference brackets" href="#f7" id="id7">6</a>. The via-address is then an attached host and the RR source can resolve directly via the adjacency with the key {via-address, interface-of-connected-cover}</p></li>
<li><p>The cover is not connected <a class="footnote-reference brackets" href="#f8" id="id8">7</a>. The RR source can directly inherit the forwarding information from its cover.</p></li>
</ul>
<p>This dependency on the covering prefix means the RR source will track its cover The
covering prefix will <em>change</em> when;</p>
<ul class="simple">
<li><p>A more specific prefix is inserted. For this reason whenever an entry is inserted into a FIB table its cover must be found so that its covered dependents can be informed.</p></li>
<li><p>The existing cover is removed. The covered prefixes must form a new relationship with the next less specific.</p></li>
</ul>
<p>The cover will be <em>updated</em> when the route for the covering prefix is modified. The
cover tracking mechanism will provide the RR sourced entry with a notification in the
event of a change or update of the cover, and the source can take the necessary action.</p>
<p>The RR sourced FIB entry becomes the parent of the <em>fib_path_t</em> and will contribute its
forwarding information to that path, so that the child’s FIB entry can construct its own
forwarding information.</p>
<p>Figure 5 shows the object instances created to represent the recursive route and
its resolving route also shown.</p>
<div class="figure align-default">
<img alt="../../../_images/fib20fig5.png" src="../../../_images/fib20fig5.png" />
</div>
<p>Figure 5: Recursive Routes object diagram</p>
<p>If the source adding recursive routes does not itself perform recursive resolution <a class="footnote-reference brackets" href="#f9" id="id9">8</a>
then it is possible that the source may inadvertently programme a recursion loop.</p>
<p>An example of a recursion loop is the following configuration:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ip route add <span class="m">5</span>.5.5.5/32 via <span class="m">6</span>.6.6.6
<span class="gp">$</span> ip route add <span class="m">6</span>.6.6.6/32 via <span class="m">7</span>.7.7.7
<span class="gp">$</span> ip route add <span class="m">7</span>.7.7.7/32 via <span class="m">5</span>.5.5.5
</pre></div>
</div>
<p>This shows a loop over three levels, but any number is possible. FIB will detect
recursion loops by forward walking the graph when a <em>fib_entry_t</em> forms a child-parent
relationship with a <em>fib_path_list_t</em>. The walk checks to see if the same object instances
are encountered. When a recursion loop is formed the control plane <a class="footnote-reference brackets" href="#f10" id="id10">9</a> graph becomes
cyclic, thus allowing the child-parent dependencies to form. This is necessary so that
when the loop breaks, the affected children and be updated.</p>
</div>
<div class="section" id="output-labels">
<h2>Output labels<a class="headerlink" href="#output-labels" title="Permalink to this headline">¶</a></h2>
<p>A route may have associated out MPLS labels <a class="footnote-reference brackets" href="#f11" id="id11">10</a>. These are labels that are expected
to be imposed on a packet as it is forwarded. It is important to note that an MPLS
label is per-route and per-path, therefore, even though routes share paths the do not
necessarily have the same label for that path <a class="footnote-reference brackets" href="#f12" id="id12">11</a>. A label is therefore uniquely associated
to a <em>fib_entry_t</em> and associated with one of the <em>fib_path_t</em> to which it forwards.
MPLS labels are modelled via the generic concept of a <em>path-extension</em> A <em>fib_entry_t</em>
therefore has a vector of zero to many <em>fib_path_ext_t objects</em> to represent the labels
with which it is configured.</p>
<p class="rubric">Footnotes:</p>
<dl class="footnote brackets">
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Optimisations</p>
</dd>
<dt class="label" id="f3"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>Note it is valid for either interface to be bound to a different table than table 1</p>
</dd>
<dt class="label" id="f4"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>The engaged reader can see the full priority list in vnet/vnet/fib/fib_entry.h</p>
</dd>
<dt class="label" id="f5"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Note it is only possible to add routes via an address (i.e. a/32 or /128) not via a shorter mask prefix. There is no use case for the latter</p>
</dd>
<dt class="label" id="f6"><span class="brackets"><a class="fn-backref" href="#id6">5</a></span></dt>
<dd><p>For iBGP the via-address is the loopback address of the peer PE, for eBGP it is the adj-fib for the CE</p>
</dd>
<dt class="label" id="f7"><span class="brackets"><a class="fn-backref" href="#id7">6</a></span></dt>
<dd><p>As is the case ofr eBGP</p>
</dd>
<dt class="label" id="f8"><span class="brackets"><a class="fn-backref" href="#id8">7</a></span></dt>
<dd><p>As is the case for iBGP</p>
</dd>
<dt class="label" id="f9"><span class="brackets"><a class="fn-backref" href="#id9">8</a></span></dt>
<dd><p>If that source is relying on FIB to perform recursive resolution, then there is no reason it should do so itself.</p>
</dd>
<dt class="label" id="f10"><span class="brackets"><a class="fn-backref" href="#id10">9</a></span></dt>
<dd><p>The derived data-plane graph MUST never be cyclic</p>
</dd>
<dt class="label" id="f11"><span class="brackets"><a class="fn-backref" href="#id11">10</a></span></dt>
<dd><p>Advertised, e.g. by LDP, SR or BGP</p>
</dd>
<dt class="label" id="f12"><span class="brackets"><a class="fn-backref" href="#id12">11</a></span></dt>
<dd><p>The only case where the labels will be the same is BGP VPNv4 label allocation per-VRF</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="attachedexport.html" class="btn btn-neutral float-right" title="Attached Export" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="arpentries.html" class="btn btn-neutral float-left" title="ARP Entries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2020, Linux Foundation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>