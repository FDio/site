<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buffer Metadata &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Multi-architecture support" href="multiarch/index.html" />
    <link rel="prev" title="Feature Arcs" href="featurearcs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Core Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="softwarearchitecture.html">Software Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="infrastructure.html">VPPINFRA (Infrastructure)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vlib.html">VLIB (Vector Processing Library)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vnet.html">VNET (VPP Network Stack)</a></li>
<li class="toctree-l2"><a class="reference internal" href="featurearcs.html">Feature Arcs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Buffer Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vlib-vector-library-primary-buffer-metadata">Vlib (Vector library) primary buffer metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vnet-network-stack-primary-buffer-metadata">Vnet (network stack) primary buffer metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vnet-network-stack-secondary-buffer-metadata">Vnet (network stack) secondary buffer metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buffer-metadata-extensions">Buffer Metadata Extensions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="multiarch/index.html">Multi-architecture support</a></li>
<li class="toctree-l2"><a class="reference internal" href="bihash.html">Bounded-index Extensible Hashing (bihash)</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildsystem/index.html">Build System</a></li>
<li class="toctree-l2"><a class="reference internal" href="mem.html">VPP mem preload</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi_thread.html">Multi-threading in VPP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../corefeatures/index.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Core Architecture</a> &raquo;</li>
      <li>Buffer Metadata</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/developer/corearchitecture/buffer_metadata.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="buffer-metadata">
<h1>Buffer Metadata<a class="headerlink" href="#buffer-metadata" title="Permalink to this headline"></a></h1>
<p>Each vlib_buffer_t (packet buffer) carries buffer metadata which
describes the current packet-processing state. The underlying techniques
have been used for decades, across multiple packet processing
environments.</p>
<p>We will examine vpp buffer metadata in some detail, but folks who need
to manipulate and/or extend the scheme should expect to do a certain
level of code inspection.</p>
<section id="vlib-vector-library-primary-buffer-metadata">
<h2>Vlib (Vector library) primary buffer metadata<a class="headerlink" href="#vlib-vector-library-primary-buffer-metadata" title="Permalink to this headline"></a></h2>
<p>The first 64 octets of each vlib_buffer_t carries the primary buffer
metadata. See …/src/vlib/buffer.h for full details.</p>
<p>Important fields:</p>
<ul class="simple">
<li><p>i16 current_data: the signed offset in data[], pre_data[] that we are
currently processing. If negative current header points into the
pre-data (rewrite space) area.</p></li>
<li><p>u16 current_length: nBytes between current_data and the end of this
buffer.</p></li>
<li><p>u32 flags: Buffer flag bits. Heavily used, not many bits left</p>
<ul>
<li><p>src/vlib/buffer.h flag bits</p>
<ul>
<li><p>VLIB_BUFFER_IS_TRACED: buffer is traced</p></li>
<li><p>VLIB_BUFFER_NEXT_PRESENT: buffer has multiple chunks</p></li>
<li><p>VLIB_BUFFER_TOTAL_LENGTH_VALID:
total_length_not_including_first_buffer is valid (see below)</p></li>
</ul>
</li>
<li><p>src/vnet/buffer.h flag bits</p>
<ul>
<li><p>VNET_BUFFER_F_L4_CHECKSUM_COMPUTED: tcp/udp checksum has been
computed</p></li>
<li><p>VNET_BUFFER_F_L4_CHECKSUM_CORRECT: tcp/udp checksum is correct</p></li>
<li><p>VNET_BUFFER_F_VLAN_2_DEEP: two vlan tags present</p></li>
<li><p>VNET_BUFFER_F_VLAN_1_DEEP: one vlan tag present</p></li>
<li><p>VNET_BUFFER_F_SPAN_CLONE: packet has already been cloned (span
feature)</p></li>
<li><p>VNET_BUFFER_F_LOOP_COUNTER_VALID: packet look-up loop count
valid</p></li>
<li><p>VNET_BUFFER_F_LOCALLY_ORIGINATED: packet built by vpp</p></li>
<li><p>VNET_BUFFER_F_IS_IP4: packet is ipv4, for checksum offload</p></li>
<li><p>VNET_BUFFER_F_IS_IP6: packet is ipv6, for checksum offload</p></li>
<li><p>VNET_BUFFER_F_OFFLOAD_IP_CKSUM: hardware ip checksum offload
requested</p></li>
<li><p>VNET_BUFFER_F_OFFLOAD_TCP_CKSUM: hardware tcp checksum offload
requested</p></li>
<li><p>VNET_BUFFER_F_OFFLOAD_UDP_CKSUM: hardware udp checksum offload
requested</p></li>
<li><p>VNET_BUFFER_F_IS_NATED: natted packet, skip input checks</p></li>
<li><p>VNET_BUFFER_F_L2_HDR_OFFSET_VALID: L2 header offset valid</p></li>
<li><p>VNET_BUFFER_F_L3_HDR_OFFSET_VALID: L3 header offset valid</p></li>
<li><p>VNET_BUFFER_F_L4_HDR_OFFSET_VALID: L4 header offset valid</p></li>
<li><p>VNET_BUFFER_F_FLOW_REPORT: packet is an ipfix packet</p></li>
<li><p>VNET_BUFFER_F_IS_DVR: packet to be reinjected into the l2
output path</p></li>
<li><p>VNET_BUFFER_F_QOS_DATA_VALID: QoS data valid in
vnet_buffer_opaque2</p></li>
<li><p>VNET_BUFFER_F_GSO: generic segmentation offload requested</p></li>
<li><p>VNET_BUFFER_F_AVAIL1: available bit</p></li>
<li><p>VNET_BUFFER_F_AVAIL2: available bit</p></li>
<li><p>VNET_BUFFER_F_AVAIL3: available bit</p></li>
<li><p>VNET_BUFFER_F_AVAIL4: available bit</p></li>
<li><p>VNET_BUFFER_F_AVAIL5: available bit</p></li>
<li><p>VNET_BUFFER_F_AVAIL6: available bit</p></li>
<li><p>VNET_BUFFER_F_AVAIL7: available bit</p></li>
</ul>
</li>
</ul>
</li>
<li><p>u32 flow_id: generic flow identifier</p></li>
<li><p>u8 ref_count: buffer reference / clone count (e.g. for span
replication)</p></li>
<li><p>u8 buffer_pool_index: buffer pool index which owns this buffer</p></li>
<li><p>vlib_error_t (u16) error: error code for buffers enqueued to error
handler</p></li>
<li><p>u32 next_buffer: buffer index of next buffer in chain. Only valid if
VLIB_BUFFER_NEXT_PRESENT is set</p></li>
<li><p>union</p>
<ul>
<li><p>u32 current_config_index: current index on feature arc</p></li>
<li><p>u32 punt_reason: reason code once packet punted. Mutually
exclusive with current_config_index</p></li>
</ul>
</li>
<li><p>u32 opaque[10]: primary vnet-layer opaque data (see below)</p></li>
<li><p>END of first cache line / data initialized by the buffer allocator</p></li>
<li><p>u32 trace_index: buffer’s index in the packet trace subsystem</p></li>
<li><p>u32 total_length_not_including_first_buffer: see
VLIB_BUFFER_TOTAL_LENGTH_VALID above</p></li>
<li><p>u32 opaque2[14]: secondary vnet-layer opaque data (see below)</p></li>
<li><p>u8 pre_data[VLIB_BUFFER_PRE_DATA_SIZE]: rewrite space, often used to
prepend tunnel encapsulations</p></li>
<li><p>u8 data[0]: buffer data received from the wire. Ordinarily, hardware
devices use b-&gt;data[0] as the DMA target but there are exceptions. Do
not write code which blindly assumes that packet data starts in
b-&gt;data[0]. Use vlib_buffer_get_current(…).</p></li>
</ul>
</section>
<section id="vnet-network-stack-primary-buffer-metadata">
<h2>Vnet (network stack) primary buffer metadata<a class="headerlink" href="#vnet-network-stack-primary-buffer-metadata" title="Permalink to this headline"></a></h2>
<p>Vnet primary buffer metadata occupies space reserved in the vlib opaque
field shown above, and has the type name vnet_buffer_opaque_t.
Ordinarily accessed using the vnet_buffer(b) macro. See
../src/vnet/buffer.h for full details.</p>
<p>Important fields:</p>
<ul class="simple">
<li><p>u32 sw_if_index[2]: RX and TX interface handles. At the ip lookup
stage, vnet_buffer(b)-&gt;sw_if_index[VLIB_TX] is interpreted as a FIB
index.</p></li>
<li><p>i16 l2_hdr_offset: offset from b-&gt;data[0] of the packet L2 header.
Valid only if b-&gt;flags &amp; VNET_BUFFER_F_L2_HDR_OFFSET_VALID is set</p></li>
<li><p>i16 l3_hdr_offset: offset from b-&gt;data[0] of the packet L3 header.
Valid only if b-&gt;flags &amp; VNET_BUFFER_F_L3_HDR_OFFSET_VALID is set</p></li>
<li><p>i16 l4_hdr_offset: offset from b-&gt;data[0] of the packet L4 header.
Valid only if b-&gt;flags &amp; VNET_BUFFER_F_L4_HDR_OFFSET_VALID is set</p></li>
<li><p>u8 feature_arc_index: feature arc that the packet is currently
traversing</p></li>
<li><p>union</p>
<ul>
<li><p>ip</p>
<ul>
<li><p>u32 adj_index[2]: adjacency from dest IP lookup in [VLIB_TX],
adjacency from source ip lookup in [VLIB_RX], set to ~0 until
source lookup done</p></li>
<li><p>union</p>
<ul>
<li><p>generic fields</p></li>
<li><p>ICMP fields</p></li>
<li><p>reassembly fields</p></li>
</ul>
</li>
</ul>
</li>
<li><p>mpls fields</p></li>
<li><p>l2 bridging fields, only valid in the L2 path</p></li>
<li><p>l2tpv3 fields</p></li>
<li><p>l2 classify fields</p></li>
<li><p>vnet policer fields</p></li>
<li><p>MAP fields</p></li>
<li><p>MAP-T fields</p></li>
<li><p>ip fragmentation fields</p></li>
<li><p>COP (whitelist/blacklist filter) fields</p></li>
<li><p>LISP fields</p></li>
<li><p>TCP fields</p>
<ul>
<li><p>connection index</p></li>
<li><p>sequence numbers</p></li>
<li><p>header and data offsets</p></li>
<li><p>data length</p></li>
<li><p>flags</p></li>
</ul>
</li>
<li><p>SCTP fields</p></li>
<li><p>NAT fields</p></li>
<li><p>u32 unused[6]</p></li>
</ul>
</li>
</ul>
</section>
<section id="vnet-network-stack-secondary-buffer-metadata">
<h2>Vnet (network stack) secondary buffer metadata<a class="headerlink" href="#vnet-network-stack-secondary-buffer-metadata" title="Permalink to this headline"></a></h2>
<p>Vnet primary buffer metadata occupies space reserved in the vlib opaque2
field shown above, and has the type name vnet_buffer_opaque2_t.
Ordinarily accessed using the vnet_buffer2(b) macro. See
../src/vnet/buffer.h for full details.</p>
<p>Important fields:</p>
<ul class="simple">
<li><p>qos fields</p>
<ul>
<li><p>u8 bits</p></li>
<li><p>u8 source</p></li>
</ul>
</li>
<li><p>u8 loop_counter: used to detect and report internal forwarding loops</p></li>
<li><p>group-based policy fields</p>
<ul>
<li><p>u8 flags</p></li>
<li><p>u16 sclass: the packet’s source class</p></li>
</ul>
</li>
<li><p>u16 gso_size: L4 payload size, persists all the way to
interface-output in case GSO is not enabled</p></li>
<li><p>u16 gso_l4_hdr_sz: size of the L4 protocol header</p></li>
<li><p>union</p>
<ul>
<li><p>packet trajectory tracer (largely deprecated)</p>
<ul>
<li><p>u16 *trajectory_trace; only #if VLIB_BUFFER_TRACE_TRAJECTORY &gt;
0</p></li>
</ul>
</li>
<li><p>packet generator</p>
<ul>
<li><p>u64 pg_replay_timestamp: timestamp for replayed pcap trace
packets</p></li>
</ul>
</li>
<li><p>u32 unused[8]</p></li>
</ul>
</li>
</ul>
</section>
<section id="buffer-metadata-extensions">
<h2>Buffer Metadata Extensions<a class="headerlink" href="#buffer-metadata-extensions" title="Permalink to this headline"></a></h2>
<p>Plugin developers may wish to extend either the primary or secondary
vnet buffer opaque unions. Please perform a manual live variable
analysis, otherwise nodes which use shared buffer metadata space may
break things.</p>
<p>It’s not OK to add plugin or proprietary metadata to the core vpp engine
header files named above. Instead, proceed as follows. The example
concerns the vnet primary buffer opaque union vlib_buffer_opaque_t. It’s
a very simple variation to use the vnet secondary buffer opaque union
vlib_buffer_opaque2_t.</p>
<p>In a plugin header file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Add</span> <span class="n">arbitrary</span> <span class="n">buffer</span> <span class="n">metadata</span> <span class="o">*/</span>
<span class="c1">#include &lt;vnet/buffer.h&gt;</span>

<span class="n">typedef</span> <span class="n">struct</span>
<span class="p">{</span>
  <span class="n">u32</span> <span class="n">my_stuff</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">}</span> <span class="n">my_buffer_opaque_t</span><span class="p">;</span>

<span class="n">STATIC_ASSERT</span> <span class="p">(</span><span class="n">sizeof</span> <span class="p">(</span><span class="n">my_buffer_opaque_t</span><span class="p">)</span> <span class="o">&lt;=</span>
               <span class="n">STRUCT_SIZE_OF</span> <span class="p">(</span><span class="n">vnet_buffer_opaque_t</span><span class="p">,</span> <span class="n">unused</span><span class="p">),</span>
               <span class="s2">&quot;Custom meta-data too large for vnet_buffer_opaque_t&quot;</span><span class="p">);</span>

<span class="c1">#define my_buffer_opaque(b)  \</span>
  <span class="p">((</span><span class="n">my_buffer_opaque_t</span> <span class="o">*</span><span class="p">)((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)((</span><span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">opaque</span><span class="p">)</span> <span class="o">+</span> <span class="n">STRUCT_OFFSET_OF</span> <span class="p">(</span><span class="n">vnet_buffer_opaque_t</span><span class="p">,</span> <span class="n">unused</span><span class="p">)))</span>
</pre></div>
</div>
<p>To set data in the custom buffer opaque type given a vlib_buffer_t *b:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_buffer_opaque</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">my_stuff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
</pre></div>
</div>
<p>To read data from the custom buffer opaque type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stuff0</span> <span class="o">=</span> <span class="n">my_buffer_opaque</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">my_stuff</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="featurearcs.html" class="btn btn-neutral float-left" title="Feature Arcs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multiarch/index.html" class="btn btn-neutral float-right" title="Multi-architecture support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>