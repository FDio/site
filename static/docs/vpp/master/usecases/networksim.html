<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generating traffic with VPP &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Web applications with VPP" href="webapp.html" />
    <link rel="prev" title="Access Control Lists with VPP" href="acls.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Generating traffic with VPP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packet-generator-configuration">Packet Generator Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/corefeatures/index.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interfacing/binapi/index.html">The binary API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfacing/c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfacing/cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfacing/go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfacing/rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfacing/libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Generating traffic with VPP</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usecases/networksim.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="generating-traffic-with-vpp">
<h1>Generating traffic with VPP<a class="headerlink" href="#generating-traffic-with-vpp" title="Permalink to this headline"></a></h1>
<p>Vpp includes a fairly capable network simulator plugin, which can
simulate real-world round-trip times and a configurable network packet
loss rate. It’s perfect for evaluating the performance of a TCP stack
under specified delay/bandwidth/loss conditions.</p>
<p>The “nsim” plugin cross-connects two physical interfaces at layer 2,
introducing the specified delay and network loss parameters.
Reconfiguration on the fly is OK, with the proviso that packets held in
the network simulator scheduling wheel will be lost.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline"></a></h2>
<p>Configuration by debug CLI is simple. First, specify the simulator
configuration: unidirectional delay (half of the desired RTT), the link
bandwidth, and the expected average packet size. These parameters allow
the network simulator allocate the right amount of buffering to produce
the requested delay/bandwidth product.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">nsim</span> <span class="n">delay</span> <span class="mf">25.0</span> <span class="n">ms</span> <span class="n">bandwidth</span> <span class="mi">10</span> <span class="n">gbit</span> <span class="n">packet</span><span class="o">-</span><span class="n">size</span> <span class="mi">128</span>
</pre></div>
</div>
<p>To simulate network packet drops, add either “packets-per-drop ” or
“drop-fraction [0.0 … 1.0]” parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">nsim</span> <span class="n">delay</span> <span class="mf">25.0</span> <span class="n">ms</span> <span class="n">bandwidth</span> <span class="mi">10</span> <span class="n">gbit</span> <span class="n">packet</span><span class="o">-</span><span class="n">size</span> <span class="mi">128</span> <span class="n">packets</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">drop</span> <span class="mi">10000</span>
</pre></div>
</div>
<p>Remember to configure the layer-2 cross-connect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nsim</span> <span class="n">enable</span><span class="o">-</span><span class="n">disable</span> <span class="o">&lt;</span><span class="n">interface</span><span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">interface</span><span class="o">-</span><span class="mi">2</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="packet-generator-configuration">
<h2>Packet Generator Configuration<a class="headerlink" href="#packet-generator-configuration" title="Permalink to this headline"></a></h2>
<p>Here’s a unit-test configuration for the vpp packet generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">loop</span> <span class="n">cre</span>
<span class="nb">set</span> <span class="nb">int</span> <span class="n">ip</span> <span class="n">address</span> <span class="n">loop0</span> <span class="mf">11.22.33.1</span><span class="o">/</span><span class="mi">24</span>
<span class="nb">set</span> <span class="nb">int</span> <span class="n">state</span> <span class="n">loop0</span> <span class="n">up</span>

<span class="n">loop</span> <span class="n">cre</span>
<span class="nb">set</span> <span class="nb">int</span> <span class="n">ip</span> <span class="n">address</span> <span class="n">loop1</span> <span class="mf">11.22.34.1</span><span class="o">/</span><span class="mi">24</span>
<span class="nb">set</span> <span class="nb">int</span> <span class="n">state</span> <span class="n">loop1</span> <span class="n">up</span>

<span class="nb">set</span> <span class="n">nsim</span> <span class="n">delay</span> <span class="mf">1.0</span> <span class="n">ms</span> <span class="n">bandwidth</span> <span class="mi">10</span> <span class="n">gbit</span> <span class="n">packet</span><span class="o">-</span><span class="n">size</span> <span class="mi">128</span> <span class="n">packets</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">drop</span> <span class="mi">1000</span>
<span class="n">nsim</span> <span class="n">enable</span><span class="o">-</span><span class="n">disable</span> <span class="n">loop0</span> <span class="n">loop1</span>

<span class="n">packet</span><span class="o">-</span><span class="n">generator</span> <span class="n">new</span> <span class="p">{</span>
    <span class="n">name</span> <span class="n">s0</span>
    <span class="n">limit</span> <span class="mi">10000</span>
    <span class="n">size</span> <span class="mi">128</span><span class="o">-</span><span class="mi">128</span>
    <span class="n">interface</span> <span class="n">loop0</span>
    <span class="n">node</span> <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>
    <span class="n">data</span> <span class="p">{</span> <span class="n">IP4</span><span class="p">:</span> <span class="mf">1.2.3</span> <span class="o">-&gt;</span> <span class="mf">4.5.6</span>
           <span class="n">UDP</span><span class="p">:</span> <span class="mf">11.22.33.44</span> <span class="o">-&gt;</span> <span class="mf">11.22.34.44</span>
           <span class="n">UDP</span><span class="p">:</span> <span class="mi">1234</span> <span class="o">-&gt;</span> <span class="mi">2345</span>
           <span class="n">incrementing</span> <span class="mi">114</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For extra realism, the network simulator drops any specific packet with
the specified probability. In this example, we see that slight variation
from run to run occurs as it should.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DBGvpp</span><span class="c1"># pa en</span>
<span class="n">DBGvpp</span><span class="c1"># sh err</span>
   <span class="n">Count</span>                    <span class="n">Node</span>                  <span class="n">Reason</span>
      <span class="mi">9991</span>                  <span class="n">nsim</span>                  <span class="n">Packets</span> <span class="n">buffered</span>
         <span class="mi">9</span>                  <span class="n">nsim</span>                  <span class="n">Network</span> <span class="n">loss</span> <span class="n">simulation</span> <span class="n">drop</span> <span class="n">packets</span>
      <span class="mi">9991</span>             <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>             <span class="n">l3</span> <span class="n">mac</span> <span class="n">mismatch</span>

<span class="n">DBGvpp</span><span class="c1"># clear err</span>
<span class="n">DBGvpp</span><span class="c1"># pa en</span>
<span class="n">DBGvpp</span><span class="c1"># sh err</span>
<span class="n">sh</span> <span class="n">err</span>
   <span class="n">Count</span>                    <span class="n">Node</span>                  <span class="n">Reason</span>
      <span class="mi">9993</span>                  <span class="n">nsim</span>                  <span class="n">Packets</span> <span class="n">buffered</span>
         <span class="mi">7</span>                  <span class="n">nsim</span>                  <span class="n">Network</span> <span class="n">loss</span> <span class="n">simulation</span> <span class="n">drop</span> <span class="n">packets</span>
      <span class="mi">9993</span>             <span class="n">ethernet</span><span class="o">-</span><span class="nb">input</span>             <span class="n">l3</span> <span class="n">mac</span> <span class="n">mismatch</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="acls.html" class="btn btn-neutral float-left" title="Access Control Lists with VPP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="webapp.html" class="btn btn-neutral float-right" title="Web applications with VPP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>