

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>VNET (VPP Network Stack) &mdash; Vector Packet Processor 01 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/rules.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Feature Arcs" href="featurearcs.html" />
    <link rel="prev" title="Plugins" href="plugins.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Vector Packet Processor
          

          
            
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users/index.html">For Users</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">For Developers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="building.html">Building VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="running_vpp.html">Running VPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="gdb_examples.html">GDB Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="add_plugin.html">Adding a plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l3"><a class="reference internal" href="softwarearchitecture.html">Software Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="infrastructure.html">VPPINFRA (Infrastructure)</a></li>
<li class="toctree-l3"><a class="reference internal" href="vlib.html">VLIB (Vector Processing Library)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">VNET (VPP Network Stack)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#effective-graph-dispatch-function-coding">Effective graph dispatch function coding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#single-dual-loops">Single/dual loops</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-packets-from-scratch">Creating Packets from Scratch</a></li>
<li class="toctree-l4"><a class="reference internal" href="#packet-tracer">Packet tracer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#graph-dispatcher-pcap-tracing">Graph Dispatcher Pcap Tracing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="featurearcs.html">Feature Arcs</a></li>
<li class="toctree-l3"><a class="reference internal" href="metadata.html">Buffer Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="metadata.html#buffer-metadata-extensions">Buffer Metadata Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="multiarch/index.html">Multi-architecture support</a></li>
<li class="toctree-l3"><a class="reference internal" href="bihash.html">Bounded-index Extensible Hashing (bihash)</a></li>
<li class="toctree-l3"><a class="reference internal" href="vpp_api_module.html">VPP API module</a></li>
<li class="toctree-l3"><a class="reference internal" href="binary_api_support.html">Binary API Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsystem/index.html">Build System</a></li>
<li class="toctree-l3"><a class="reference internal" href="eventviewer.html">Event-logger</a></li>
<li class="toctree-l3"><a class="reference internal" href="eventviewer.html#g2-graphical-event-viewer">G2 graphical event viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="fib20/index.html">FIB 2.0 Hierarchical, Protocol, Independent</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildwireshark.html">How to build a vpp dispatch trace aware Wireshark</a></li>
<li class="toctree-l3"><a class="reference internal" href="punt.html">Punting Packets</a></li>
<li class="toctree-l3"><a class="reference internal" href="quic_plugin.html">QUIC HostStack</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../writingdocs/index.html">Writing Documents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../links/index.html">VPP Wiki, Doxygen and Other Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../featuresbyrelease/index.html">Features by Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../events/index.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relatedprojects/index.html">Related Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/index.html">Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vector Packet Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Getting Started</a> &raquo;</li>
        
          <li><a href="index.html">For Developers</a> &raquo;</li>
        
      <li>VNET (VPP Network Stack)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/gettingstarted/developers/vnet.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vnet-vpp-network-stack">
<h1>VNET (VPP Network Stack)<a class="headerlink" href="#vnet-vpp-network-stack" title="Permalink to this headline">¶</a></h1>
<p>The files associated with the VPP network stack layer are located in the
<em>./src/vnet</em> folder. The Network Stack Layer is basically an
instantiation of the code in the other layers. This layer has a vnet
library that provides vectorized layer-2 and 3 networking graph nodes, a
packet generator, and a packet tracer.</p>
<p>In terms of building a packet processing application, vnet provides a
platform-independent subgraph to which one connects a couple of
device-driver nodes.</p>
<p>Typical RX connections include “ethernet-input” [full software
classification, feeds ipv4-input, ipv6-input, arp-input etc.] and
“ipv4-input-no-checksum” [if hardware can classify, perform ipv4 header
checksum].</p>
<div class="section" id="effective-graph-dispatch-function-coding">
<h2>Effective graph dispatch function coding<a class="headerlink" href="#effective-graph-dispatch-function-coding" title="Permalink to this headline">¶</a></h2>
<p>Over the 15 years, multiple coding styles have emerged: a
single/dual/quad loop coding model (with variations) and a
fully-pipelined coding model.</p>
</div>
<div class="section" id="single-dual-loops">
<h2>Single/dual loops<a class="headerlink" href="#single-dual-loops" title="Permalink to this headline">¶</a></h2>
<p>The single/dual/quad loop model variations conveniently solve problems
where the number of items to process is not known in advance: typical
hardware RX-ring processing. This coding style is also very effective
when a given node will not need to cover a complex set of dependent
reads.</p>
<p>Here is an quad/single loop which can leverage up-to-avx512 SIMD vector
units to convert buffer indices to buffer pointers:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>   <span class="k">static</span> <span class="n">uword</span>
   <span class="nf">simulated_ethernet_interface_tx</span> <span class="p">(</span><span class="n">vlib_main_t</span> <span class="o">*</span> <span class="n">vm</span><span class="p">,</span>
   				 <span class="n">vlib_node_runtime_t</span> <span class="o">*</span>
   				 <span class="n">node</span><span class="p">,</span> <span class="n">vlib_frame_t</span> <span class="o">*</span> <span class="n">frame</span><span class="p">)</span>
   <span class="p">{</span>
     <span class="n">u32</span> <span class="n">n_left_from</span><span class="p">,</span> <span class="o">*</span><span class="n">from</span><span class="p">;</span>
     <span class="n">u32</span> <span class="n">next_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="n">u32</span> <span class="n">n_bytes</span><span class="p">;</span>
     <span class="n">u32</span> <span class="n">thread_index</span> <span class="o">=</span> <span class="n">vm</span><span class="o">-&gt;</span><span class="n">thread_index</span><span class="p">;</span>
     <span class="n">vnet_main_t</span> <span class="o">*</span><span class="n">vnm</span> <span class="o">=</span> <span class="n">vnet_get_main</span> <span class="p">();</span>
     <span class="n">vnet_interface_main_t</span> <span class="o">*</span><span class="n">im</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">vnm</span><span class="o">-&gt;</span><span class="n">interface_main</span><span class="p">;</span>
     <span class="n">vlib_buffer_t</span> <span class="o">*</span><span class="n">bufs</span><span class="p">[</span><span class="n">VLIB_FRAME_SIZE</span><span class="p">],</span> <span class="o">**</span><span class="n">b</span><span class="p">;</span>
     <span class="n">u16</span> <span class="n">nexts</span><span class="p">[</span><span class="n">VLIB_FRAME_SIZE</span><span class="p">],</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>

     <span class="n">n_left_from</span> <span class="o">=</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">n_vectors</span><span class="p">;</span>
     <span class="n">from</span> <span class="o">=</span> <span class="n">vlib_frame_vector_args</span> <span class="p">(</span><span class="n">frame</span><span class="p">);</span>

     <span class="cm">/*</span>
<span class="cm">      * Convert up to VLIB_FRAME_SIZE indices in &quot;from&quot; to</span>
<span class="cm">      * buffer pointers in bufs[]</span>
<span class="cm">      */</span>
     <span class="n">vlib_get_buffers</span> <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">bufs</span><span class="p">,</span> <span class="n">n_left_from</span><span class="p">);</span>
     <span class="n">b</span> <span class="o">=</span> <span class="n">bufs</span><span class="p">;</span>
     <span class="n">next</span> <span class="o">=</span> <span class="n">nexts</span><span class="p">;</span>

     <span class="cm">/*</span>
<span class="cm">      * While we have at least 4 vector elements (pkts) to process..</span>
<span class="cm">      */</span>
     <span class="k">while</span> <span class="p">(</span><span class="n">n_left_from</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span>
       <span class="p">{</span>
         <span class="cm">/* Prefetch next quad-loop iteration. */</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">PREDICT_TRUE</span> <span class="p">(</span><span class="n">n_left_from</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">))</span>
   	   <span class="p">{</span>
   	     <span class="n">vlib_prefetch_buffer_header</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">STORE</span><span class="p">);</span>
   	     <span class="n">vlib_prefetch_buffer_header</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">STORE</span><span class="p">);</span>
   	     <span class="n">vlib_prefetch_buffer_header</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">STORE</span><span class="p">);</span>
   	     <span class="n">vlib_prefetch_buffer_header</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">STORE</span><span class="p">);</span>
           <span class="p">}</span>

         <span class="cm">/*</span>
<span class="cm">          * $$$ Process 4x packets right here...</span>
<span class="cm">          * set next[0..3] to send the packets where they need to go</span>
<span class="cm">          */</span>

          <span class="n">do_something_to</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
          <span class="n">do_something_to</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
          <span class="n">do_something_to</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
          <span class="n">do_something_to</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

         <span class="cm">/* Process the next 0..4 packets */</span>
   	 <span class="n">b</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
   	 <span class="n">next</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
   	 <span class="n">n_left_from</span> <span class="o">-=</span> <span class="mi">4</span><span class="p">;</span>
   	<span class="p">}</span>
     <span class="cm">/*</span>
<span class="cm">      * Clean up 0...3 remaining packets at the end of the incoming frame</span>
<span class="cm">      */</span>
     <span class="k">while</span> <span class="p">(</span><span class="n">n_left_from</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
       <span class="p">{</span>
         <span class="cm">/*</span>
<span class="cm">          * $$$ Process one packet right here...</span>
<span class="cm">          * set next[0..3] to send the packets where they need to go</span>
<span class="cm">          */</span>
          <span class="n">do_something_to</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

         <span class="cm">/* Process the next packet */</span>
         <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="n">next</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="n">n_left_from</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="p">}</span>

     <span class="cm">/*</span>
<span class="cm">      * Send the packets along their respective next-node graph arcs</span>
<span class="cm">      * Considerable locality of reference is expected, most if not all</span>
<span class="cm">      * packets in the inbound vector will traverse the same next-node</span>
<span class="cm">      * arc</span>
<span class="cm">      */</span>
     <span class="n">vlib_buffer_enqueue_to_next</span> <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">nexts</span><span class="p">,</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">n_vectors</span><span class="p">);</span>

     <span class="k">return</span> <span class="n">frame</span><span class="o">-&gt;</span><span class="n">n_vectors</span><span class="p">;</span>
   <span class="p">}</span>
</pre></div>
</div>
<p>Given a packet processing task to implement, it pays to scout around
looking for similar tasks, and think about using the same coding
pattern. It is not uncommon to recode a given graph node dispatch function
several times during performance optimization.</p>
</div>
<div class="section" id="creating-packets-from-scratch">
<h2>Creating Packets from Scratch<a class="headerlink" href="#creating-packets-from-scratch" title="Permalink to this headline">¶</a></h2>
<p>At times, it’s necessary to create packets from scratch and send
them. Tasks like sending keepalives or actively opening connections
come to mind. Its not difficult, but accurate buffer metadata setup is
required.</p>
<div class="section" id="allocating-buffers">
<h3>Allocating Buffers<a class="headerlink" href="#allocating-buffers" title="Permalink to this headline">¶</a></h3>
<p>Use vlib_buffer_alloc, which allocates a set of buffer indices. For
low-performance applications, it’s OK to allocate one buffer at a
time. Note that vlib_buffer_alloc(…) does NOT initialize buffer
metadata. See below.</p>
<p>In high-performance cases, allocate a vector of buffer indices,
and hand them out from the end of the vector; decrement _vec_len(..)
as buffer indices are allocated. See tcp_alloc_tx_buffers(…) and
tcp_get_free_buffer_index(…) for an example.</p>
</div>
<div class="section" id="buffer-initialization-example">
<h3>Buffer Initialization Example<a class="headerlink" href="#buffer-initialization-example" title="Permalink to this headline">¶</a></h3>
<p>The following example shows the <strong>main points</strong>, but is not to be
blindly cut-‘n-pasted.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>  <span class="n">u32</span> <span class="n">bi0</span><span class="p">;</span>
  <span class="n">vlib_buffer_t</span> <span class="o">*</span><span class="n">b0</span><span class="p">;</span>
  <span class="n">ip4_header_t</span> <span class="o">*</span><span class="n">ip</span><span class="p">;</span>
  <span class="n">udp_header_t</span> <span class="o">*</span><span class="n">udp</span><span class="p">;</span>

  <span class="cm">/* Allocate a buffer */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">vlib_buffer_alloc</span> <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bi0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="n">b0</span> <span class="o">=</span> <span class="n">vlib_get_buffer</span> <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">bi0</span><span class="p">);</span>

  <span class="cm">/* Initialize the buffer */</span>
  <span class="n">VLIB_BUFFER_TRACE_TRAJECTORY_INIT</span> <span class="p">(</span><span class="n">b0</span><span class="p">);</span>

  <span class="cm">/* At this point b0-&gt;current_data = 0, b0-&gt;current_length = 0 */</span>

  <span class="cm">/*</span>
<span class="cm">   * Copy data into the buffer. This example ASSUMES that data will fit</span>
<span class="cm">   * in a single buffer, and is e.g. an ip4 packet.</span>
<span class="cm">   */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">have_packet_rewrite</span><span class="p">)</span>
     <span class="p">{</span>
       <span class="n">clib_memcpy</span> <span class="p">(</span><span class="n">b0</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">vec_len</span> <span class="p">(</span><span class="n">data</span><span class="p">));</span>
       <span class="n">b0</span><span class="o">-&gt;</span><span class="n">current_length</span> <span class="o">=</span> <span class="n">vec_len</span> <span class="p">(</span><span class="n">data</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="k">else</span>
     <span class="p">{</span>
       <span class="cm">/* OR, build a udp-ip packet (for example) */</span>
       <span class="n">ip</span> <span class="o">=</span> <span class="n">vlib_buffer_get_current</span> <span class="p">(</span><span class="n">b0</span><span class="p">);</span>
       <span class="n">udp</span> <span class="o">=</span> <span class="p">(</span><span class="n">udp_header_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
       <span class="n">data_dst</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">udp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

       <span class="n">ip</span><span class="o">-&gt;</span><span class="n">ip_version_and_header_length</span> <span class="o">=</span> <span class="mh">0x45</span><span class="p">;</span>
       <span class="n">ip</span><span class="o">-&gt;</span><span class="n">ttl</span> <span class="o">=</span> <span class="mi">254</span><span class="p">;</span>
       <span class="n">ip</span><span class="o">-&gt;</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">IP_PROTOCOL_UDP</span><span class="p">;</span>
       <span class="n">ip</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="n">clib_host_to_net_u16</span> <span class="p">(</span><span class="k">sizeof</span> <span class="p">(</span><span class="o">*</span><span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span> <span class="p">(</span><span class="o">*</span><span class="n">udp</span><span class="p">)</span> <span class="o">+</span>
                  <span class="n">vec_len</span><span class="p">(</span><span class="n">udp_data</span><span class="p">));</span>
       <span class="n">ip</span><span class="o">-&gt;</span><span class="n">src_address</span><span class="p">.</span><span class="n">as_u32</span> <span class="o">=</span> <span class="n">src_address</span><span class="o">-&gt;</span><span class="n">as_u32</span><span class="p">;</span>
       <span class="n">ip</span><span class="o">-&gt;</span><span class="n">dst_address</span><span class="p">.</span><span class="n">as_u32</span> <span class="o">=</span> <span class="n">dst_address</span><span class="o">-&gt;</span><span class="n">as_u32</span><span class="p">;</span>
       <span class="n">udp</span><span class="o">-&gt;</span><span class="n">src_port</span> <span class="o">=</span> <span class="n">clib_host_to_net_u16</span> <span class="p">(</span><span class="n">src_port</span><span class="p">);</span>
       <span class="n">udp</span><span class="o">-&gt;</span><span class="n">dst_port</span> <span class="o">=</span> <span class="n">clib_host_to_net_u16</span> <span class="p">(</span><span class="n">dst_port</span><span class="p">);</span>
       <span class="n">udp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="n">clib_host_to_net_u16</span> <span class="p">(</span><span class="n">vec_len</span> <span class="p">(</span><span class="n">udp_data</span><span class="p">));</span>
       <span class="n">clib_memcpy</span> <span class="p">(</span><span class="n">data_dst</span><span class="p">,</span> <span class="n">udp_data</span><span class="p">,</span> <span class="n">vec_len</span><span class="p">(</span><span class="n">udp_data</span><span class="p">));</span>

       <span class="k">if</span> <span class="p">(</span><span class="n">compute_udp_checksum</span><span class="p">)</span>
         <span class="p">{</span>
           <span class="cm">/* RFC 7011 section 10.3.2. */</span>
           <span class="n">udp</span><span class="o">-&gt;</span><span class="n">checksum</span> <span class="o">=</span> <span class="n">ip4_tcp_udp_compute_checksum</span> <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">ip</span><span class="p">);</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">udp</span><span class="o">-&gt;</span><span class="n">checksum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
             <span class="n">udp</span><span class="o">-&gt;</span><span class="n">checksum</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">b0</span><span class="o">-&gt;</span><span class="n">current_length</span> <span class="o">=</span> <span class="n">vec_len</span> <span class="p">(</span><span class="k">sizeof</span> <span class="p">(</span><span class="o">*</span><span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span> <span class="p">(</span><span class="o">*</span><span class="n">udp</span><span class="p">)</span> <span class="o">+</span>
                                   <span class="n">vec_len</span> <span class="p">(</span><span class="n">udp_data</span><span class="p">));</span>

    <span class="p">}</span>
  <span class="n">b0</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">VLIB_BUFFER_TOTAL_LENGTH_VALID</span><span class="p">;</span>

  <span class="cm">/* sw_if_index 0 is the &quot;local&quot; interface, which always exists */</span>
  <span class="n">vnet_buffer</span> <span class="p">(</span><span class="n">b0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sw_if_index</span><span class="p">[</span><span class="n">VLIB_RX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/* Use the default FIB index for tx lookup. Set non-zero to use another fib */</span>
  <span class="n">vnet_buffer</span> <span class="p">(</span><span class="n">b0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sw_if_index</span><span class="p">[</span><span class="n">VLIB_TX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>If your use-case calls for large packet transmission, use
vlib_buffer_chain_append_data_with_alloc(…) to create the requisite
buffer chain.</p>
</div>
<div class="section" id="enqueueing-packets-for-lookup-and-transmission">
<h3>Enqueueing packets for lookup and transmission<a class="headerlink" href="#enqueueing-packets-for-lookup-and-transmission" title="Permalink to this headline">¶</a></h3>
<p>The simplest way to send a set of packets is to use
vlib_get_frame_to_node(…) to allocate fresh frame(s) to
ip4_lookup_node or ip6_lookup_node, add the constructed buffer
indices, and dispatch the frame using vlib_put_frame_to_node(…).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>    <span class="n">vlib_frame_t</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">vlib_get_frame_to_node</span> <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">ip4_lookup_node</span><span class="p">.</span><span class="n">index</span><span class="p">);</span>
    <span class="n">f</span><span class="o">-&gt;</span><span class="n">n_vectors</span> <span class="o">=</span> <span class="n">vec_len</span><span class="p">(</span><span class="n">buffer_indices_to_send</span><span class="p">);</span>
    <span class="n">to_next</span> <span class="o">=</span> <span class="n">vlib_frame_vector_args</span> <span class="p">(</span><span class="n">f</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vec_len</span> <span class="p">(</span><span class="n">buffer_indices_to_send</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="n">to_next</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">buffer_indices_to_send</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="n">vlib_put_frame_to_node</span> <span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="n">ip4_lookup_node_index</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
</pre></div>
</div>
<p>It is inefficient to allocate and schedule single packet frames.
That’s typical in case you need to send one packet per second, but
should <strong>not</strong> occur in a for-loop!</p>
</div>
</div>
<div class="section" id="packet-tracer">
<h2>Packet tracer<a class="headerlink" href="#packet-tracer" title="Permalink to this headline">¶</a></h2>
<p>Vlib includes a frame element [packet] trace facility, with a simple
debug CLI interface. The cli is straightforward: “trace add
input-node-name count” to start capturing packet traces.</p>
<p>To trace 100 packets on a typical x86_64 system running the dpdk
plugin: “trace add dpdk-input 100”. When using the packet generator:
“trace add pg-input 100”</p>
<p>To display the packet trace: “show trace”</p>
<p>Each graph node has the opportunity to capture its own trace data. It is
almost always a good idea to do so. The trace capture APIs are simple.</p>
<p>The packet capture APIs snapshoot binary data, to minimize processing at
capture time. Each participating graph node initialization provides a
vppinfra format-style user function to pretty-print data when required
by the VLIB “show trace” command.</p>
<p>Set the VLIB node registration “.format_trace” member to the name of
the per-graph node format function.</p>
<p>Here’s a simple example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>    <span class="n">u8</span> <span class="o">*</span> <span class="nf">my_node_format_trace</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">va_list</span> <span class="o">*</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">vlib_main_t</span> <span class="o">*</span> <span class="n">vm</span> <span class="o">=</span> <span class="n">va_arg</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">vlib_main_t</span> <span class="o">*</span><span class="p">);</span>
        <span class="n">vlib_node_t</span> <span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">va_arg</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">vlib_node_t</span> <span class="o">*</span><span class="p">);</span>
        <span class="n">my_node_trace_t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">=</span> <span class="n">va_arg</span> <span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">my_trace_t</span> <span class="o">*</span><span class="p">);</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">format</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;My trace data was: %d&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">-&gt;&lt;</span><span class="n">whatever</span><span class="o">&gt;</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>The trace framework hands the per-node format function the data it
captured as the packet whizzed by. The format function pretty-prints the
data as desired.</p>
</div>
<div class="section" id="graph-dispatcher-pcap-tracing">
<h2>Graph Dispatcher Pcap Tracing<a class="headerlink" href="#graph-dispatcher-pcap-tracing" title="Permalink to this headline">¶</a></h2>
<p>The vpp graph dispatcher knows how to capture vectors of packets in pcap
format as they’re dispatched. The pcap captures are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">VPP</span> <span class="n">graph</span> <span class="n">dispatch</span> <span class="n">trace</span> <span class="n">record</span> <span class="n">description</span><span class="p">:</span>

        <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
        <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
       <span class="o">|</span> <span class="n">Major</span> <span class="n">Version</span> <span class="o">|</span> <span class="n">Minor</span> <span class="n">Version</span> <span class="o">|</span> <span class="n">NStrings</span>      <span class="o">|</span> <span class="n">ProtoHint</span>     <span class="o">|</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
       <span class="o">|</span> <span class="n">Buffer</span> <span class="n">index</span> <span class="p">(</span><span class="n">big</span> <span class="n">endian</span><span class="p">)</span>                                     <span class="o">|</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
       <span class="o">+</span> <span class="n">VPP</span> <span class="n">graph</span> <span class="n">node</span> <span class="n">name</span> <span class="o">...</span>     <span class="o">...</span>               <span class="o">|</span> <span class="n">NULL</span> <span class="n">octet</span>    <span class="o">|</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
       <span class="o">|</span> <span class="n">Buffer</span> <span class="n">Metadata</span> <span class="o">...</span> <span class="o">...</span>                       <span class="o">|</span> <span class="n">NULL</span> <span class="n">octet</span>    <span class="o">|</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
       <span class="o">|</span> <span class="n">Buffer</span> <span class="n">Opaque</span> <span class="o">...</span> <span class="o">...</span>                         <span class="o">|</span> <span class="n">NULL</span> <span class="n">octet</span>    <span class="o">|</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
       <span class="o">|</span> <span class="n">Buffer</span> <span class="n">Opaque</span> <span class="mi">2</span> <span class="o">...</span> <span class="o">...</span>                       <span class="o">|</span> <span class="n">NULL</span> <span class="n">octet</span>    <span class="o">|</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
       <span class="o">|</span> <span class="n">VPP</span> <span class="n">ASCII</span> <span class="n">packet</span> <span class="n">trace</span> <span class="p">(</span><span class="k">if</span> <span class="n">NStrings</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>      <span class="o">|</span> <span class="n">NULL</span> <span class="n">octet</span>    <span class="o">|</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
       <span class="o">|</span> <span class="n">Packet</span> <span class="n">data</span> <span class="p">(</span><span class="n">up</span> <span class="n">to</span> <span class="mi">16</span><span class="n">K</span><span class="p">)</span>                                       <span class="o">|</span>
       <span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<p>Graph dispatch records comprise a version stamp, an indication of how
many NULL-terminated strings will follow the record header and preceed
packet data, and a protocol hint.</p>
<p>The buffer index is an opaque 32-bit cookie which allows consumers of
these data to easily filter/track single packets as they traverse the
forwarding graph.</p>
<p>Multiple records per packet are normal, and to be expected. Packets
will appear multipe times as they traverse the vpp forwarding
graph. In this way, vpp graph dispatch traces are significantly
different from regular network packet captures from an end-station.
This property complicates stateful packet analysis.</p>
<p>Restricting stateful analysis to records from a single vpp graph node
such as “ethernet-input” seems likely to improve the situation.</p>
<p>As of this writing: major version = 1, minor version = 0. Nstrings
SHOULD be 4 or 5. Consumers SHOULD be wary values less than 4 or
greater than 5. They MAY attempt to display the claimed number of
strings, or they MAY treat the condition as an error.</p>
<p>Here is the current set of protocol hints:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>    <span class="k">typedef</span> <span class="k">enum</span>
      <span class="p">{</span>
        <span class="n">VLIB_NODE_PROTO_HINT_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">VLIB_NODE_PROTO_HINT_ETHERNET</span><span class="p">,</span>
        <span class="n">VLIB_NODE_PROTO_HINT_IP4</span><span class="p">,</span>
        <span class="n">VLIB_NODE_PROTO_HINT_IP6</span><span class="p">,</span>
        <span class="n">VLIB_NODE_PROTO_HINT_TCP</span><span class="p">,</span>
        <span class="n">VLIB_NODE_PROTO_HINT_UDP</span><span class="p">,</span>
        <span class="n">VLIB_NODE_N_PROTO_HINTS</span><span class="p">,</span>
      <span class="p">}</span> <span class="n">vlib_node_proto_hint_t</span><span class="p">;</span>
</pre></div>
</div>
<p>Example: VLIB_NODE_PROTO_HINT_IP6 means that the first octet of packet
data SHOULD be 0x60, and should begin an ipv6 packet header.</p>
<p>Downstream consumers of these data SHOULD pay attention to the
protocol hint. They MUST tolerate inaccurate hints, which MAY occur
from time to time.</p>
<div class="section" id="dispatch-pcap-trace-debug-cli">
<h3>Dispatch Pcap Trace Debug CLI<a class="headerlink" href="#dispatch-pcap-trace-debug-cli" title="Permalink to this headline">¶</a></h3>
<p>To start a dispatch trace capture of up to 10,000 trace records:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">pcap</span> <span class="n">dispatch</span> <span class="n">trace</span> <span class="n">on</span> <span class="nb">max</span> <span class="mi">10000</span> <span class="n">file</span> <span class="n">dispatch</span><span class="o">.</span><span class="n">pcap</span>
</pre></div>
</div>
<p>To start a dispatch trace which will also include standard vpp packet
tracing for packets which originate in dpdk-input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">pcap</span> <span class="n">dispatch</span> <span class="n">trace</span> <span class="n">on</span> <span class="nb">max</span> <span class="mi">10000</span> <span class="n">file</span> <span class="n">dispatch</span><span class="o">.</span><span class="n">pcap</span> <span class="n">buffer</span><span class="o">-</span><span class="n">trace</span> <span class="n">dpdk</span><span class="o">-</span><span class="nb">input</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>To save the pcap trace, e.g. in /tmp/dispatch.pcap:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">pcap</span> <span class="n">dispatch</span> <span class="n">trace</span> <span class="n">off</span>
</pre></div>
</div>
</div>
<div class="section" id="wireshark-dissection-of-dispatch-pcap-traces">
<h3>Wireshark dissection of dispatch pcap traces<a class="headerlink" href="#wireshark-dissection-of-dispatch-pcap-traces" title="Permalink to this headline">¶</a></h3>
<p>It almost goes without saying that we built a companion wireshark
dissector to display these traces. As of this writing, we have
upstreamed the wireshark dissector.</p>
<p>Since it will be a while before wireshark/master/latest makes it into
all of the popular Linux distros, please see the “How to build a vpp
dispatch trace aware Wireshark” page for build info.</p>
<p>Here is a sample packet dissection, with some fields omitted for
clarity.  The point is that the wireshark dissector accurately
displays <strong>all</strong> of the vpp buffer metadata, and the name of the graph
node in question.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    Frame 1: 2216 bytes on wire (17728 bits), 2216 bytes captured (17728 bits)
        Encapsulation type: USER 13 (58)
        [Protocols in frame: vpp:vpp-metadata:vpp-opaque:vpp-opaque2:eth:ethertype:ip:tcp:data]
    VPP Dispatch Trace
        BufferIndex: 0x00036663
    NodeName: ethernet-input
    VPP Buffer Metadata
        Metadata: flags:
        Metadata: current_data: 0, current_length: 102
        Metadata: current_config_index: 0, flow_id: 0, next_buffer: 0
        Metadata: error: 0, n_add_refs: 0, buffer_pool_index: 0
        Metadata: trace_index: 0, recycle_count: 0, len_not_first_buf: 0
        Metadata: free_list_index: 0
        Metadata:
    VPP Buffer Opaque
        Opaque: raw: 00000007 ffffffff 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
        Opaque: sw_if_index[VLIB_RX]: 7, sw_if_index[VLIB_TX]: -1
        Opaque: L2 offset 0, L3 offset 0, L4 offset 0, feature arc index 0
        Opaque: ip.adj_index[VLIB_RX]: 0, ip.adj_index[VLIB_TX]: 0
        Opaque: ip.flow_hash: 0x0, ip.save_protocol: 0x0, ip.fib_index: 0
        Opaque: ip.save_rewrite_length: 0, ip.rpf_id: 0
        Opaque: ip.icmp.type: 0 ip.icmp.code: 0, ip.icmp.data: 0x0
        Opaque: ip.reass.next_index: 0, ip.reass.estimated_mtu: 0
        Opaque: ip.reass.fragment_first: 0 ip.reass.fragment_last: 0
        Opaque: ip.reass.range_first: 0 ip.reass.range_last: 0
        Opaque: ip.reass.next_range_bi: 0x0, ip.reass.ip6_frag_hdr_offset: 0
        Opaque: mpls.ttl: 0, mpls.exp: 0, mpls.first: 0, mpls.save_rewrite_length: 0, mpls.bier.n_bytes: 0
        Opaque: l2.feature_bitmap: 00000000, l2.bd_index: 0, l2.l2_len: 0, l2.shg: 0, l2.l2fib_sn: 0, l2.bd_age: 0
        Opaque: l2.feature_bitmap_input:   none configured, L2.feature_bitmap_output:   none configured
        Opaque: l2t.next_index: 0, l2t.session_index: 0
        Opaque: l2_classify.table_index: 0, l2_classify.opaque_index: 0, l2_classify.hash: 0x0
        Opaque: policer.index: 0
        Opaque: ipsec.flags: 0x0, ipsec.sad_index: 0
        Opaque: map.mtu: 0
        Opaque: map_t.v6.saddr: 0x0, map_t.v6.daddr: 0x0, map_t.v6.frag_offset: 0, map_t.v6.l4_offset: 0
        Opaque: map_t.v6.l4_protocol: 0, map_t.checksum_offset: 0, map_t.mtu: 0
        Opaque: ip_frag.mtu: 0, ip_frag.next_index: 0, ip_frag.flags: 0x0
        Opaque: cop.current_config_index: 0
        Opaque: lisp.overlay_afi: 0
        Opaque: tcp.connection_index: 0, tcp.seq_number: 0, tcp.seq_end: 0, tcp.ack_number: 0, tcp.hdr_offset: 0, tcp.data_offset: 0
        Opaque: tcp.data_len: 0, tcp.flags: 0x0
        Opaque: sctp.connection_index: 0, sctp.sid: 0, sctp.ssn: 0, sctp.tsn: 0, sctp.hdr_offset: 0
        Opaque: sctp.data_offset: 0, sctp.data_len: 0, sctp.subconn_idx: 0, sctp.flags: 0x0
        Opaque: snat.flags: 0x0
        Opaque:
    VPP Buffer Opaque2
        Opaque2: raw: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
        Opaque2: qos.bits: 0, qos.source: 0
        Opaque2: loop_counter: 0
        Opaque2: gbp.flags: 0, gbp.src_epg: 0
        Opaque2: pg_replay_timestamp: 0
        Opaque2:
    Ethernet II, Src: 06:d6:01:41:3b:92 (06:d6:01:41:3b:92), Dst: IntelCor_3d:f6    Transmission Control Protocol, Src Port: 22432, Dst Port: 54084, Seq: 1, Ack: 1, Len: 36
        Source Port: 22432
        Destination Port: 54084
        TCP payload (36 bytes)
    Data (36 bytes)

    0000  cf aa 8b f5 53 14 d4 c7 29 75 3e 56 63 93 9d 11   ....S...)u&gt;Vc...
    0010  e5 f2 92 27 86 56 4c 21 ce c5 23 46 d7 eb ec 0d   ...&#39;.VL!..#F....
    0020  a8 98 36 5a                                       ..6Z
        Data: cfaa8bf55314d4c729753e5663939d11e5f2922786564c21…
        [Length: 36]
</pre></div>
</div>
<p>It’s a matter of a couple of mouse-clicks in Wireshark to filter the
trace to a specific buffer index. With that specific kind of filtration,
one can watch a packet walk through the forwarding graph; noting any/all
metadata changes, header checksum changes, and so forth.</p>
<p>This should be of significant value when developing new vpp graph
nodes. If new code mispositions b-&gt;current_data, it will be completely
obvious from looking at the dispatch trace in wireshark.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="featurearcs.html" class="btn btn-neutral float-right" title="Feature Arcs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plugins.html" class="btn btn-neutral float-left" title="Plugins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Linux Foundation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>