<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VPP API Language &mdash; The Vector Packet Processor v22.02-rc0-128-g4450b03ba
 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rules.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Writing API handlers" href="writing_api_handlers.html" />
    <link rel="prev" title="VPP API module" href="vpp_api_module.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> The Vector Packet Processor
            <img src="../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v22.02-rc0-128-g4450b03ba

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About VPP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/scalar-vs-vector-packet-processing.html">Scalar vs Vector packet processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/extensible.html">The Packet Processing Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/networkstack.html">Network Stack Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/hoststack.html">Host Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/developer.html">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/supported.html">Supported archs and OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/releasenotes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutvpp/featurelist.html">VPP Supported Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use Cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/containers/index.html">VPP with Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/simpleperf/index.html">VPP with Iperf3 and TRex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vppcloud/index.html">VPP in the Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vhost/index.html">VPP with Virtual Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/vmxnet3.html">VPP with VMware/Vmxnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/home_gateway.html">VPP as a Home Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/acls.html">Access Control Lists with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/networksim.html">Generating traffic with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/webapp.html">Web applications with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/container_test.html">Simulating networks with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/trafficgen.html">Stateless Traffic Gen with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/ikev2/index.html">IKEv2 with VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/contiv/index.html">VPP in kubernetes (Contiv/Deprecated)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/installing/index.html">Downloading and Installing VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/running/index.html">Running VPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/progressivevpp/index.html">Progressive VPP Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer/build-run-debug/index.html">Build, Run &amp; Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/corearchitecture/index.html">Core Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/corefeatures/index.html">Core Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/plugindoc/index.html">Adding a new plugin or feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/devicedrivers/index.html">Device drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/tests/overview.html">VPP Test Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/extras/index.html">VPP extra tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interfacing with VPP</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The binary API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="vpp_api_module.html">VPP API module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">VPP API Language</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#language-definition">Language definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#defining-a-messages">Defining a messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options">Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-new-types">Defining new types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#importing-definitions">Importing Definitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comments">Comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#services">Services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#types">Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#scalar-value-types">Scalar Value Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-defined-types">User Defined Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#new-explicit-types">New explicit types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#language-generators">Language generators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#future-considerations">Future considerations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="writing_api_handlers.html">Writing API handlers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../c/index.html">C api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/index.html">C++ api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../go/index.html">Go api (govpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust api client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libmemif/index.html">Memif library (libmemif)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/gitreview.html">Getting a Patch Reviewed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/writingdocs.html">Writing VPP Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/reportingissues/index.html">Reporting Bugs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debug CLI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/gettingstarted/index.html">Getting Started with the debug CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/interface/index.html">Interface Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli-reference/index.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration file</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/config_getting_started.html">Getting started with the configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/reference.html">Configuration Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Vector Packet Processor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">The binary API</a> &raquo;</li>
      <li>VPP API Language</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/interfacing/binapi/vpp_api_language.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vpp-api-language">
<h1>VPP API Language<a class="headerlink" href="#vpp-api-language" title="Permalink to this headline"></a></h1>
<p>The VPP binary API is a message passing API. The VPP API language is
used to define a RPC interface between VPP and its control plane. The
API messages supports shared memory transport and Unix domain sockets
(SOCK_STREAM).</p>
<p>The wire format is essentially that of a network formatted (big-endian)
packed C struct.</p>
<p>The VPP API compiler is located in <em>src/tools/vppapigen</em> and can
currently compile to JSON or C (used by the VPP binary itself).</p>
<section id="language-definition">
<h2>Language definition<a class="headerlink" href="#language-definition" title="Permalink to this headline"></a></h2>
<section id="defining-a-messages">
<h3>Defining a messages<a class="headerlink" href="#defining-a-messages" title="Permalink to this headline"></a></h3>
<p>There are 3 types of message exchanges:</p>
<ul class="simple">
<li><p>Request/Reply The client sends a request message and the server
replies with a single reply message. The convention is that the reply
message is named as method_name + _reply.</p></li>
<li><p>Dump/Detail The client sends a “bulk” request message to the server,
and the server replies with a set of detail messages. These messages
may be of different type. A dump/detail call must be enclosed in a
control ping block (Otherwise the client will not know the end of the
bulk transmission). The method name must end with method + “_dump”,
the reply message should be named method + “_details”. The exception
here is for the methods that return multiple message types
(e.g. sw_interface_dump). The Dump/Detail methods are typically used
for acquiring bulk information, like the complete FIB table.</p></li>
<li><p>Events The client can register for getting asynchronous notifications
from the server. This is useful for getting interface state changes,
and so on. The method name for requesting notifications is
conventionally prefixed with “want_”. E.g. “want_interface_events”.
Which notification types results from an event registration is
defined in the service definition.</p></li>
</ul>
<p>A message from a client must include the ‘client_index’, an opaque
cookie identifying the sender, and a ‘context’ field to let the client
match request with reply.</p>
<p>An example of a message definition. The client sends the show_version
request, the server replies with the show_version_reply.</p>
<p>The <em>client_index</em> and <em>context</em> fields are required in all requests.
The <em>context</em> is returned by the server and is used by the client to
match up request and reply messages.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">define</span><span class="w"> </span><span class="n">show_version</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">u32</span><span class="w"> </span><span class="n">client_index</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">u32</span><span class="w"> </span><span class="n">context</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="n">define</span><span class="w"> </span><span class="n">show_version_reply</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">u32</span><span class="w"> </span><span class="n">context</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">i32</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">string</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="p">[</span><span class="mi">32</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="n">string</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">[</span><span class="mi">32</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="n">string</span><span class="w"> </span><span class="n">build_date</span><span class="w"> </span><span class="p">[</span><span class="mi">32</span><span class="p">];</span><span class="w"></span>
<span class="w">  </span><span class="cm">/* The final field can be a variable length argument */</span><span class="w"></span>
<span class="w">  </span><span class="n">string</span><span class="w"> </span><span class="n">build_directory</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>The flags are not used by the clients, but have special meaning for some
of the tracing and debugging of the API. The <em>autoreply</em> flag is a
shorthand for a reply message with just a <em>retval</em> field.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">define</span> <span class="p">:</span><span class="w"> </span><span class="n">DEFINE</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="w"> </span><span class="n">block_statements_opt</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="nl">define</span> <span class="p">:</span><span class="w"> </span><span class="n">flist</span><span class="w"> </span><span class="n">DEFINE</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="w"> </span><span class="n">block_statements_opt</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="nl">flist</span> <span class="p">:</span><span class="w"> </span><span class="n">flag</span><span class="w"></span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">flist</span><span class="w"> </span><span class="n">flag</span><span class="w"></span>
<span class="nl">flag</span> <span class="p">:</span><span class="w"> </span><span class="n">MANUAL_PRINT</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">MANUAL_ENDIAN</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">DONT_TRACE</span><span class="w"></span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">AUTOREPLY</span><span class="w"></span>

<span class="nl">block_statements_opt</span> <span class="p">:</span><span class="w"> </span><span class="n">block_statements</span><span class="w"></span>
<span class="nl">block_statements</span> <span class="p">:</span><span class="w"> </span><span class="n">block_statement</span><span class="w"></span>
<span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="n">block_statements</span><span class="w"> </span><span class="n">block_statement</span><span class="w"></span>
<span class="nl">block_statement</span> <span class="p">:</span><span class="w"> </span><span class="n">declaration</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">option</span><span class="w"></span>
<span class="nl">declaration</span> <span class="p">:</span><span class="w"> </span><span class="n">type_specifier</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">type_specifier</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;[&#39;</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;=&#39;</span><span class="w"> </span><span class="n">assignee</span><span class="w"> </span><span class="sc">&#39;]&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="nl">declaration</span> <span class="p">:</span><span class="w"> </span><span class="n">type_specifier</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;[&#39;</span><span class="w"> </span><span class="n">NUM</span><span class="w"> </span><span class="sc">&#39;]&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">type_specifier</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;[&#39;</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;]&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="nl">type_specifier</span> <span class="p">:</span><span class="w"> </span><span class="n">U8</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">U16</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">U32</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">U64</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">I8</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">I16</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">I32</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">I64</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">F64</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">BOOL</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">STRING</span><span class="w"></span>
<span class="nl">type_specifier</span> <span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="options">
<h3>Options<a class="headerlink" href="#options" title="Permalink to this headline"></a></h3>
<p>The <em>option</em> word is used to specify meta information. The only current
use is to specify a semantic version of the .api file itself.</p>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">option</span> <span class="p">:</span><span class="w"> </span><span class="n">OPTION</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;=&#39;</span><span class="w"> </span><span class="n">assignee</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="nl">assignee</span> <span class="p">:</span><span class="w"> </span><span class="n">NUM</span><span class="w"></span>
<span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">TRUE</span><span class="w"></span>
<span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">FALSE</span><span class="w"></span>
<span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">STRING_LITERAL</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="defining-new-types">
<h3>Defining new types<a class="headerlink" href="#defining-new-types" title="Permalink to this headline"></a></h3>
<p>New user defined types are defined just like messages. A typedef has two
forms. It can either define an alias for a different type (or array).</p>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="n">u8</span><span class="w"> </span><span class="n">ip4_address</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="n">u8</span><span class="w"> </span><span class="n">ip6_address</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>Where the above defines two new types <em>vl_api_ip4_address_t</em> and
<em>vl_api_ip6_address_t</em>. These are aliases for the underlying u8 array.</p>
<p>In the other form, it is used to specify an abstract data type.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">address_family</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ADDRESS_IP4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">ADDRESS_IP6</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">union</span> <span class="nc">address_union</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">vl_api_ip4_address_t</span><span class="w"> </span><span class="n">ip4</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">vl_api_ip6_address_t</span><span class="w"> </span><span class="n">ip6</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">typedef</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">vl_api_address_family_t</span><span class="w"> </span><span class="n">af</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">vl_api_address_union_t</span><span class="w"> </span><span class="n">un</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>Where the new type <em>vl_api_address_t</em></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TYPEDEF</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="w"> </span><span class="n">block_statements_opt</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TYPEDEF</span><span class="w"> </span><span class="n">declaration</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="importing-definitions">
<h3>Importing Definitions<a class="headerlink" href="#importing-definitions" title="Permalink to this headline"></a></h3>
<p>You can use definitions from other .api files by importing them. To
import another .api’s definitions, you add an import statement to the
top of your file:</p>
<p>import “vnet/ip/ip_types.api”;</p>
<p>By default you can only use definitions from directly imported .api
files.</p>
<p>The API compiler searches for imported files in a set of directories
specified on the API compiler command line using the –includedir flag.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">import</span> <span class="p">:</span><span class="w"> </span><span class="n">IMPORT</span><span class="w"> </span><span class="n">STRING_LITERAL</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="comments">
<h3>Comments<a class="headerlink" href="#comments" title="Permalink to this headline"></a></h3>
<p>The API language uses C style comments.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* */</span><span class="w"></span>
<span class="c1">//</span>
</pre></div>
</div>
</section>
<section id="enumerations">
<h3>Enumerations<a class="headerlink" href="#enumerations" title="Permalink to this headline"></a></h3>
<p>Enums are similar to enums in C.</p>
<p>Every enum definition must contain a constant that maps to zero as its
first element. This is because:</p>
<p>There must be a zero value, so that we can use 0 as a numeric default
value. The zero value needs to be the first element.</p>
<p>As in C, enums can be used as flags or just as numbers. The on-wire, and
in memory representation size of an enum can be specified. Not all
language bindings will support that. The default size is 4 (u32).</p>
<p>Example</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">ip_neighbor_flags</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">IP_API_NEIGHBOR_FLAG_NONE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">IP_API_NEIGHBOR_FLAG_STATIC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">IP_API_NEIGHBOR_FLAG_NO_FIB_ENTRY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x2</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>Which generates the vl_api_ip_neighbor_flags_t in the C binding. In
Python that is represented as an IntFlag object
VppEnum.vl_api_ip_neighbor_flags_t.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ENUM</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="w"> </span><span class="n">enum_statements</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="k">enum</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ENUM</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="w"> </span><span class="n">enum_size</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="w"> </span><span class="n">enum_statements</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="nl">enum_size</span> <span class="p">:</span><span class="w"> </span><span class="n">U8</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">U16</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">U32</span><span class="w"></span>
<span class="nl">enum_statements</span> <span class="p">:</span><span class="w"> </span><span class="n">enum_statement</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">enum_statements</span><span class="w"> </span><span class="n">enum_statement</span><span class="w"></span>
<span class="nl">enum_statement</span> <span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;=&#39;</span><span class="w"> </span><span class="n">NUM</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="w"></span>
<span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="services">
<h3>Services<a class="headerlink" href="#services" title="Permalink to this headline"></a></h3>
<p>The service statement defines the relationship between messages. For
request/response and dump/details messages it ties the request with the
reply. For events, it specifies which events that can be received for a
given <code class="docutils literal notranslate"><span class="pre">want_*</span></code> call.</p>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">rpc</span><span class="w"> </span><span class="n">want_interface_events</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">want_interface_events_reply</span><span class="w"></span>
<span class="w">    </span><span class="n">events</span><span class="w"> </span><span class="n">sw_interface_event</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>Which states that the request want_interface_events returns a
want_interface_events_reply and if enabled the client will receive
sw_interface_event messages whenever interface states changes.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">service</span> <span class="p">:</span><span class="w"> </span><span class="n">SERVICE</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="w"> </span><span class="n">service_statements</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="nl">service_statements</span> <span class="p">:</span><span class="w"> </span><span class="n">service_statement</span><span class="w"></span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">service_statements</span><span class="w"> </span><span class="n">service_statement</span><span class="w"></span>
<span class="nl">service_statement</span> <span class="p">:</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">RETURNS</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">RETURNS</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">RETURNS</span><span class="w"> </span><span class="n">STREAM</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="w">                     </span><span class="o">|</span><span class="w"> </span><span class="n">RPC</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">RETURNS</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">EVENTS</span><span class="w"> </span><span class="n">event_list</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"></span>
<span class="nl">event_list</span> <span class="p">:</span><span class="w"> </span><span class="n">events</span><span class="w"></span>
<span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">event_list</span><span class="w"> </span><span class="n">events</span><span class="w"></span>
<span class="nl">events</span> <span class="p">:</span><span class="w"> </span><span class="n">ID</span><span class="w"></span>
<span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline"></a></h2>
<section id="scalar-value-types">
<h3>Scalar Value Types<a class="headerlink" href="#scalar-value-types" title="Permalink to this headline"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 19%" />
<col style="width: 35%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>.api type</p></th>
<th class="head"><p>size</p></th>
<th class="head"><p>C type</p></th>
<th class="head"><p>Python type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>i8</p></td>
<td><p>1</p></td>
<td><p>i8</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>u8</p></td>
<td><p>1</p></td>
<td><p>u8</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-even"><td><p>i16</p></td>
<td><p>2</p></td>
<td><p>i16</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>u16</p></td>
<td><p>2</p></td>
<td><p>u16</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-even"><td><p>i32</p></td>
<td><p>4</p></td>
<td><p>i32</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>u32</p></td>
<td><p>4</p></td>
<td><p>u32</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-even"><td><p>i64</p></td>
<td><p>8</p></td>
<td><p>i64</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>u64</p></td>
<td><p>8</p></td>
<td><p>u64</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-even"><td><p>f64</p></td>
<td><p>8</p></td>
<td><p>f64</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>bool</p></td>
<td><p>1</p></td>
<td><p>bool</p></td>
<td><p>boolean</p></td>
</tr>
<tr class="row-even"><td><p>string</p></td>
<td><p>variable</p></td>
<td><p>vl_api_string_t</p></td>
<td><p>str</p></td>
</tr>
</tbody>
</table>
</section>
<section id="user-defined-types">
<h3>User Defined Types<a class="headerlink" href="#user-defined-types" title="Permalink to this headline"></a></h3>
<section id="vnet-ip-ip-types-api">
<h4>vnet/ip/ip_types.api<a class="headerlink" href="#vnet-ip-ip-types-api" title="Permalink to this headline"></a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 12%" />
<col style="width: 20%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>.api type</p></th>
<th class="head"><p>size</p></th>
<th class="head"><p>C type</p></th>
<th class="head"><p>Python type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>vl_api_address_t</p></td>
<td><p>20</p></td>
<td><p>vl_ap
i_address_t</p></td>
<td><p>`
<cite>&lt;class ‘ipaddress.IPv4
Address’&gt; or &lt;class ‘ip
address.IPv6Address’&gt;`</cite></p></td>
</tr>
<tr class="row-odd"><td><p>vl
_api_ip4_address_t</p></td>
<td><p>4</p></td>
<td><p>vl_api_ip
4_address_t</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'ip</span>
<span class="pre">address.IPv4Address'&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>vl
_api_ip6_address_t</p></td>
<td><p>16</p></td>
<td><p>vl_api_ip
6_address_t</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'ip</span>
<span class="pre">address.IPv6Address'&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>vl_api_prefix_t</p></td>
<td><p>21</p></td>
<td><p>vl_a
pi_prefix_t</p></td>
<td><p>`
<cite>&lt;class ‘ipaddress.IPv4
Network’&gt; or &lt;class ‘ip
address.IPv6Network’&gt;`</cite></p></td>
</tr>
<tr class="row-even"><td><p>v
l_api_ip4_prefix_t</p></td>
<td><p>5</p></td>
<td><p>vl_api_i
p4_prefix_t</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'ip</span>
<span class="pre">address.IPv4Network'&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>v
l_api_ip6_prefix_t</p></td>
<td><p>17</p></td>
<td><p>vl_api_i
p6_prefix_t</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'ip</span>
<span class="pre">address.IPv6Network'&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>vl_api_ip4_add
ress_with_prefix_t</p></td>
<td><p>5</p></td>
<td><p>vl_api_ip4
_address_wi
th_prefix_t</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'ipad</span>
<span class="pre">dress.IPv4Interface'&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>vl_api_ip6_add
ress_with_prefix_t</p></td>
<td><p>17</p></td>
<td><p>vl_api_ip6
_address_wi
th_prefix_t</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'ipad</span>
<span class="pre">dress.IPv6Interface'&gt;</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="vnet-ethernet-ethernet-types-api">
<h4>vnet/ethernet/ethernet_types.api<a class="headerlink" href="#vnet-ethernet-ethernet-types-api" title="Permalink to this headline"></a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 9%" />
<col style="width: 31%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>.api type</p></th>
<th class="head"><p>size</p></th>
<th class="head"><p>C type</p></th>
<th class="head"><p>Python type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">vl_</span>
<span class="pre">api_mac_address_t</span></code></p></td>
<td><p>6</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">vl_</span>
<span class="pre">api_mac_address_t</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">'vpp_pa</span>
<span class="pre">pi.MACAddress'&gt;</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="vnet-interface-types-api">
<h4>vnet/interface_types.api<a class="headerlink" href="#vnet-interface-types-api" title="Permalink to this headline"></a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 6%" />
<col style="width: 38%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>.api type</p></th>
<th class="head"><p>size</p></th>
<th class="head"><p>C type</p></th>
<th class="head"><p>Python type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>vl_api_interface_index_t</p></td>
<td><p>4</p></td>
<td><p>vl_api_interface_index_t</p></td>
<td><p>int</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="new-explicit-types">
<h3>New explicit types<a class="headerlink" href="#new-explicit-types" title="Permalink to this headline"></a></h3>
<section id="string-versus-bytes">
<h4>String versus bytes<a class="headerlink" href="#string-versus-bytes" title="Permalink to this headline"></a></h4>
<p>A byte string with a maximum length of 64:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">u8</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>Before the “string” type was added, text string were defined like this.
The implications of that was the user would have to know if the field
represented a \0 ended C-string or a fixed length byte string. The wire
format of the ‘string’ type is a u32 length</p>
<p>An IPv4 or IPv6 address was previously defined like:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">u8</span><span class="w"> </span><span class="n">is_ip6</span><span class="p">;</span><span class="w"></span>
<span class="n">u8</span><span class="w"> </span><span class="n">address</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>Which made it hard for language bindings to represent the address as
anything but a byte string. The new explicit address types are shown
above.</p>
</section>
</section>
</section>
<section id="language-generators">
<h2>Language generators<a class="headerlink" href="#language-generators" title="Permalink to this headline"></a></h2>
<p>The VPP API compiler currently has two output modules. One generating
JSON and one generating C header files that are directly used by the VPP
infrastructure and plugins.</p>
<p>The C/C++, Python, Go Lua, and Java language bindings are generated
based on the JSON files.</p>
<section id="future-considerations">
<h3>Future considerations<a class="headerlink" href="#future-considerations" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Generate C/C++ (vapi) client code directly from vppapigen</p></li>
<li><p>Embed JSON definitions into the API server, so dynamic languages
can download them directly without going via the filesystem and JSON
files.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="vpp_api_module.html" class="btn btn-neutral float-left" title="VPP API module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="writing_api_handlers.html" class="btn btn-neutral float-right" title="Writing API handlers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2021, Linux Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>